<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>Nova CV | ç¼–è¾‘å™¨</title>

		<!-- Favicon -->
		<link
			rel="icon"
			href="https://ui-avatars.com/api/?name=N&background=2563eb&color=fff&rounded=true&font-size=0.6"
			type="image/png"
		/>

		<!-- å­—ä½“å¼•å…¥ -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
			rel="stylesheet"
		/>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- html2canvas -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

		<!-- Tailwind Config -->
		<script>
			tailwind.config = {
				darkMode: 'class',
				theme: {
					extend: {
						fontFamily: {
							sans: ['Inter', 'Noto Sans SC', 'sans-serif'],
							serif: ['Noto Serif SC', 'serif'],
							mono: ['JetBrains Mono', 'monospace']
						},
						colors: {
							linear: {
								bg: 'rgb(var(--bg) / <alpha-value>)',
								card: 'rgb(var(--card) / <alpha-value>)',
								border: 'rgb(var(--border) / <alpha-value>)',
								text: 'rgb(var(--text) / <alpha-value>)',
								muted: 'rgb(var(--muted) / <alpha-value>)',
								primary: 'rgb(var(--primary) / <alpha-value>)'
							}
						},
						boxShadow: {
							paper: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0,0,0,0.05)'
						}
					}
				}
			}
		</script>

		<style>
			/* å…¨å±€æ ·å¼ */
			/* CSS å˜é‡å®šä¹‰ï¼ˆRGB æ ¼å¼ï¼Œæ”¯æŒ Tailwind é€æ˜åº¦ï¼‰ */
			:root {
				/* æµ…è‰²æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ */
				--bg: 255 255 255;
				--card: 247 248 249;
				--border: 225 228 232;
				--text: 31 35 40;
				--muted: 101 109 118;
				--primary: 37 99 235;
				--primary-hover: 29 78 216;
				--accent: 245 158 11;
			}

			.dark {
				/* æ·±è‰²æ¨¡å¼ */
				--bg: 15 23 42;
				--card: 30 41 59;
				--border: 51 65 85;
				--text: 226 232 240;
				--muted: 148 163 184;
				--primary: 59 130 246;
				--primary-hover: 96 165 250;
			}

			/* æ¯›ç»ç’ƒæ•ˆæœ */
			.glass {
				background: rgba(var(--bg), 0.95);
				backdrop-filter: blur(16px);
				-webkit-backdrop-filter: blur(16px);
				border-bottom: 1px solid rgba(var(--border), 0.5);
			}
			.dark .glass {
				background: rgba(15, 23, 42, 0.95);
			}

			.glass-panel {
				background: rgb(var(--bg));
				border-right: 1px solid rgba(var(--border), 0.5);
			}
			.dark .glass-panel {
				background: rgb(15, 23, 42);
			}

			/* æ¸å˜æ–‡å­— */
			.text-gradient {
				background: linear-gradient(135deg, rgb(var(--text)) 0%, rgb(var(--muted)) 100%);
				-webkit-background-clip: text;
				background-clip: text;
				-webkit-text-fill-color: transparent;
			}

			/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
			::-webkit-scrollbar {
				width: 6px;
				height: 6px;
			}
			::-webkit-scrollbar-track {
				background: transparent;
			}
			::-webkit-scrollbar-thumb {
				background: rgba(var(--border), 0.8);
				border-radius: 3px;
			}
			::-webkit-scrollbar-thumb:hover {
				background: rgba(var(--muted), 0.8);
			}

			body {
				background-color: rgb(var(--bg));
				color: rgb(var(--text));
				transition: background-color 0.3s, color 0.3s;
			}

			/* ç¼–è¾‘å™¨ç‰¹å®šæ ·å¼ */
			.editor-section-title {
				font-size: 0.875rem;
				font-weight: 700;
				color: rgb(var(--text));
				text-transform: uppercase;
				letter-spacing: 0.05em;
				display: flex;
				align-items: center;
				gap: 0.5rem;
				margin-bottom: 0.75rem;
			}

			.input-group {
				background: rgba(var(--card), 0.5);
				border: 1px solid rgba(var(--border), 0.8);
				transition: all 0.2s;
			}
			.input-group:focus-within {
				border-color: rgb(var(--primary));
				box-shadow: 0 0 0 2px rgba(var(--primary), 0.2);
				background: rgba(var(--card), 1);
			}

			.no-scrollbar::-webkit-scrollbar {
				display: none;
			}
			.no-scrollbar {
				-ms-overflow-style: none;
				scrollbar-width: none;
			}

			/* æ‰“å°æ ·å¼ */
			@media print {
				@page {
					margin: 0;
					size: A4;
				}
				body,
				html,
				#app-container,
				#preview-panel {
					height: auto !important;
					min-height: 0 !important;
					overflow: visible !important;
					background-color: white !important;
					display: block !important;
					position: relative !important;
					width: 100% !important;
					margin: 0 !important;
					padding: 0 !important;
				}
				.no-print,
				aside,
				.zoom-controls,
				#template-modal,
				#mobile-fab {
					display: none !important;
				}
				#app-container {
					display: block !important;
				}
				.a4-preview {
					width: 100% !important;
					height: auto !important;
					min-height: 100vh !important;
					box-shadow: none !important;
					margin: 0 !important;
					transform: none !important;
					filter: none !important;
					border: none !important;
					overflow: visible !important;
				}
				* {
					-webkit-print-color-adjust: exact !important;
					print-color-adjust: exact !important;
				}
				.break-inside-avoid {
					page-break-inside: avoid;
					break-inside: avoid;
				}
				.grid {
					display: grid !important;
				}
				.print\:text-white {
					color: white !important;
				}
				.print\:text-black {
					color: black !important;
				}
				.print\:h-full {
					height: 100% !important;
					min-height: 100vh !important;
				}
			}

			/* ç»Ÿä¸€è¾“å…¥æ¡†æ ·å¼ */
			input[type='text'],
			input[type='password'],
			textarea {
				background: #ffffff !important;
				border: 2px solid #e2e8f0 !important;
				border-radius: 0.5rem !important;
				padding: 0.625rem 0.875rem !important;
				font-size: 0.875rem !important;
				color: #1e293b !important;
				transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
				outline: none !important;
			}
			.dark input[type='text'],
			.dark input[type='password'],
			.dark textarea {
				background: #1e293b !important;
				border-color: #475569 !important;
				color: #e2e8f0 !important;
			}
			input[type='text']:focus,
			input[type='password']:focus,
			textarea:focus {
				border-color: #2563eb !important;
				box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2), 0 2px 8px rgba(37, 99, 235, 0.15) !important;
			}
			input[type='text']:hover:not(:focus),
			input[type='password']:hover:not(:focus),
			textarea:hover:not(:focus) {
				border-color: #94a3b8 !important;
			}
			.dark input[type='text']:hover:not(:focus),
			.dark input[type='password']:hover:not(:focus),
			.dark textarea:hover:not(:focus) {
				border-color: #64748b !important;
			}

			/* æ»‘å—æ ·å¼ */
			input[type='range'] {
				-webkit-appearance: none !important;
				appearance: none !important;
				background: transparent !important;
				width: 100% !important;
				cursor: pointer !important;
				height: 24px !important;
			}
			input[type='range']::-webkit-slider-thumb {
				-webkit-appearance: none !important;
				height: 20px !important;
				width: 20px !important;
				border-radius: 50% !important;
				background: rgb(var(--primary)) !important;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15), 0 0 0 4px rgba(var(--primary), 0.15) !important;
				margin-top: -8px !important;
				cursor: pointer !important;
				transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
				border: 3px solid white !important;
			}
			.dark input[type='range']::-webkit-slider-thumb {
				border-color: #1e293b !important;
			}
			input[type='range']::-webkit-slider-thumb:hover {
				transform: scale(1.15) !important;
				box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), 0 0 0 6px rgba(var(--primary), 0.2) !important;
			}
			input[type='range']::-webkit-slider-thumb:active {
				transform: scale(0.95) !important;
				transition: all 0.1s ease !important;
			}
			input[type='range']::-webkit-slider-runnable-track {
				width: 100% !important;
				height: 6px !important;
				background: #cbd5e1 !important;
				border-radius: 3px !important;
				transition: background 0.2s ease !important;
			}
			.dark input[type='range']::-webkit-slider-runnable-track {
				background: #475569 !important;
			}
			input[type='range']:hover::-webkit-slider-runnable-track {
				background: #93c5fd !important;
			}
			.dark input[type='range']:hover::-webkit-slider-runnable-track {
				background: #3b82f6 !important;
			}
			input[type='range']::-moz-range-thumb {
				height: 20px !important;
				width: 20px !important;
				border-radius: 50% !important;
				background: rgb(var(--primary)) !important;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15) !important;
				border: 3px solid white !important;
				cursor: pointer !important;
				transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
			}
			input[type='range']::-moz-range-thumb:hover {
				transform: scale(1.15) !important;
			}
			input[type='range']::-moz-range-track {
				width: 100% !important;
				height: 6px !important;
				background: #cbd5e1 !important;
				border-radius: 3px !important;
			}
			.dark input[type='range']::-moz-range-track {
				background: #475569 !important;
			}
			/* é¢œè‰²é€‰æ‹©å™¨ */
			.color-option {
				width: 36px;
				height: 36px;
				border-radius: 50%;
				cursor: pointer;
				border: 3px solid transparent;
				transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
				position: relative;
				display: flex;
				align-items: center;
				justify-content: center;
				box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12), inset 0 0 0 1px rgba(255, 255, 255, 0.1);
			}
			.color-option:hover {
				transform: scale(1.1) rotate(5deg);
				box-shadow: 0 6px 14px rgba(0, 0, 0, 0.2), inset 0 0 0 1px rgba(255, 255, 255, 0.2);
			}
			.color-option:active {
				transform: scale(0.95);
				transition: all 0.1s ease;
			}
			.color-option.active {
				border-color: rgb(var(--text));
				transform: scale(1.15);
				box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(var(--primary), 0.3),
					inset 0 0 0 1px rgba(255, 255, 255, 0.2);
				animation: colorPulse 2s ease-in-out infinite;
			}
			@keyframes colorPulse {
				0%,
				100% {
					box-shadow: 0 6px 18px rgba(0, 0, 0, 0.3), 0 0 0 3px rgba(var(--primary), 0.3),
						inset 0 0 0 1px rgba(255, 255, 255, 0.2);
				}
				50% {
					box-shadow: 0 8px 22px rgba(0, 0, 0, 0.35), 0 0 0 4px rgba(var(--primary), 0.4),
						inset 0 0 0 1px rgba(255, 255, 255, 0.3);
				}
			}
			.color-input-wrapper {
				position: relative;
				overflow: hidden;
			}
			.color-input-wrapper input[type='color'] {
				position: absolute;
				inset: 0;
				width: 100%;
				height: 100%;
				opacity: 0;
				cursor: pointer;
			}

			/* å­—ä½“æŒ‰é’®æ ·å¼ */
			.font-btn-primary {
				border: 2px solid #2563eb !important;
				background: rgba(37, 99, 235, 0.1) !important;
				color: #2563eb !important;
			}
			.dark .font-btn-primary {
				background: rgba(37, 99, 235, 0.2) !important;
				color: #60a5fa !important;
			}
			.font-btn-secondary {
				border: 2px solid #e2e8f0 !important;
				background: #ffffff !important;
				color: #475569 !important;
			}
			.dark .font-btn-secondary {
				border-color: #475569 !important;
				background: #1e293b !important;
				color: #94a3b8 !important;
			}
			.font-btn-secondary:hover {
				border-color: #93c5fd !important;
				background: rgba(37, 99, 235, 0.05) !important;
			}

			/* åˆ†æ®µæ§åˆ¶æŒ‰é’® */
			.style-btn-group {
				background: #f1f5f9;
				border-radius: 0.5rem;
				padding: 0.25rem;
				display: flex;
				gap: 0.25rem;
			}
			.dark .style-btn-group {
				background: #1e293b;
			}
			.style-btn {
				flex: 1;
				text-align: center;
				padding: 0.5rem 0.75rem;
				font-size: 0.8125rem;
				border-radius: 0.375rem;
				color: #64748b;
				transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
				cursor: pointer;
				border: none;
				background: transparent;
				font-weight: 500;
				position: relative;
			}
			.dark .style-btn {
				color: #94a3b8;
			}
			.style-btn:hover:not(.active) {
				color: #1e293b;
				background: rgba(37, 99, 235, 0.08);
				transform: translateY(-1px);
			}
			.dark .style-btn:hover:not(.active) {
				color: #e2e8f0;
			}
			.style-btn:active:not(.active) {
				transform: translateY(0);
			}
			.style-btn.active {
				background: #2563eb;
				color: white;
				box-shadow: 0 2px 6px rgba(37, 99, 235, 0.3), 0 1px 3px rgba(0, 0, 0, 0.1);
				font-weight: 600;
				transform: scale(1.02);
			}

			/* A4 é¢„è§ˆåŒºåŸŸ */
			.a4-preview {
				width: 210mm;
				min-height: 297mm;
				height: 297mm;
				margin: 0 auto;
				background: white;
				box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
				transform-origin: top center;
				transition: transform 0.2s ease-out;
			}
			.dark .a4-preview {
				filter: brightness(0.95);
			}

			/* å¤´åƒè£å‰ªå®¹å™¨ */
			.avatar-crop-container {
				overflow: hidden;
			}
			.avatar-crop-container.rounded-full {
				border-radius: 9999px;
			}
			.avatar-crop-container.rounded-lg {
				border-radius: 0.5rem;
			}

			/* Toast æç¤ºæ¡† */
			.toast {
				display: flex;
				align-items: center;
				gap: 0.75rem;
				padding: 0.875rem 1.25rem;
				border-radius: 0.75rem;
				background: white;
				box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05);
				pointer-events: auto;
				transform: translateX(120%);
				opacity: 0;
				transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
				max-width: 360px;
			}
			.dark .toast {
				background: #1e293b;
				box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 255, 255, 0.1);
			}
			.toast.show {
				transform: translateX(0);
				opacity: 1;
			}
			.toast.hide {
				transform: translateX(120%);
				opacity: 0;
			}
			.toast-icon {
				width: 2rem;
				height: 2rem;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				flex-shrink: 0;
				font-size: 0.875rem;
			}
			.toast-success .toast-icon {
				background: #dcfce7;
				color: #16a34a;
			}
			.dark .toast-success .toast-icon {
				background: rgba(22, 163, 74, 0.2);
			}
			.toast-error .toast-icon {
				background: #fee2e2;
				color: #dc2626;
			}
			.dark .toast-error .toast-icon {
				background: rgba(220, 38, 38, 0.2);
			}
			.toast-warning .toast-icon {
				background: #fef3c7;
				color: #d97706;
			}
			.dark .toast-warning .toast-icon {
				background: rgba(217, 119, 6, 0.2);
			}
			.toast-info .toast-icon {
				background: #dbeafe;
				color: #2563eb;
			}
			.dark .toast-info .toast-icon {
				background: rgba(37, 99, 235, 0.2);
			}
			.toast-content {
				flex: 1;
				min-width: 0;
			}
			.toast-title {
				font-weight: 600;
				font-size: 0.875rem;
				color: #1e293b;
				margin-bottom: 0.125rem;
			}
			.dark .toast-title {
				color: #f1f5f9;
			}
			.toast-message {
				font-size: 0.8125rem;
				color: #64748b;
				line-height: 1.4;
			}
			.dark .toast-message {
				color: #94a3b8;
			}
			.toast-close {
				width: 1.5rem;
				height: 1.5rem;
				border-radius: 0.375rem;
				display: flex;
				align-items: center;
				justify-content: center;
				color: #94a3b8;
				cursor: pointer;
				transition: all 0.2s;
				flex-shrink: 0;
			}
			.toast-close:hover {
				background: #f1f5f9;
				color: #475569;
			}
			.dark .toast-close:hover {
				background: #334155;
				color: #e2e8f0;
			}
			.toast-progress {
				position: absolute;
				bottom: 0;
				left: 0;
				height: 3px;
				background: currentColor;
				border-radius: 0 0 0.75rem 0.75rem;
				opacity: 0.3;
			}
			@keyframes toastProgress {
				from {
					width: 100%;
				}
				to {
					width: 0%;
				}
			}

			/* æ¨¡ç‰ˆç¼©ç•¥å›¾é¢„è§ˆ */
			.mini-preview {
				width: 100%;
				height: 180px;
				background: #f8fafc;
				border: 1px solid #e2e8f0;
				border-radius: 8px;
				overflow: hidden;
				position: relative;
				transition: all 0.2s;
			}
			.mini-preview-inner {
				width: 210mm;
				min-height: 297mm;
				transform: scale(0.12);
				transform-origin: top left;
				position: absolute;
				top: 0;
				left: 50%;
				margin-left: -12.6mm;
				pointer-events: none;
			}
			.template-card.active .mini-preview {
				border-color: #2563eb;
				box-shadow: 0 0 0 2px #2563eb;
			}

			/* é¡¶æ æŒ‰é’®ç»Ÿä¸€æ ·å¼ */
			.header-btn {
				display: flex;
				align-items: center;
				justify-content: center;
				height: 34px;
				min-width: 34px;
				padding: 0 10px;
				border-radius: 8px;
				font-size: 12px;
				font-weight: 500;
				transition: all 0.2s;
				gap: 6px;
				box-sizing: border-box;
			}
			.header-btn:active {
				transform: scale(0.95);
			}

			/* é¡¶æ å›¾æ ‡æŒ‰é’®ï¼ˆä¸»é¢˜/è®¾ç½®ï¼‰ */
			.header-icon-btn {
				display: flex;
				align-items: center;
				justify-content: center;
				width: 32px;
				height: 32px;
				border-radius: 8px;
				font-size: 14px;
				color: rgb(var(--muted));
				transition: all 0.2s;
			}
			.header-icon-btn:hover {
				background: rgba(var(--border), 0.5);
				color: rgb(var(--text));
			}
			.header-icon-btn:active {
				transform: scale(0.95);
			}
		</style>
	</head>
	<body
		class="text-slate-800 dark:text-slate-200 antialiased min-h-screen flex flex-col bg-slate-50 dark:bg-slate-950"
	>
		<div id="app-container" class="flex h-screen flex-col overflow-hidden">
			<header
				class="no-print h-14 md:h-16 glass border-b border-slate-200/50 dark:border-slate-800/50 flex items-center justify-between px-3 md:px-6 z-50 shrink-0 transition-all sticky top-0"
			>
				<!-- å·¦ä¾§ï¼šLogo + ä¸»é¢˜/è®¾ç½® -->
				<div class="flex items-center gap-2 md:gap-3">
					<a
						href="index.html"
						class="hidden sm:flex items-center gap-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors"
						title="è¿”å›é¦–é¡µ"
					>
						<i class="fas fa-arrow-left"></i>
						<span class="text-sm">é¦–é¡µ</span>
					</a>
					<div class="hidden sm:block w-px h-6 bg-slate-200 dark:bg-slate-700"></div>
					<div
						class="flex items-center gap-2 cursor-pointer"
						onclick="window.location.href='index.html'"
						title="è¿”å›é¦–é¡µ"
					>
						<div
							id="logo-bg"
							class="w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-lg"
							style="background: linear-gradient(135deg, #3b82f6, #6366f1)"
						>
							N
						</div>
						<h1 class="font-bold text-lg tracking-tight">
							<span class="text-slate-900 dark:text-white">Nova</span>
							<span class="text-blue-600" id="logo-text">CV</span>
						</h1>
					</div>

					<!-- ä¸»é¢˜å’Œè®¾ç½®æŒ‰é’® - æ”¾åœ¨ logo å³è¾¹ -->
					<div class="flex items-center gap-1 ml-1">
						<button onclick="toggleTheme()" class="header-icon-btn" title="åˆ‡æ¢ä¸»é¢˜">
							<i class="fas fa-moon dark:hidden"></i>
							<i class="fas fa-sun hidden dark:block"></i>
						</button>
						<button onclick="openSettingsModal()" class="header-icon-btn" title="è®¾ç½®">
							<i class="fas fa-cog"></i>
						</button>
					</div>
				</div>

				<!-- å³ä¾§ï¼šæ“ä½œæŒ‰é’® -->
				<div class="flex items-center gap-1.5 md:gap-2">
					<!-- ç¼©æ”¾æ§åˆ¶ - ä»…æ¡Œé¢ç«¯ -->
					<div
						class="hidden lg:flex items-center h-[34px] bg-slate-100 dark:bg-slate-800 rounded-lg px-1 border border-slate-200 dark:border-slate-700"
					>
						<button
							onclick="changeZoom(-0.1)"
							class="w-6 h-6 flex items-center justify-center rounded hover:bg-white dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition-all active:scale-95"
						>
							<i class="fas fa-minus text-[10px]"></i>
						</button>
						<span
							class="text-[11px] font-mono text-slate-600 dark:text-slate-300 w-10 text-center select-none"
							id="page-zoom-val"
							>100%</span
						>
						<button
							onclick="changeZoom(0.1)"
							class="w-6 h-6 flex items-center justify-center rounded hover:bg-white dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition-all active:scale-95"
						>
							<i class="fas fa-plus text-[10px]"></i>
						</button>
					</div>

					<!-- æ¨¡ç‰ˆåº“æŒ‰é’® -->
					<button
						onclick="openTemplateModal()"
						class="header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"
					>
						<i class="fas fa-th-large text-indigo-500"></i>
						<span class="hidden sm:inline">æ¨¡ç‰ˆé€‰æ‹©</span>
					</button>

					<!-- å¯¼å‡ºå›¾ç‰‡ - ä»…æ¡Œé¢ç«¯ -->
					<button
						onclick="downloadImage()"
						class="hidden md:flex header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"
						title="å¯¼å‡ºå›¾ç‰‡"
					>
						<i class="fas fa-image text-amber-500"></i>
						<span class="hidden lg:inline">å¯¼å‡ºå›¾ç‰‡</span>
					</button>

					<!-- å¯¼å‡º PDF -->
					<button
						onclick="printResume()"
						id="btn-export"
						class="header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"
					>
						<i class="fas fa-file-pdf text-blue-500"></i>
						<span class="hidden sm:inline">å¯¼å‡ºPDF</span>
					</button>

					<!-- ä¿å­˜æŒ‰é’® - ä»…æ¡Œé¢ç«¯ -->
					<button
						onclick="manualSave()"
						class="hidden md:flex header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"
						title="ä¿å­˜æ•°æ®"
					>
						<i class="fas fa-save text-green-500"></i>
						<span>ä¿å­˜æ•°æ®</span>
					</button>

					<!-- æ•°æ®ç®¡ç†ä¸‹æ‹‰èœå• - ä»…æ¡Œé¢ç«¯ -->
					<div class="relative hidden md:block" id="actions-dropdown-container">
						<button
							onclick="toggleActionsDropdown(event)"
							class="header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"
							title="æ•°æ®ç®¡ç†"
						>
							<i class="fas fa-database text-purple-500"></i>
							<span>æ•°æ®ç®¡ç†</span>
							<i class="fas fa-chevron-down text-[10px] text-slate-400 ml-0.5"></i>
						</button>
						<div id="actions-dropdown-menu" class="absolute right-0 top-full pt-2 w-44 hidden z-50">
							<div
								class="bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden py-1"
							>
								<button
									onclick="exportJSON(); closeActionsDropdown()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-file-export w-4 text-blue-500"></i> å¯¼å‡º JSON
								</button>
								<button
									onclick="document.getElementById('file-import').click(); closeActionsDropdown()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-file-import w-4 text-purple-500"></i> å¯¼å…¥ JSON
								</button>
							</div>
						</div>
					</div>
					<!-- ç§»åŠ¨ç«¯æ›´å¤šèœå• -->
					<div class="relative md:hidden" id="mobile-menu-container">
						<button
							onclick="toggleMobileMenu(event)"
							class="header-btn bg-white dark:bg-slate-800 hover:bg-slate-50 dark:hover:bg-slate-700 text-orange-500 border border-slate-200 dark:border-slate-700"
							title="æ›´å¤šæ“ä½œ"
						>
							<i class="fas fa-ellipsis-v"></i>
						</button>
						<div id="mobile-menu-dropdown" class="absolute right-0 top-full pt-2 w-48 hidden z-50">
							<div
								class="bg-white dark:bg-slate-800 rounded-xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden py-1"
							>
								<button
									onclick="manualSave(); closeMobileMenu()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-save w-4 text-green-500"></i> ä¿å­˜æ•°æ®
								</button>
								<div class="h-px bg-slate-100 dark:bg-slate-700 my-1"></div>
								<button
									onclick="exportJSON(); closeMobileMenu()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-file-export w-4 text-blue-500"></i> å¯¼å‡º JSON
								</button>
								<button
									onclick="document.getElementById('file-import').click(); closeMobileMenu()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-file-import w-4 text-purple-500"></i> å¯¼å…¥ JSON
								</button>
								<div class="h-px bg-slate-100 dark:bg-slate-700 my-1"></div>
								<button
									onclick="downloadImage(); closeMobileMenu()"
									class="w-full text-left px-4 py-2.5 hover:bg-slate-50 dark:hover:bg-slate-700 text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2.5 transition-colors"
								>
									<i class="fas fa-image w-4 text-amber-500"></i> å¯¼å‡ºå›¾ç‰‡
								</button>
							</div>
						</div>
					</div>
				</div>
			</header>

			<div class="flex-1 flex overflow-hidden relative">
				<aside
					class="no-print w-full md:w-[450px] lg:w-[500px] glass-panel flex flex-col shrink-0 z-30 shadow-2xl transition-transform duration-300 absolute md:relative h-full transform md:transform-none translate-x-0"
					id="editor-panel"
				>
					<div
						class="md:hidden flex items-center justify-between px-4 py-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50"
					>
						<span class="font-bold text-sm text-slate-700 dark:text-slate-200">ğŸ“ ç¼–è¾‘å†…å®¹</span>
						<button
							onclick="toggleMobileEditor(false)"
							class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 active:bg-blue-200"
						>
							å®Œæˆé¢„è§ˆ <i class="fas fa-check"></i>
						</button>
					</div>
					<div class="flex border-b border-slate-200 dark:border-slate-800">
						<button
							onclick="switchTab('content')"
							id="tab-content"
							class="flex-1 py-3 text-sm font-medium border-b-2 transition-all duration-300 text-blue-600 border-blue-600 bg-blue-50/50 dark:bg-blue-900/10"
						>
							å†…å®¹ç¼–è¾‘
						</button>
						<button
							onclick="switchTab('style')"
							id="tab-style"
							class="flex-1 py-3 text-sm font-medium border-b-2 transition-all duration-300 text-slate-500 border-transparent hover:text-slate-700 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50"
						>
							æ ·å¼è®¾ç½®
						</button>
					</div>
					<div id="panel-content" class="flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar pb-32 md:pb-24">
						<section class="space-y-4">
							<h2 class="editor-section-title"><i class="fas fa-user-circle"></i> åŸºæœ¬ä¿¡æ¯</h2>
							<div class="space-y-4">
								<div>
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>å§“å</label
									>
									<input
										type="text"
										id="input-name"
										class="w-full"
										value="ææ˜å“²"
										oninput="updateText('name', this.value)"
									/>
								</div>
								<div>
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>èŒä½</label
									>
									<input
										type="text"
										id="input-job"
										class="w-full"
										value="é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ & UX è®¾è®¡å¸ˆ"
										oninput="updateText('job', this.value)"
									/>
								</div>
							</div>
							<div
								class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl border border-slate-200 dark:border-slate-700"
							>
								<div class="flex items-start gap-4">
									<div class="relative group cursor-pointer w-20 h-20 shrink-0">
										<div
											class="w-20 h-20 rounded-full overflow-hidden bg-slate-200 ring-2 ring-white dark:ring-slate-700 shadow-md"
										>
											<img
												id="editor-avatar-preview"
												src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?fit=crop&w=300&h=300"
												class="w-full h-full object-cover"
											/>
										</div>
										<label
											for="photo-upload"
											class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-medium"
											>æ›´æ¢</label
										><input
											type="file"
											id="photo-upload"
											accept="image/*"
											class="hidden"
											onchange="handlePhotoUpload(this)"
										/>
									</div>
									<div class="flex-1 space-y-3">
										<div class="space-y-1">
											<div class="flex justify-between text-xs text-slate-500">
												<span>å¤§å°</span> <span id="val-zoom">100%</span>
											</div>
											<input
												type="range"
												min="0.5"
												max="2"
												step="0.1"
												value="1"
												class="w-full"
												oninput="updatePhotoStyle('scale', this.value)"
											/>
										</div>
										<div class="space-y-1">
											<div class="flex justify-between text-xs text-slate-500">
												<span>ä½ç½® X/Y</span>
											</div>
											<div class="flex gap-2">
												<input
													type="range"
													min="-50"
													max="50"
													value="0"
													class="w-full"
													oninput="updatePhotoStyle('x', this.value)"
												/><input
													type="range"
													min="-50"
													max="50"
													value="0"
													class="w-full"
													oninput="updatePhotoStyle('y', this.value)"
												/>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="grid grid-cols-2 gap-4">
								<div class="col-span-2">
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>ç”µè¯</label
									>
									<input
										type="text"
										id="input-phone"
										class="w-full"
										value="138-0000-0000"
										oninput="updateContact('phone', this.value)"
									/>
								</div>
								<div>
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>é‚®ç®±</label
									><input
										type="text"
										id="input-email"
										class="w-full"
										value="hello@limingzhe.com"
										oninput="updateContact('email', this.value)"
									/>
								</div>
								<div>
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>åŸå¸‚</label
									><input
										type="text"
										id="input-location"
										class="w-full"
										value="ä¸Šæµ·, ä¸­å›½"
										oninput="updateContact('location', this.value)"
									/>
								</div>
								<div>
									<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
										>ä¸ªäººç½‘ç«™</label
									><input
										type="text"
										id="input-web"
										class="w-full"
										value="limingzhe.design"
										oninput="updateContact('web', this.value)"
									/>
								</div>
							</div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-2">
							<div class="flex justify-between items-center">
								<h2 class="editor-section-title"><i class="fas fa-align-left"></i> ä¸ªäººç®€ä»‹</h2>
								<button
									onclick="generateSummary()"
									id="btn-ai-summary"
									class="text-xs bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white px-2 py-1 rounded shadow hover:opacity-90 transition-opacity flex items-center gap-1"
								>
									<i class="fas fa-magic"></i> AI ç”Ÿæˆ
								</button>
							</div>
							<textarea
								id="input-summary"
								rows="4"
								class="w-full leading-relaxed resize-none"
								oninput="updateText('summary', this.value)"
							>
æ‹¥æœ‰5å¹´ä¸°å¯Œç»éªŒçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€å¯è®¿é—®ä¸”è§†è§‰ç²¾ç¾çš„Webåº”ç”¨ã€‚ç²¾é€šReactã€Vueç”Ÿæ€ç³»ç»Ÿï¼Œå¯¹å¾®å‰ç«¯æ¶æ„æœ‰æ·±å…¥ç ”ç©¶ã€‚å…·å¤‡ä¼˜ç§€çš„è®¾è®¡å®¡ç¾ï¼Œè‡´åŠ›äºå¼¥åˆè®¾è®¡ä¸ä»£ç ä¹‹é—´çš„é¸¿æ²Ÿã€‚å–„äºå›¢é˜Ÿåä½œï¼Œæ›¾ä¸»å¯¼å¤šä¸ªç™¾ä¸‡çº§ç”¨æˆ·äº§å“çš„é‡æ„å·¥ä½œã€‚</textarea
							>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<div class="flex items-center justify-between">
								<h2 class="editor-section-title"><i class="fas fa-briefcase"></i> å·¥ä½œç»å†</h2>
								<button
									onclick="addExperience()"
									class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color"
								>
									+ æ·»åŠ ç»å†
								</button>
							</div>
							<div id="experience-editor-list" class="space-y-4"></div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<div class="flex items-center justify-between">
								<h2 class="editor-section-title"><i class="fas fa-graduation-cap"></i> æ•™è‚²èƒŒæ™¯</h2>
								<button
									onclick="addEducation()"
									class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color"
								>
									+ æ·»åŠ æ•™è‚²
								</button>
							</div>
							<div id="education-editor-list" class="space-y-4"></div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<div class="flex items-center justify-between">
								<h2 class="editor-section-title"><i class="fas fa-rocket"></i> é¡¹ç›®ç»å†</h2>
								<button
									onclick="addProject()"
									class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color"
								>
									+ æ·»åŠ é¡¹ç›®
								</button>
							</div>
							<div id="project-editor-list" class="space-y-4"></div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<h2 class="editor-section-title"><i class="fas fa-tools"></i> æŠ€èƒ½ä¸é™„åŠ ä¿¡æ¯</h2>
							<div>
								<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
									>ä¸“ä¸šæŠ€èƒ½ (ç”¨é€—å·åˆ†éš”)</label
								><textarea
									id="input-skills"
									rows="3"
									class="w-full resize-none"
									oninput="updateSkills(this.value)"
								>
JavaScript (ES6+), TypeScript, React, Next.js, Tailwind CSS, Node.js, Figma, UI/UX Design, Docker, Git</textarea
								>
							</div>
							<div>
								<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
									>è¯­è¨€èƒ½åŠ›</label
								><input
									type="text"
									class="w-full"
									value="ä¸­æ–‡ (Native), English (Professional)"
									oninput="updateText('languages', this.value)"
								/>
							</div>
							<div>
								<label class="block text-xs font-semibold text-slate-600 dark:text-slate-400 mb-2"
									>å¥–é¡¹ä¸è¯ä¹¦</label
								><textarea
									rows="2"
									class="w-full resize-none"
									oninput="updateText('certificates', this.value)"
								>
AWS Certified Solutions Architect, PMP Certification</textarea
								>
							</div>
						</section>
						<div class="h-8"></div>
					</div>
					<div
						id="panel-style"
						class="hidden flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar pb-32 md:pb-24"
					>
						<section class="space-y-4">
							<h2 class="editor-section-title"><i class="fas fa-palette"></i> ä¸»é¢˜é¢œè‰²</h2>
							<div class="flex flex-wrap gap-4" id="color-picker"></div>
							<div class="mt-2 flex items-center gap-2">
								<div
									class="color-option color-input-wrapper w-8 h-8 rounded-full border-2 border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 flex items-center justify-center shadow-sm hover:border-blue-400 transition-colors cursor-pointer"
									title="è‡ªå®šä¹‰é¢œè‰²"
								>
									<i
										class="fas fa-plus text-slate-400 dark:text-slate-500 text-xs pointer-events-none"
									></i
									><input
										type="color"
										oninput="updateStyle('color', this.value)"
										title="è‡ªå®šä¹‰é¢œè‰²"
									/>
								</div>
								<span class="text-xs text-slate-500 dark:text-slate-400">è‡ªå®šä¹‰é¢œè‰²</span>
							</div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<h2 class="editor-section-title"><i class="fas fa-font"></i> å­—ä½“é£æ ¼</h2>
							<div class="grid grid-cols-2 gap-3">
								<button
									onclick="updateStyle('font', 'sans')"
									id="font-btn-sans"
									class="font-btn-primary px-4 py-3 rounded-lg text-sm font-sans text-center transition-all duration-300 shadow-sm hover:shadow-md hover:scale-105 active:scale-95"
								>
									æ— è¡¬çº¿ (Sans)</button
								><button
									onclick="updateStyle('font', 'serif')"
									id="font-btn-serif"
									class="font-btn-secondary px-4 py-3 rounded-lg text-sm font-serif text-center transition-all duration-300 hover:shadow-md hover:scale-105 active:scale-95"
								>
									è¡¬çº¿ (Serif)
								</button>
							</div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-4">
							<h2 class="editor-section-title"><i class="fas fa-text-height"></i> å…¨å±€å­—å·</h2>
							<div class="style-btn-group flex gap-1 p-1 bg-slate-100 dark:bg-slate-800 rounded-lg">
								<button onclick="updateStyle('fontSize', 'small')" class="style-btn" id="fs-small">
									å°</button
								><button
									onclick="updateStyle('fontSize', 'normal')"
									class="style-btn active"
									id="fs-normal"
								>
									ä¸­</button
								><button onclick="updateStyle('fontSize', 'large')" class="style-btn" id="fs-large">
									å¤§
								</button>
							</div>
						</section>
						<hr class="border-slate-100 dark:border-slate-800" />
						<section class="space-y-6">
							<div>
								<h2 class="editor-section-title mb-3"><i class="fas fa-arrows-alt-v"></i> é¡µè¾¹è·</h2>
								<div class="style-btn-group flex gap-1 p-1 bg-slate-100 dark:bg-slate-800 rounded-lg">
									<button onclick="updateStyle('margins', 'narrow')" class="style-btn" id="mg-narrow">
										ç´§å‡‘</button
									><button
										onclick="updateStyle('margins', 'normal')"
										class="style-btn active"
										id="mg-normal"
									>
										æ ‡å‡†</button
									><button onclick="updateStyle('margins', 'wide')" class="style-btn" id="mg-wide">
										å®½æ•
									</button>
								</div>
							</div>
							<div>
								<h2 class="editor-section-title mb-3"><i class="fas fa-align-justify"></i> è¡Œé—´è·</h2>
								<div class="style-btn-group flex gap-1 p-1 bg-slate-100 dark:bg-slate-800 rounded-lg">
									<button onclick="updateStyle('spacing', 'tight')" class="style-btn" id="sp-tight">
										ç´§å¯†</button
									><button
										onclick="updateStyle('spacing', 'normal')"
										class="style-btn"
										id="sp-normal"
									>
										èˆ’é€‚</button
									><button
										onclick="updateStyle('spacing', 'relaxed')"
										class="style-btn active"
										id="sp-relaxed"
									>
										å®½æ¾
									</button>
								</div>
							</div>
						</section>
						<div class="h-8"></div>
					</div>
				</aside>

				<div
					class="flex-1 bg-slate-200/50 dark:bg-black/40 overflow-auto flex justify-center md:py-12 px-0 md:px-4 relative"
					id="preview-panel"
				>
					<div
						id="resume-preview"
						class="a4-preview relative box-border origin-top shadow-none md:shadow-2xl"
					></div>
				</div>

				<button
					onclick="toggleMobileEditor(true)"
					id="mobile-fab"
					class="md:hidden fixed bottom-8 right-6 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-xl flex items-center justify-center z-40 transition-all duration-300 active:scale-95 hover:scale-110 hover:shadow-2xl hover:rotate-12"
				>
					<i class="fas fa-pen text-xl transition-transform duration-300"></i>
				</button>
			</div>
		</div>

		<!-- æ¨¡ç‰ˆé€‰æ‹© Modal -->
		<div id="template-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
			<div
				class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
				onclick="closeTemplateModal()"
			></div>
			<div
				class="relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col border border-slate-200 dark:border-slate-800 transform transition-all overflow-hidden"
			>
				<div
					class="flex justify-between items-center px-5 py-4 border-b border-slate-100 dark:border-slate-800 shrink-0 bg-white dark:bg-slate-900 z-10"
				>
					<h3 class="text-lg font-bold text-slate-900 dark:text-white">
						æ¨¡ç‰ˆåº“
						<span class="hidden sm:inline text-xs font-normal text-slate-500 ml-2">12 æ¬¾ç²¾å¿ƒè®¾è®¡</span>
					</h3>
					<button
						onclick="closeTemplateModal()"
						class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
					>
						<i class="fas fa-times text-lg"></i>
					</button>
				</div>
				<div
					class="p-4 md:p-6 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 bg-slate-50/50 dark:bg-slate-900/50"
					id="template-grid"
				></div>
				<div
					class="p-4 border-t border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900 text-center shrink-0"
				>
					<p class="text-xs text-slate-500">æç¤ºï¼šåˆ‡æ¢æ¨¡ç‰ˆä¸ä¼šä¸¢å¤±æ‚¨çš„å†…å®¹</p>
				</div>
			</div>
		</div>

		<!-- Settings Modal -->
		<div id="settings-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
			<div
				class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
				onclick="closeSettingsModal()"
			></div>
			<div
				class="relative bg-white dark:bg-slate-900 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200 dark:border-slate-800 transform transition-all overflow-hidden"
			>
				<!-- æ ‡é¢˜æ  -->
				<div
					class="flex justify-between items-center px-6 py-4 border-b border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50"
				>
					<div class="flex items-center gap-3">
						<div
							class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"
						>
							<i class="fas fa-cog text-blue-600 dark:text-blue-400"></i>
						</div>
						<h3 class="text-lg font-bold text-slate-900 dark:text-white">ç³»ç»Ÿè®¾ç½®</h3>
					</div>
					<button
						onclick="closeSettingsModal()"
						class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
					>
						<i class="fas fa-times"></i>
					</button>
				</div>

				<!-- å†…å®¹åŒº -->
				<div class="p-6 space-y-5">
					<div>
						<label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">
							Google Gemini API Key <span class="text-red-500">*</span>
						</label>
						<div class="relative">
							<span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none">
								<i class="fas fa-key"></i>
							</span>
							<input
								type="password"
								id="input-api-key"
								class="w-full"
								style="padding-left: 42px !important"
								placeholder="sk-..."
							/>
						</div>
					</div>

					<!-- è¯´æ˜åŒºåŸŸ -->
					<div
						class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800/50 rounded-xl p-4"
					>
						<div class="flex gap-3">
							<div class="text-blue-500 mt-0.5">
								<i class="fas fa-info-circle"></i>
							</div>
							<div class="text-sm">
								<p class="font-medium text-blue-800 dark:text-blue-200 mb-1">ä¸ºä»€ä¹ˆéœ€è¦ API Key?</p>
								<p class="text-blue-700 dark:text-blue-300/80 leading-relaxed">
									é…ç½® API Key åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ AI
									æ™ºèƒ½æ¶¦è‰²åŠŸèƒ½ï¼ŒåŒ…æ‹¬è‡ªåŠ¨ç”Ÿæˆä¸ªäººç®€ä»‹ã€ä¼˜åŒ–å·¥ä½œç»å†æè¿°ç­‰ã€‚ æ‚¨çš„ Key
									ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚
								</p>
							</div>
						</div>
					</div>

					<!-- ç”³è¯·é“¾æ¥ -->
					<a
						href="https://aistudio.google.com/app/apikey"
						target="_blank"
						class="inline-flex items-center gap-1.5 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 transition-colors"
					>
						<i class="fas fa-external-link-alt text-xs"></i>
						è¿˜æ²¡æœ‰ Key? å» Google AI Studio å…è´¹ç”³è¯·
					</a>
				</div>

				<!-- åº•éƒ¨æ“ä½œæ  -->
				<div
					class="px-5 py-4 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50 flex justify-end gap-2"
				>
					<button
						onclick="closeSettingsModal()"
						class="px-4 py-2.5 rounded-lg text-sm font-medium text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors"
					>
						å–æ¶ˆ
					</button>
					<button
						onclick="saveSettings()"
						class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors"
					>
						ä¿å­˜é…ç½®
					</button>
				</div>
			</div>
		</div>

		<!-- Hidden File Input -->
		<input type="file" id="file-import" accept=".json" class="hidden" onchange="handleImportJSON(this)" />

		<!-- Toast æç¤ºæ¡† -->
		<div id="toast-container" class="fixed top-20 right-6 z-[200] flex flex-col gap-3 pointer-events-none"></div>

		<script>
			// --- Toast æç¤ºæ¡† ---
			function showToast(message, type = 'info', title = '', duration = 3000) {
				const container = document.getElementById('toast-container')
				const icons = {
					success: 'fa-check',
					error: 'fa-times',
					warning: 'fa-exclamation',
					info: 'fa-info'
				}
				const titles = {
					success: 'æˆåŠŸ',
					error: 'é”™è¯¯',
					warning: 'è­¦å‘Š',
					info: 'æç¤º'
				}

				const toast = document.createElement('div')
				toast.className = `toast toast-${type} relative`
				toast.innerHTML = `
								<div class="toast-icon"><i class="fas ${icons[type]}"></i></div>
								<div class="toast-content">
									<div class="toast-title">${title || titles[type]}</div>
									<div class="toast-message">${message}</div>
								</div>
								<div class="toast-close" onclick="this.parentElement.remove()"><i class="fas fa-times text-xs"></i></div>
								<div class="toast-progress" style="animation: toastProgress ${duration}ms linear forwards"></div>
							`

				container.appendChild(toast)

				// è§¦å‘åŠ¨ç”»
				requestAnimationFrame(() => {
					toast.classList.add('show')
				})

				// è‡ªåŠ¨ç§»é™¤
				setTimeout(() => {
					toast.classList.remove('show')
					toast.classList.add('hide')
					setTimeout(() => toast.remove(), 400)
				}, duration)

				return toast
			}

			// --- API é…ç½® ---
			const apiKey = ''

			// --- çŠ¶æ€ç®¡ç† ---
			const state = {
				settings: { apiKey: '' },
				template: 'classic',
				zoom: 1,
				style: { color: '#2563eb', font: 'sans', fontSize: 'normal', margins: 'normal', spacing: 'relaxed' },
				photo: {
					src: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?fit=crop&w=500&h=500',
					scale: 1,
					x: 0,
					y: 0
				},
				data: {
					name: 'ææ˜å“²',
					job: 'é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ & UX è®¾è®¡å¸ˆ',
					phone: '138-0000-0000',
					email: 'hello@limingzhe.com',
					location: 'ä¸Šæµ·, ä¸­å›½',
					web: 'limingzhe.design',
					summary:
						'æ‹¥æœ‰5å¹´ä¸°å¯Œç»éªŒçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€å¯è®¿é—®ä¸”è§†è§‰ç²¾ç¾çš„Webåº”ç”¨ã€‚ç²¾é€šReactã€Vueç”Ÿæ€ç³»ç»Ÿï¼Œå¯¹å¾®å‰ç«¯æ¶æ„æœ‰æ·±å…¥ç ”ç©¶ã€‚å…·å¤‡ä¼˜ç§€çš„è®¾è®¡å®¡ç¾ï¼Œè‡´åŠ›äºå¼¥åˆè®¾è®¡ä¸ä»£ç ä¹‹é—´çš„é¸¿æ²Ÿã€‚å–„äºå›¢é˜Ÿåä½œï¼Œæ›¾ä¸»å¯¼å¤šä¸ªç™¾ä¸‡çº§ç”¨æˆ·äº§å“çš„é‡æ„å·¥ä½œã€‚',
					experiences: [
						{
							id: 1,
							role: 'é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ',
							company: 'TechFlow ç§‘æŠ€æœ‰é™å…¬å¸',
							time: '2021 - è‡³ä»Š',
							desc: 'â€¢ ä¸»å¯¼å…¬å¸æ ¸å¿ƒ SaaS å¹³å°çš„é‡æ„ï¼Œå°†é¦–å±åŠ è½½æ—¶é—´å‡å°‘äº† 40%ã€‚\nâ€¢ è®¾è®¡å¹¶å®ç°äº†ä¸€å¥—åŸºäº React çš„å†…éƒ¨ç»„ä»¶åº“ã€‚'
						},
						{
							id: 2,
							role: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ',
							company: 'Creative Web Studio',
							time: '2018 - 2021',
							desc: 'â€¢ è´Ÿè´£å¤šä¸ªç”µå•†å®¢æˆ·çš„è¥é”€æ´»åŠ¨é¡µé¢å¼€å‘ã€‚\nâ€¢ ä¸è®¾è®¡å¸ˆç´§å¯†åˆä½œï¼Œå®Œç¾è¿˜åŸ Figma è®¾è®¡ç¨¿ã€‚'
						}
					],
					education: [{ degree: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ (å­¦å£«)', school: 'ä¸Šæµ·äº¤é€šå¤§å­¦', time: '2014 - 2018' }],
					projects: [
						{
							name: 'Nova åœ¨çº¿ç®€å†',
							role: 'ç‹¬ç«‹å¼€å‘è€…',
							time: '2023',
							desc: 'å¼€å‘äº†ä¸€æ¬¾åŸºäº Tailwind CSS çš„åœ¨çº¿ç®€å†æ„å»ºå™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œ PDF å¯¼å‡ºã€‚é›†æˆäº† Gemini AI è¿›è¡Œæ–‡æœ¬æ¶¦è‰²ã€‚'
						}
					],
					languages: 'ä¸­æ–‡ (Native), English (Professional)',
					certificates: 'AWS Certified Solutions Architect',
					skills: ['JavaScript', 'React', 'Vue.js', 'Tailwind', 'Node.js', 'Figma']
				}
			}

			const colors = [
				{ name: 'Blue', hex: '#2563eb' },
				{ name: 'Indigo', hex: '#4f46e5' },
				{ name: 'Purple', hex: '#9333ea' },
				{ name: 'Pink', hex: '#db2777' },
				{ name: 'Red', hex: '#dc2626' },
				{ name: 'Orange', hex: '#ea580c' },
				{ name: 'Amber', hex: '#d97706' },
				{ name: 'Green', hex: '#16a34a' },
				{ name: 'Teal', hex: '#0d9488' },
				{ name: 'Slate', hex: '#475569' },
				{ name: 'Black', hex: '#000000' }
			]

			// --- æœ¬åœ°å­˜å‚¨ ---
			const STORAGE_KEY = 'nova_cv_data'

			function saveToLocalStorage() {
				const saveData = {
					template: state.template,
					style: state.style,
					photo: state.photo,
					data: state.data,
					settings: state.settings
				}
				try {
					localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData))
				} catch (e) {
					console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', e)
				}
			}

			function loadFromLocalStorage() {
				try {
					const saved = localStorage.getItem(STORAGE_KEY)
					if (saved) {
						const parsed = JSON.parse(saved)
						if (parsed.template) state.template = parsed.template
						if (parsed.style) Object.assign(state.style, parsed.style)
						if (parsed.photo) Object.assign(state.photo, parsed.photo)
						if (parsed.data) Object.assign(state.data, parsed.data)
						if (parsed.settings) Object.assign(state.settings, parsed.settings)
						return true
					}
				} catch (e) {
					console.warn('åŠ è½½æ•°æ®å¤±è´¥:', e)
				}
				return false
			}

			function syncEditorInputs() {
				const nameInput = document.getElementById('input-name')
				const jobInput = document.getElementById('input-job')
				if (nameInput) nameInput.value = state.data.name
				if (jobInput) jobInput.value = state.data.job
				document.getElementById('input-phone').value = state.data.phone
				document.getElementById('input-email').value = state.data.email
				document.getElementById('input-location').value = state.data.location
				document.getElementById('input-web').value = state.data.web
				document.getElementById('input-summary').value = state.data.summary
				document.getElementById('input-skills').value = state.data.skills.join(', ')
				document.getElementById('editor-avatar-preview').src = state.photo.src
			}

			function manualSave() {
				saveToLocalStorage()
				showToast('æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success')
			}

			// --- åˆå§‹åŒ– ---
			window.addEventListener('DOMContentLoaded', () => {
				loadFromLocalStorage()
				renderAllEditors()
				renderColorPicker()
				renderPreview()
				initTemplatesInModal()
				updateActiveTemplateUI()
				syncEditorInputs()
				if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
					document.documentElement.classList.add('dark')
				window.addEventListener('resize', handleResize)
				setTimeout(handleResize, 100)
			})

			function handleResize() {
				const a4 = document.getElementById('resume-preview')
				if (!a4) return
				if (window.innerWidth < 1024) {
					a4.style.transform = 'none'
					a4.style.marginBottom = '0'
					a4.style.marginTop = '0'
				} else {
					a4.style.transform = `scale(${state.zoom})`
					a4.style.marginBottom = '60px'
					a4.style.marginTop = '40px'
				}
			}

			function toggleMobileEditor(show) {
				const editor = document.getElementById('editor-panel')
				const fab = document.getElementById('mobile-fab')
				if (show) {
					editor.style.transform = 'translateX(0)'
					fab.style.opacity = '0'
					fab.style.pointerEvents = 'none'
				} else {
					editor.style.transform = 'translateX(-100%)'
					fab.style.opacity = '1'
					fab.style.pointerEvents = 'auto'
				}
			}

			function renderAllEditors() {
				renderExperienceEditor()
				renderEducationEditor()
				renderProjectEditor()
			}

			// --- API è°ƒç”¨ ---
			async function callGeminiAPI(prompt) {
				const key = state.settings?.apiKey || apiKey
				if (!key) {
					showToast('è¯·å…ˆåœ¨è®¾ç½®ä¸­é…ç½® Gemini API Key', 'warning', 'éœ€è¦é…ç½®')
					openSettingsModal()
					return null
				}
				try {
					const response = await fetch(
						`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`,
						{
							method: 'POST',
							headers: { 'Content-Type': 'application/json' },
							body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
						}
					)
					if (!response.ok) throw new Error(response.statusText)
					const data = await response.json()
					return data.candidates?.[0]?.content?.parts?.[0]?.text
				} catch (error) {
					showToast('AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åé‡è¯•', 'error')
					return null
				}
			}
			async function generateSummary() {
				const btn = document.getElementById('btn-ai-summary')
				const original = btn.innerHTML
				btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ç”Ÿæˆä¸­'
				btn.disabled = true
				const prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç®€å†æ’°å†™ä¸“å®¶ã€‚è¯·ä¸ºä»¥ä¸‹èŒä½ç”Ÿæˆä¸€æ®µä¸“ä¸šçš„ä¸ªäººç®€ä»‹ã€‚

			èŒä½ï¼š${state.data.job}
			æŠ€èƒ½ï¼š${state.data.skills.join('ã€')}

			è¦æ±‚ï¼š
			1. åªè¿”å›çº¯æ–‡æœ¬å†…å®¹ï¼Œä¸è¦ä»»ä½•æ ‡é¢˜ã€æ ¼å¼æ ‡è®°æˆ–è§£é‡Š
			2. 3-4å¥è¯ï¼Œæ§åˆ¶åœ¨100å­—ä»¥å†…
			3. çªå‡ºä¸“ä¸šèƒ½åŠ›å’Œæ ¸å¿ƒä¼˜åŠ¿
			4. è¯­è¨€ç®€æ´æœ‰åŠ›ï¼Œä½“ç°ä¸“ä¸šæ€§

			ç›´æ¥è¾“å‡ºä¸ªäººç®€ä»‹ï¼š`
				const res = await callGeminiAPI(prompt)
				if (res) {
					let cleanText = res.trim()
					cleanText = cleanText.replace(/^[\s\S]*?ç›´æ¥è¾“å‡º.*?[:ï¼š]\s*/i, '')
					cleanText = cleanText.replace(/^#+\s*.*/gm, '')
					cleanText = cleanText.replace(/\*\*/g, '')
					cleanText = cleanText.replace(/`/g, '')
					cleanText = cleanText.trim()
					if (cleanText) {
						updateText('summary', cleanText)
						document.getElementById('input-summary').value = cleanText
						showToast('ç”Ÿæˆå®Œæˆ', 'success')
					}
				}
				btn.innerHTML = original
				btn.disabled = false
			}
			async function optimizeExperience(index) {
				const btn = document.getElementById(`btn-ai-exp-${index}`)
				const original = btn.innerHTML
				btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¤„ç†ä¸­'
				btn.disabled = true
				const prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ç®€å†ä¼˜åŒ–ä¸“å®¶ã€‚è¯·å°†ä»¥ä¸‹å·¥ä½œç»å†æè¿°ä¼˜åŒ–ä¸ºæ›´ä¸“ä¸šã€æ›´æœ‰è¯´æœåŠ›çš„è¡¨è¿°ã€‚

			è¦æ±‚ï¼š
			1. åªè¿”å›ä¼˜åŒ–åçš„çº¯æ–‡æœ¬å†…å®¹ï¼Œä¸è¦ä»»ä½•è§£é‡Šã€æ ‡é¢˜ã€è¡¨æ ¼æˆ–æ ¼å¼æ ‡è®°
			2. ä¿æŒä¸­æ–‡ï¼Œè¯­è¨€ç®€æ´æœ‰åŠ›
			3. çªå‡ºæˆæœå’Œæ•°æ®ï¼ˆå¦‚æœ‰ï¼‰
			4. ä½¿ç”¨åŠ¨è¯å¼€å¤´ï¼Œä½“ç°ä¸»åŠ¨æ€§
			5. æ§åˆ¶åœ¨2-3å¥è¯ä»¥å†…

			åŸæ–‡ï¼š${state.data.experiences[index].desc}

			ç›´æ¥è¾“å‡ºä¼˜åŒ–åçš„æ–‡æœ¬ï¼š`
				const res = await callGeminiAPI(prompt)
				if (res) {
					// æ¸…ç†è¿”å›çš„æ–‡æœ¬ï¼Œç§»é™¤å¯èƒ½çš„ markdown æ ¼å¼
					let cleanText = res.trim()
					cleanText = cleanText.replace(/^[\s\S]*?ç›´æ¥è¾“å‡º.*?[:ï¼š]\s*/i, '')
					cleanText = cleanText.replace(/^#+\s*.*/gm, '')
					cleanText = cleanText.replace(/^\|.*\|$/gm, '')
					cleanText = cleanText.replace(/^[-*]\s+/gm, '')
					cleanText = cleanText.replace(/\*\*/g, '')
					cleanText = cleanText.replace(/`/g, '')
					cleanText = cleanText.trim()
					if (cleanText) {
						updateExp(index, 'desc', cleanText)
						renderExperienceEditor()
						showToast('ä¼˜åŒ–å®Œæˆ', 'success')
					}
				}
				btn.innerHTML = original
				btn.disabled = false
			}

			// --- æ¸²æŸ“å‡½æ•° ---
			function renderExperienceEditor() {
				document.getElementById('experience-editor-list').innerHTML = state.data.experiences
					.map(
						(exp, i) => `
						             <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3 transition-all ${
											exp.visible === false ? 'opacity-50 grayscale' : ''
										}">
						                 <div class="flex justify-between mb-2">
			                                <span class="text-xs font-bold text-slate-400">ç»å† #${i + 1}</span>
			                                <div class="flex gap-2">
			                                    <button onclick="moveItem('experiences', ${i}, -1)" class="text-slate-400 hover:text-blue-500 ${
							i === 0 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${i === 0 ? 'disabled' : ''} title="ä¸Šç§»"><i class="fas fa-arrow-up"></i></button>
			                                    <button onclick="moveItem('experiences', ${i}, 1)" class="text-slate-400 hover:text-blue-500 ${
							i === state.data.experiences.length - 1 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${
							i === state.data.experiences.length - 1 ? 'disabled' : ''
						} title="ä¸‹ç§»"><i class="fas fa-arrow-down"></i></button>
			                                    <button onclick="toggleItemVisibility('experiences', ${i})" class="text-slate-400 hover:text-blue-500" title="${
							exp.visible === false ? 'æ˜¾ç¤º' : 'éšè—'
						}"><i class="fas ${
							exp.visible === false ? 'fa-eye-slash text-slate-300' : 'fa-eye'
						}"></i></button>
			                                    <button onclick="removeExperience(${i})" class="text-slate-400 hover:text-red-500" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
			                                </div>
			                             </div>
						                 <div class="grid grid-cols-2 gap-2 mb-2"><input type="text" placeholder="èŒä½" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs font-bold" value="${
												exp.role
											}" oninput="updateExp(${i}, 'role', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${
							exp.time
						}" oninput="updateExp(${i}, 'time', this.value)"><input type="text" placeholder="å…¬å¸" class="col-span-2 bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${
							exp.company
						}" oninput="updateExp(${i}, 'company', this.value)"></div>
						                 <div><textarea rows="3" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" oninput="updateExp(${i}, 'desc', this.value)">${
							exp.desc
						}</textarea></div>
									<div class="flex justify-end mt-2"><button onclick="optimizeExperience(${i})" id="btn-ai-exp-${i}" class="text-[10px] bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white px-2.5 py-1 rounded shadow hover:opacity-90 transition-opacity flex items-center gap-1"><i class="fas fa-magic"></i> AI æ¶¦è‰²</button></div>
						             </div>`
					)
					.join('')
			}
			function renderEducationEditor() {
				document.getElementById('education-editor-list').innerHTML = state.data.education
					.map(
						(edu, i) => `
						             <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3 transition-all ${
											edu.visible === false ? 'opacity-50 grayscale' : ''
										}">
						                  <div class="flex justify-between mb-2">
			                                <span class="text-xs font-bold text-slate-400">å­¦å† #${i + 1}</span>
			                                <div class="flex gap-2">
			                                    <button onclick="moveItem('education', ${i}, -1)" class="text-slate-400 hover:text-blue-500 ${
							i === 0 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${i === 0 ? 'disabled' : ''} title="ä¸Šç§»"><i class="fas fa-arrow-up"></i></button>
			                                    <button onclick="moveItem('education', ${i}, 1)" class="text-slate-400 hover:text-blue-500 ${
							i === state.data.education.length - 1 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${
							i === state.data.education.length - 1 ? 'disabled' : ''
						} title="ä¸‹ç§»"><i class="fas fa-arrow-down"></i></button>
			                                    <button onclick="toggleItemVisibility('education', ${i})" class="text-slate-400 hover:text-blue-500" title="${
							edu.visible === false ? 'æ˜¾ç¤º' : 'éšè—'
						}"><i class="fas ${
							edu.visible === false ? 'fa-eye-slash text-slate-300' : 'fa-eye'
						}"></i></button>
			                                    <button onclick="removeEducation(${i})" class="text-slate-400 hover:text-red-500" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
			                                </div>
			                              </div>
						                 <input type="text" placeholder="å­¦æ ¡" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs mb-2 font-bold" value="${
												edu.school
											}" oninput="updateEdu(${i}, 'school', this.value)">
						                 <div class="grid grid-cols-2 gap-2"><input type="text" placeholder="å­¦ä½" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${
												edu.degree
											}" oninput="updateEdu(${i}, 'degree', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${
							edu.time
						}" oninput="updateEdu(${i}, 'time', this.value)"></div>
						             </div>`
					)
					.join('')
			}
			function renderProjectEditor() {
				document.getElementById('project-editor-list').innerHTML = state.data.projects
					.map(
						(proj, i) => `
						             <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3 transition-all ${
											proj.visible === false ? 'opacity-50 grayscale' : ''
										}">
						                 <div class="flex justify-between mb-2">
			                                <span class="text-xs font-bold text-slate-400">é¡¹ç›® #${i + 1}</span>
			                                <div class="flex gap-2">
			                                    <button onclick="moveItem('projects', ${i}, -1)" class="text-slate-400 hover:text-blue-500 ${
							i === 0 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${i === 0 ? 'disabled' : ''} title="ä¸Šç§»"><i class="fas fa-arrow-up"></i></button>
			                                    <button onclick="moveItem('projects', ${i}, 1)" class="text-slate-400 hover:text-blue-500 ${
							i === state.data.projects.length - 1 ? 'opacity-30 cursor-not-allowed' : ''
						}" ${
							i === state.data.projects.length - 1 ? 'disabled' : ''
						} title="ä¸‹ç§»"><i class="fas fa-arrow-down"></i></button>
			                                    <button onclick="toggleItemVisibility('projects', ${i})" class="text-slate-400 hover:text-blue-500" title="${
							proj.visible === false ? 'æ˜¾ç¤º' : 'éšè—'
						}"><i class="fas ${
							proj.visible === false ? 'fa-eye-slash text-slate-300' : 'fa-eye'
						}"></i></button>
			                                    <button onclick="removeProject(${i})" class="text-slate-400 hover:text-red-500" title="åˆ é™¤"><i class="fas fa-trash"></i></button>
			                                </div>
			                             </div>
						                 <div class="grid grid-cols-2 gap-2 mb-2"><input type="text" placeholder="é¡¹ç›®å" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs font-bold" value="${
												proj.name
											}" oninput="updateProject(${i}, 'name', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${
							proj.time
						}" oninput="updateProject(${i}, 'time', this.value)"><input type="text" placeholder="è§’è‰²/æŠ€æœ¯" class="col-span-2 bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${
							proj.role
						}" oninput="updateProject(${i}, 'role', this.value)"></div>
						                 <textarea rows="2" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" oninput="updateProject(${i}, 'desc', this.value)">${
							proj.desc
						}</textarea>
						             </div>`
					)
					.join('')
			}

			// --- æ›´æ–°å‡½æ•° ---
			function moveItem(type, index, direction) {
				const items = state.data[type]
				if (direction === -1 && index > 0) {
					;[items[index], items[index - 1]] = [items[index - 1], items[index]]
				} else if (direction === 1 && index < items.length - 1) {
					;[items[index], items[index + 1]] = [items[index + 1], items[index]]
				}
				renderAllEditors()
				renderPreview()
				saveToLocalStorage()
			}

			function toggleItemVisibility(type, index) {
				const item = state.data[type][index]
				item.visible = item.visible === false ? true : false
				renderAllEditors()
				renderPreview()
				saveToLocalStorage()
			}

			function updateText(f, v) {
				state.data[f] = v
				renderPreview()
				saveToLocalStorage()
			}
			function updateContact(f, v) {
				state.data[f] = v
				renderPreview()
				saveToLocalStorage()
			}
			function updateSkills(v) {
				state.data.skills = v.split(',').filter(s => s.trim() !== '')
				renderPreview()
				saveToLocalStorage()
			}
			function updateExp(i, f, v) {
				state.data.experiences[i][f] = v
				renderPreview()
				saveToLocalStorage()
			}
			function addExperience() {
				state.data.experiences.unshift({ role: 'èŒä½', company: 'å…¬å¸', time: 'æ—¶é—´', desc: '' })
				renderExperienceEditor()
				renderPreview()
				saveToLocalStorage()
			}
			function removeExperience(i) {
				if (confirm('åˆ é™¤?')) {
					state.data.experiences.splice(i, 1)
					renderExperienceEditor()
					renderPreview()
					saveToLocalStorage()
				}
			}
			function updateEdu(i, f, v) {
				state.data.education[i][f] = v
				renderPreview()
				saveToLocalStorage()
			}
			function addEducation() {
				state.data.education.unshift({ school: 'å­¦æ ¡', degree: 'å­¦ä½', time: 'æ—¶é—´' })
				renderEducationEditor()
				renderPreview()
				saveToLocalStorage()
			}
			function removeEducation(i) {
				if (confirm('åˆ é™¤?')) {
					state.data.education.splice(i, 1)
					renderEducationEditor()
					renderPreview()
					saveToLocalStorage()
				}
			}
			function updateProject(i, f, v) {
				state.data.projects[i][f] = v
				renderPreview()
				saveToLocalStorage()
			}
			function addProject() {
				state.data.projects.unshift({ name: 'é¡¹ç›®', role: 'è§’è‰²', time: 'æ—¶é—´', desc: '' })
				renderProjectEditor()
				renderPreview()
				saveToLocalStorage()
			}
			function removeProject(i) {
				if (confirm('åˆ é™¤?')) {
					state.data.projects.splice(i, 1)
					renderProjectEditor()
					renderPreview()
					saveToLocalStorage()
				}
			}

			function handlePhotoUpload(input) {
				if (input.files && input.files[0]) {
					const reader = new FileReader()
					reader.onload = function (e) {
						state.photo.src = e.target.result
						document.getElementById('editor-avatar-preview').src = e.target.result
						renderPreview()
						saveToLocalStorage()
					}
					reader.readAsDataURL(input.files[0])
				}
			}
			function updatePhotoStyle(p, v) {
				state.photo[p] = parseFloat(v)
				renderPreview()
				saveToLocalStorage()
			}

			function updateStyle(p, v) {
				state.style[p] = v
				if (p === 'color') {
					renderColorPicker()
					// ä¸»é¢˜è‰²åªå½±å“ç®€å†é¢„è§ˆï¼Œä¸æ”¹å˜ç¼–è¾‘å™¨ UI
				}
				if (p === 'font') {
					// æ›´æ–°å­—ä½“æŒ‰é’®æ ·å¼
					const sansBtn = document.getElementById('font-btn-sans')
					const serifBtn = document.getElementById('font-btn-serif')

					sansBtn.classList.remove('font-btn-primary')
					sansBtn.classList.add('font-btn-secondary')

					serifBtn.classList.remove('font-btn-primary')
					serifBtn.classList.add('font-btn-secondary')

					const activeBtn = document.getElementById(`font-btn-${v}`)
					activeBtn.classList.remove('font-btn-secondary')
					activeBtn.classList.add('font-btn-primary')
				}
				if (['fontSize', 'margins', 'spacing'].includes(p)) {
					const map = { fontSize: 'fs-', margins: 'mg-', spacing: 'sp-' }
					document.querySelectorAll(`[id^="${map[p]}"]`).forEach(b => b.classList.remove('active'))
					document.getElementById(`${map[p]}${v}`).classList.add('active')
				}
				renderPreview()
				saveToLocalStorage()
			}
			function renderColorPicker() {
				document.getElementById('color-picker').innerHTML = colors
					.map(
						c =>
							`<div onclick="updateStyle('color', '${c.hex}')" class="color-option ${
								state.style.color === c.hex ? 'active' : ''
							}" style="background-color: ${c.hex};" title="${c.name}"></div>`
					)
					.join('')
			}
			function setTemplate(t) {
				state.template = t
				updateActiveTemplateUI()
				renderPreview()
				saveToLocalStorage()
			}
			function toggleTheme() {
				document.documentElement.classList.toggle('dark')
			}

			// ä¸‹æ‹‰èœå•æ§åˆ¶
			function toggleActionsDropdown(event) {
				event.stopPropagation()
				const menu = document.getElementById('actions-dropdown-menu')
				menu.classList.toggle('hidden')
				closeMobileMenu() // å…³é—­ç§»åŠ¨ç«¯èœå•
			}
			function closeActionsDropdown() {
				const menu = document.getElementById('actions-dropdown-menu')
				if (menu) menu.classList.add('hidden')
			}

			// ç§»åŠ¨ç«¯èœå•æ§åˆ¶
			function toggleMobileMenu(event) {
				event.stopPropagation()
				const menu = document.getElementById('mobile-menu-dropdown')
				menu.classList.toggle('hidden')
				closeActionsDropdown() // å…³é—­æ¡Œé¢ç«¯èœå•
			}
			function closeMobileMenu() {
				const menu = document.getElementById('mobile-menu-dropdown')
				if (menu) menu.classList.add('hidden')
			}

			// ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ‰€æœ‰ä¸‹æ‹‰èœå•
			document.addEventListener('click', function (event) {
				const actionsContainer = document.getElementById('actions-dropdown-container')
				const mobileContainer = document.getElementById('mobile-menu-container')
				if (actionsContainer && !actionsContainer.contains(event.target)) {
					closeActionsDropdown()
				}
				if (mobileContainer && !mobileContainer.contains(event.target)) {
					closeMobileMenu()
				}
			})

			function changeZoom(d) {
				let z = state.zoom + d
				if (z < 0.3) z = 0.3
				if (z > 1.5) z = 1.5
				state.zoom = z
				document.getElementById('page-zoom-val').innerText = Math.round(z * 100) + '%'
				handleResize()
			}
			function switchTab(t) {
				const c = document.getElementById('panel-content'),
					s = document.getElementById('panel-style')
				const bc = document.getElementById('tab-content'),
					bs = document.getElementById('tab-style')

				// æ·»åŠ æ·¡å‡ºåŠ¨ç”»
				const activePanel = t === 'content' ? s : c
				activePanel.style.opacity = '0'
				activePanel.style.transform = 'translateY(10px)'

				setTimeout(() => {
					if (t === 'content') {
						c.classList.remove('hidden')
						s.classList.add('hidden')
						bc.classList.add('text-blue-600', 'border-blue-600', 'bg-blue-50/50')
						bc.classList.remove('text-slate-500', 'border-transparent')
						bs.classList.remove('text-blue-600', 'border-blue-600', 'bg-blue-50/50')
						bs.classList.add('text-slate-500', 'border-transparent')
					} else {
						s.classList.remove('hidden')
						c.classList.add('hidden')
						bs.classList.add('text-blue-600', 'border-blue-600', 'bg-blue-50/50')
						bs.classList.remove('text-slate-500', 'border-transparent')
						bc.classList.remove('text-blue-600', 'border-blue-600', 'bg-blue-50/50')
						bc.classList.add('text-slate-500', 'border-transparent')
					}

					// æ·¡å…¥æ–°é¢æ¿
					const newPanel = t === 'content' ? c : s
					newPanel.style.opacity = '0'
					newPanel.style.transform = 'translateY(10px)'
					requestAnimationFrame(() => {
						newPanel.style.transition = 'opacity 0.3s ease, transform 0.3s ease'
						newPanel.style.opacity = '1'
						newPanel.style.transform = 'translateY(0)'
					})
				}, 150)
			}
			function printResume() {
				window.focus()
				window.print()
			}

			// --- æ•°æ®ç®¡ç† ---
			function exportJSON() {
				const dataStr = 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(state))
				const downloadAnchorNode = document.createElement('a')
				downloadAnchorNode.setAttribute('href', dataStr)
				downloadAnchorNode.setAttribute('download', 'nova_cv_data.json')
				document.body.appendChild(downloadAnchorNode)
				downloadAnchorNode.click()
				downloadAnchorNode.remove()
				showToast('JSON æ–‡ä»¶å·²å¯¼å‡º', 'success')
			}

			function handleImportJSON(input) {
				const file = input.files[0]
				if (!file) return
				const reader = new FileReader()
				reader.onload = function (e) {
					try {
						const imported = JSON.parse(e.target.result)
						if (imported.data && imported.style) {
							Object.assign(state, imported)
							saveToLocalStorage()
							showToast('ç®€å†æ•°æ®å¯¼å…¥æˆåŠŸ', 'success')
							location.reload()
						} else {
							showToast('æ— æ•ˆçš„ç®€å†æ•°æ®æ–‡ä»¶', 'error')
						}
					} catch (err) {
						showToast('å¯¼å…¥å¤±è´¥: ' + err.message, 'error')
					}
				}
				reader.readAsText(file)
				input.value = ''
			}

			function downloadImage() {
				const element = document.getElementById('resume-preview')
				const btn = document.querySelector('button[onclick="downloadImage()"]')
				const originalText = btn.innerHTML
				btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> å¯¼å‡ºä¸­...'

				html2canvas(element, {
					scale: 2,
					useCORS: true,
					logging: false,
					backgroundColor: '#ffffff'
				})
					.then(canvas => {
						const link = document.createElement('a')
						link.download = `resume_${state.data.name}.png`
						link.href = canvas.toDataURL()
						link.click()
						btn.innerHTML = originalText
						showToast('å›¾ç‰‡å·²å¯¼å‡º', 'success')
					})
					.catch(err => {
						console.error(err)
						showToast('å¯¼å‡ºå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•', 'error')
						btn.innerHTML = originalText
					})
			}

			// --- è®¾ç½®åŠŸèƒ½ ---
			function openSettingsModal() {
				document.getElementById('input-api-key').value = state.settings?.apiKey || ''
				const modal = document.getElementById('settings-modal')
				modal.classList.remove('hidden')

				// æ¨¡æ€æ¡†å…¥åœºåŠ¨ç”»
				const modalContent = modal.querySelector('.relative')
				if (modalContent) {
					modalContent.style.opacity = '0'
					modalContent.style.transform = 'scale(0.9) translateY(-20px)'
					requestAnimationFrame(() => {
						modalContent.style.transition = 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)'
						modalContent.style.opacity = '1'
						modalContent.style.transform = 'scale(1) translateY(0)'
					})
				}
			}
			function closeSettingsModal() {
				const modal = document.getElementById('settings-modal')
				const modalContent = modal.querySelector('.relative')
				if (modalContent) {
					modalContent.style.transition = 'all 0.2s ease'
					modalContent.style.opacity = '0'
					modalContent.style.transform = 'scale(0.9) translateY(-20px)'
				}
				setTimeout(() => {
					modal.classList.add('hidden')
				}, 200)
			}
			function saveSettings() {
				const key = document.getElementById('input-api-key').value.trim()
				if (!state.settings) state.settings = {}
				state.settings.apiKey = key
				saveToLocalStorage()
				closeSettingsModal()
				showToast('è®¾ç½®å·²ä¿å­˜', 'success')
			}

			// --- æ¨¡æ€æ¡† ---
			function openTemplateModal() {
				const modal = document.getElementById('template-modal')
				modal.classList.remove('hidden')
				initTemplatesInModal()
				updateActiveTemplateUI()

				// æ¨¡æ€æ¡†å…¥åœºåŠ¨ç”»
				const modalContent = modal.querySelector('.relative')
				if (modalContent) {
					modalContent.style.opacity = '0'
					modalContent.style.transform = 'scale(0.95) translateY(20px)'
					requestAnimationFrame(() => {
						modalContent.style.transition = 'all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1)'
						modalContent.style.opacity = '1'
						modalContent.style.transform = 'scale(1) translateY(0)'
					})
				}
			}
			function closeTemplateModal() {
				const modal = document.getElementById('template-modal')
				const modalContent = modal.querySelector('.relative')
				if (modalContent) {
					modalContent.style.transition = 'all 0.2s ease'
					modalContent.style.opacity = '0'
					modalContent.style.transform = 'scale(0.95) translateY(20px)'
				}
				setTimeout(() => {
					modal.classList.add('hidden')
					// é‡ç½®æ ·å¼ï¼Œç¡®ä¿ä¸‹æ¬¡æ‰“å¼€æ—¶åŠ¨ç”»æ­£å¸¸
					if (modalContent) {
						modalContent.style.transition = ''
						modalContent.style.opacity = ''
						modalContent.style.transform = ''
					}
				}, 200)
			}
			function selectTemplateAndClose(t) {
				setTemplate(t)
				closeTemplateModal()
			}
			function updateActiveTemplateUI() {
				const map = {
					classic: 'ç»å…¸é£æ ¼',
					modern: 'ç°ä»£æç®€',
					elegant: 'ç®€çº¦å•†åŠ¡',
					creative: 'åˆ›æ„è®¾è®¡',
					compact: 'ç´§å‡‘å­¦æœ¯',
					timeline: 'æ—¶å…‰è½´',
					tech: 'æå®¢ç²¾ç¥',
					right: 'å³ä¾§å¸ƒå±€',
					swiss: 'ç‘å£«é£æ ¼',
					bold: 'é†’ç›®é£æ ¼',
					studio: 'å·¥ä½œå®¤',
					leaf: 'è‡ªç„¶æ¸…æ–°'
				}
				const tmplNameEl = document.getElementById('current-tmpl-name')
				if (tmplNameEl) {
					tmplNameEl.innerText = map[state.template] || map['classic']
				}
				document.querySelectorAll('.template-card').forEach(c => {
					const i = c.querySelector('.check-icon')
					if (i && i.dataset.tmpl === state.template) {
						c.classList.add('active')
						i.classList.remove('opacity-0')
					} else if (i) {
						c.classList.remove('active')
						i.classList.add('opacity-0')
					}
				})
			}

			function initTemplatesInModal() {
				const tmpls = [
					{ id: 'classic', n: 'ç»å…¸é£æ ¼', d: 'ç¨³é‡ä¼ ç»Ÿ' },
					{ id: 'modern', n: 'ç°ä»£æç®€', d: 'é¡¶éƒ¨å¤§æ ‡é¢˜' },
					{ id: 'elegant', n: 'ç®€çº¦å•†åŠ¡', d: 'å•æ å±…ä¸­' },
					{ id: 'timeline', n: 'æ—¶å…‰è½´', d: 'è§†è§‰åŒ–ç»å†' },
					{ id: 'tech', n: 'æå®¢ç²¾ç¥', d: 'ç»ˆç«¯é£æ ¼' },
					{ id: 'right', n: 'å³ä¾§å¸ƒå±€', d: 'æ‰“ç ´å¸¸è§„' },
					{ id: 'swiss', n: 'ç‘å£«é£æ ¼', d: 'ç½‘æ ¼æ’ç‰ˆ' },
					{ id: 'creative', n: 'åˆ›æ„è®¾è®¡', d: 'å‡ ä½•èƒŒæ™¯' },
					{ id: 'compact', n: 'ç´§å‡‘å­¦æœ¯', d: 'é«˜å¯†åº¦' },
					{ id: 'bold', n: 'é†’ç›®é£æ ¼', d: 'è§†è§‰å¼ºçƒˆ' },
					{ id: 'studio', n: 'å·¥ä½œå®¤', d: 'è‰ºæœ¯æ°”æ¯' },
					{ id: 'leaf', n: 'è‡ªç„¶æ¸…æ–°', d: 'æœ‰æœºæ’ç‰ˆ' } // New templates
				]
				document.getElementById('template-grid').innerHTML = tmpls
					.map(
						t =>
							`<div class="template-card group cursor-pointer bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-700 hover:shadow-lg transition-all active:scale-95" onclick="selectTemplateAndClose('${
								t.id
							}')"><div class="mini-preview shadow-sm bg-white relative mb-2 rounded"><div class="mini-preview-inner" id="preview-${
								t.id
							}"></div></div><div class="flex justify-between items-center px-1"><div><h4 class="font-bold text-slate-800 dark:text-slate-200 text-xs">${
								t.n
							}</h4><p class="text-[10px] text-slate-400">${
								t.d
							}</p></div><div class="w-5 h-5 rounded-full border-2 border-slate-300 dark:border-slate-600 flex items-center justify-center text-white opacity-0 group-hover:opacity-100 check-icon transition-all" style="background-color: ${
								state.template === t.id ? '#2563eb' : 'transparent'
							}; border-color: ${state.template === t.id ? '#2563eb' : ''}" data-tmpl="${
								t.id
							}"><i class="fas fa-check text-[10px]"></i></div></div></div>`
					)
					.join('')

				// æ¸²æŸ“æ¯ä¸ªæ¨¡ç‰ˆçš„çœŸå®é¢„è§ˆ
				tmpls.forEach(t => {
					const previewEl = document.getElementById(`preview-${t.id}`)
					if (previewEl) {
						previewEl.innerHTML = generateTemplateHTML(t.id)
					}
				})
			}

			// ç”ŸæˆæŒ‡å®šæ¨¡ç‰ˆçš„ HTMLï¼ˆç”¨äºç¼©ç•¥å›¾é¢„è§ˆï¼‰
			function generateTemplateHTML(templateId) {
				const { data, photo, style } = state
				const color = style.color
				let font = style.font === 'serif' ? 'font-serif' : templateId === 'tech' ? 'font-mono' : 'font-sans'
				const imgStyle = `transform: translate(${photo.x}px, ${photo.y}px) scale(${photo.scale});`
				const base = `h-full min-h-[297mm] bg-white text-slate-800 ${font}`
				const pad = 'p-10'
				const tBase = 'text-xs'
				const tTitle = 'text-sm'
				const lead = 'leading-relaxed'

				const summary = data.summary.replace(/\n/g, '<br>')
				const skills = data.skills
					.map(
						s =>
							`<span class="inline-block bg-slate-100 text-slate-700 px-2 py-1 rounded ${tBase} font-medium mb-1">${s.trim()}</span>`
					)
					.join('')

				const list = items =>
					items
						.filter(i => i.visible !== false)
						.map(
							i =>
								`<div class="mb-3"><div class="flex justify-between items-baseline mb-0.5"><h3 class="font-bold text-slate-900 ${tTitle}">${
									i.role || i.degree || i.name
								}</h3><span class="${tBase} text-slate-500">${
									i.time
								}</span></div><div class="${tBase} font-medium mb-1" style="color:${color}">${
									i.company || i.school || i.role
								}</div>${
									i.desc ? `<div class="${tBase} text-slate-600 ${lead}">${i.desc}</div>` : ''
								}</div>`
						)
						.join('')

				const simple = items =>
					items
						.filter(i => i.visible !== false)
						.map(
							i =>
								`<div class="mb-2"><div class="flex justify-between items-baseline"><h3 class="font-bold text-slate-900 ${tBase}">${
									i.school || i.name
								}</h3><span class="${tBase} text-slate-500">${
									i.time
								}</span></div><div class="${tBase} text-slate-600">${i.degree || i.role}</div></div>`
						)
						.join('')

				// ç®€åŒ–ç‰ˆæ¨¡ç‰ˆ HTML
				if (templateId === 'classic') {
					return `<div class="${base} grid grid-cols-12"><div class="col-span-4 text-white p-8 flex flex-col" style="background-color: ${color}"><div class="w-32 h-32 rounded-full ring-4 ring-white/20 mx-auto mb-6 bg-white/10 overflow-hidden"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="space-y-6"><div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Contact</h4><div class="space-y-1 ${tBase}">${
						data.phone
					}<br>${data.email}<br>${
						data.location
					}</div></div><div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Skills</h4><div class="flex flex-wrap gap-1">${data.skills
						.map(s => `<span class="bg-white/20 px-2 py-1 rounded text-[10px]">${s}</span>`)
						.join(
							''
						)}</div></div></div></div><div class="col-span-8 ${pad} bg-white"><header class="mb-6 border-b pb-6"><h1 class="text-3xl font-bold mb-2">${
						data.name
					}</h1><p class="${tTitle} font-medium" style="color:${color}">${
						data.job
					}</p></header><section class="mb-6"><h2 class="${tTitle} font-bold uppercase mb-3">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-3">Experience</h2>${list(
						data.experiences
					)}</section></div></div>`
				}
				if (templateId === 'modern') {
					return `<div class="${base} ${pad}"><header class="flex items-center gap-6 mb-8 border-b-2 pb-8" style="border-color: ${color}"><div class="w-24 h-24 rounded-full bg-slate-100 overflow-hidden"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-4xl font-black mb-1">${
						data.name
					}</h1><p class="text-lg font-medium" style="color:${color}">${
						data.job
					}</p><div class="${tBase} mt-2 text-slate-500">${data.phone} | ${
						data.email
					}</div></div></header><div class="grid grid-cols-3 gap-8"><div class="col-span-2 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Experience</h2>${list(
						data.experiences
					)}</section></div><div class="col-span-1 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Skills</h2>${skills}</section></div></div></div>`
				}
				if (templateId === 'elegant') {
					return `<div class="${base} ${pad}"><header class="text-center mb-8 pb-6 border-b border-slate-300"><div class="w-20 h-20 rounded-full mx-auto mb-3 bg-slate-100 overflow-hidden border border-slate-200"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><h1 class="text-3xl font-bold mb-1 tracking-wide">${
						data.name
					}</h1><p class="${tTitle} italic mb-3" style="color: ${color}">${
						data.job
					}</p><div class="flex justify-center gap-3 ${tBase} text-slate-500">${data.phone} â€¢ ${
						data.email
					}</div></header><section class="mb-6"><h2 class="${tTitle} font-bold border-b border-slate-800 pb-1 mb-3">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold border-b border-slate-800 pb-1 mb-3">Experience</h2>${list(
						data.experiences
					)}</section></div>`
				}
				if (templateId === 'timeline') {
					return `<div class="${base} ${pad}"><header class="flex items-center gap-8 mb-12"><div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><div><h1 class="text-4xl font-bold mb-2">${
						data.name
					}</h1><p class="text-xl font-medium" style="color: ${color}">${
						data.job
					}</p></div></header><div class="flex gap-12"><div class="w-1/3 space-y-8"><section><h3 class="font-bold uppercase mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Profile</h3><p class="${tBase} ${lead} text-slate-600">${summary}</p></section></div><div class="w-2/3"><h3 class="font-bold uppercase mb-6 border-b-2 pb-1 inline-block" style="border-color: ${color}">Experience</h3><div class="border-l-2 border-slate-200 ml-3 pl-8">${list(
						data.experiences
					)}</div></div></div></div>`
				}
				if (templateId === 'tech') {
					return `<div class="${base} bg-slate-50"><header class="bg-slate-900 text-white p-8"><h1 class="text-3xl font-bold tracking-tighter text-green-400 font-mono">&lt;${
						data.name
					} /&gt;</h1><p class="text-sm text-slate-400 font-mono">// ${
						data.job
					}</p></header><div class="p-8 grid grid-cols-3 gap-6"><div class="col-span-2 space-y-6"><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="${tTitle} font-bold uppercase mb-3 tracking-widest"><i class="fas fa-terminal" style="color: ${color}"></i> Experience</h2>${list(
						data.experiences
					)}</section></div><div class="col-span-1 space-y-6"><div class="w-full aspect-square rounded-full bg-white border border-slate-200 p-2 shadow-sm overflow-hidden"><img src="${
						photo.src
					}" class="w-full h-full object-cover grayscale" style="${imgStyle}"></div><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="text-xs font-bold uppercase mb-3 tracking-widest">Stack</h2><div class="flex flex-wrap gap-2">${data.skills
						.map(
							s => `<span class="bg-slate-900 text-green-400 px-2 py-1 text-[10px] font-mono">${s}</span>`
						)
						.join('')}</div></section></div></div></div>`
				}
				if (templateId === 'right') {
					return `<div class="${base} grid grid-cols-12"><div class="col-span-8 p-10 bg-white"><header class="mb-8 border-b border-slate-100 pb-6"><h1 class="text-3xl font-bold mb-2">${
						data.name
					}</h1><p class="${tTitle} font-medium" style="color:${color}">${
						data.job
					}</p></header><section class="mb-8"><h2 class="${tTitle} font-bold uppercase mb-3">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-4">Experience</h2>${list(
						data.experiences
					)}</section></div><div class="col-span-4 bg-slate-50 border-l border-slate-200 p-8 flex flex-col"><div class="w-32 h-32 rounded-full ring-4 ring-white shadow-lg mx-auto mb-6 overflow-hidden bg-white"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="space-y-8"><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Contact</h4><div class="${tBase} text-slate-600">${
						data.phone
					}<br>${data.email}</div></div></div></div></div>`
				}
				if (templateId === 'swiss') {
					return `<div class="${base} ${pad} bg-white"><header class="mb-12 flex items-start gap-6"><div class="w-20 h-20 rounded-full bg-slate-100 overflow-hidden border-2 border-slate-200"><img src="${photo.src}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-5xl font-black tracking-tighter leading-none mb-2">${data.name}</h1><div class="w-20 h-2 mb-4" style="background-color: ${color}"></div><p class="text-lg font-bold text-slate-500 uppercase tracking-widest">${data.job}</p></div></header><div class="grid grid-cols-4 gap-8 border-t-4 pt-8" style="border-color: ${color}"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase">About</h3></div><div class="col-span-3"><p class="${tBase} ${lead}">${summary}</p></div></div></div>`
				}
				if (templateId === 'creative') {
					return `<div class="${base} flex flex-col relative"><div class="absolute top-0 right-0 w-1/2 h-48" style="background: linear-gradient(to bottom left, ${color}15 0%, ${color}15 50%, transparent 50%);"></div><header class="${pad} pb-0 relative z-10 flex justify-between items-end mb-12"><div><h1 class="text-5xl font-black mb-2 tracking-tight">${data.name}</h1><p class="text-xl font-medium text-slate-500">${data.job}</p></div><div class="w-32 h-32 rounded-full shadow-xl overflow-hidden bg-white ring-4 ring-white"><img src="${photo.src}" class="w-full h-full object-cover" style="${imgStyle}"></div></header><div class="${pad} pt-0 grid grid-cols-12 gap-10"><div class="col-span-4 space-y-10"><div class="bg-slate-50 p-6 rounded-xl border-l-4" style="border-color: ${color}"><h3 class="${tTitle} font-bold uppercase mb-4 text-slate-400">Contact</h3><div class="${tBase} text-slate-600">${data.phone}<br>${data.email}</div></div></div><div class="col-span-8 space-y-10"><section><h3 class="${tTitle} font-bold uppercase mb-4 text-slate-400">About Me</h3><p class="${tBase} ${lead}">${summary}</p></section></div></div></div>`
				}
				if (templateId === 'compact') {
					return `<div class="${base} ${pad}"><header class="border-b border-black pb-4 mb-4 flex flex-col items-center"><div class="w-16 h-16 rounded-full bg-slate-100 overflow-hidden mb-2 border border-slate-200"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><h1 class="text-2xl font-bold uppercase text-center mb-2">${
						data.name
					}</h1><div class="text-center text-sm">${data.phone} ${
						data.email
					}</div></header><section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Summary</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Experience</h2>${list(
						data.experiences
					)}</section></div>`
				}
				if (templateId === 'bold') {
					return `<div class="${base} bg-white flex flex-col"><header class="${pad} text-white flex items-center gap-8" style="background-color: ${color}"><div class="w-32 h-32 rounded-full ring-4 ring-white/30 overflow-hidden bg-white/10"><img src="${photo.src}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-5xl font-bold mb-2 tracking-tight">${data.name}</h1><p class="text-xl opacity-90 font-medium uppercase">${data.job}</p></div></header><div class="flex-1 ${pad} grid grid-cols-12 gap-10"><div class="col-span-4 space-y-8 border-r border-slate-100 pr-6"><div class="${tBase}">${data.phone}<br>${data.email}</div></div><div class="col-span-8 space-y-8"><section><h3 class="${tTitle} font-bold uppercase mb-4">Profile</h3><p class="${tBase} ${lead}">${summary}</p></section></div></div></div>`
				}
				if (templateId === 'studio') {
					return `<div class="${base} flex flex-col bg-slate-50"><header class="bg-white p-12 shadow-sm flex items-start gap-8"><div class="w-32 h-32 rounded-lg shadow-lg overflow-hidden"><img src="${
						photo.src
					}" class="w-full h-full object-cover" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-4xl font-bold text-slate-900 mb-2">${
						data.name
					}</h1><p class="text-xl font-medium mb-4" style="color: ${color}">${
						data.job
					}</p><div class="flex gap-4 text-sm text-slate-500"><span>${data.email}</span><span>${
						data.phone
					}</span></div></div></header><div class="flex-1 p-12 grid grid-cols-3 gap-10"><div class="col-span-2 space-y-10"><section><h3 class="text-lg font-bold uppercase mb-6">About Me</h3><p class="${tBase} ${lead} text-slate-600">${summary}</p></section></div><div class="col-span-1"><section class="bg-white p-6 rounded-xl shadow-sm"><h3 class="font-bold uppercase mb-4 text-slate-400 text-xs">Skills</h3><div class="flex flex-wrap gap-2">${data.skills
						.map(
							s =>
								`<span class="bg-slate-50 text-slate-700 px-3 py-1.5 rounded-md text-xs border border-slate-100">${s}</span>`
						)
						.join('')}</div></section></div></div></div>`
				}
				if (templateId === 'leaf') {
					return `<div class="${base} bg-white relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-2" style="background-color: ${color}"></div><header class="${pad} pb-0 text-center"><div class="w-28 h-28 rounded-full mx-auto mb-6 border-4 border-white shadow-lg overflow-hidden bg-white"><img src="${photo.src}" class="w-full h-full object-cover" style="${imgStyle}"></div><h1 class="text-4xl font-serif font-bold text-slate-800 mb-2">${data.name}</h1><p class="text-lg font-medium italic mb-6" style="color: ${color}">${data.job}</p><div class="flex justify-center gap-6 text-sm text-slate-500 border-t border-b border-slate-100 py-4 max-w-2xl mx-auto">${data.email} â€¢ ${data.phone}</div></header><div class="${pad}"><p class="${tBase} ${lead} text-center max-w-3xl mx-auto text-slate-600 mb-10">${summary}</p></div></div>`
				}

				// é»˜è®¤
				return `<div class="${base} ${pad}"><h1 class="text-4xl font-bold">${data.name}</h1><p class="text-xl text-slate-600">${data.job}</p></div>`
			}

			// --- æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ ---
			function renderPreview() {
				const c = document.getElementById('resume-preview')
				const { data, photo, template, style } = state
				const color = style.color
				let font = style.font === 'serif' ? 'font-serif' : template === 'tech' ? 'font-mono' : 'font-sans'

				let tBase =
					style.fontSize === 'small' ? 'text-[10px]' : style.fontSize === 'large' ? 'text-sm' : 'text-xs'
				let tTitle =
					style.fontSize === 'small' ? 'text-xs' : style.fontSize === 'large' ? 'text-base' : 'text-sm'
				let lead =
					style.spacing === 'tight'
						? 'leading-snug'
						: style.spacing === 'normal'
						? 'leading-normal'
						: 'leading-relaxed'
				let pad = style.margins === 'narrow' ? 'p-6' : style.margins === 'wide' ? 'p-16' : 'p-10'
				if (window.innerWidth < 768) {
					pad = 'p-5'
				} // Mobile override

				const summary = data.summary.replace(/\n/g, '<br>')
				const skills = data.skills
					.map(
						s =>
							`<span class="inline-block bg-slate-100 text-slate-700 px-2 py-1 rounded ${tBase} font-medium mb-1 print:bg-slate-100 print:text-black">${s.trim()}</span>`
					)
					.join('')
				const formatDescAsList = desc => {
					if (!desc) return ''
					const lines = desc.split('\n').filter(line => line.trim())
					if (lines.length <= 1) {
						return `<ul class="${tBase} text-slate-600 ${lead} list-disc list-inside ml-1"><li>${desc.trim()}</li></ul>`
					}
					return `<ul class="${tBase} text-slate-600 ${lead} list-disc list-inside ml-1">${lines
						.map(line => `<li>${line.trim()}</li>`)
						.join('')}</ul>`
				}
				const list = items =>
					items
						.filter(i => i.visible !== false)
						.map(
							i =>
								`<div class="mb-3 break-inside-avoid"><div class="flex justify-between items-baseline mb-0.5"><h3 class="font-bold text-slate-900 ${tTitle}">${
									i.role || i.degree || i.name
								}</h3><span class="${tBase} text-slate-500 whitespace-nowrap">${
									i.time
								}</span></div><div class="${tBase} font-medium mb-1" style="color:${color}">${
									i.company || i.school || i.role
								}</div>${i.desc ? formatDescAsList(i.desc) : ''}</div>`
						)
						.join('')
				const simple = items =>
					items
						.filter(i => i.visible !== false)
						.map(
							i =>
								`<div class="mb-2 break-inside-avoid"><div class="flex justify-between items-baseline"><h3 class="font-bold text-slate-900 ${tBase}">${
									i.school || i.name
								}</h3><span class="${tBase} text-slate-500">${
									i.time
								}</span></div><div class="${tBase} text-slate-600">${i.degree || i.role}</div></div>`
						)
						.join('')
				const imgStyle = `transform: translate(${photo.x}px, ${photo.y}px) scale(${photo.scale});`

				// Base container class - Mobile Stack / Desktop Grid
				const base = `h-full min-h-[297mm] bg-white text-slate-800 ${font}`

				let html = ''

				if (template === 'classic') {
					html = `<div class="${base} grid grid-cols-1 md:grid-cols-12">
						                 <div class="col-span-1 md:col-span-4 text-white p-6 md:p-8 flex flex-col print-adjust-color" style="background-color: ${color}; min-height: auto md:min-height: 100%;">
						                     <div class="avatar-crop-container w-24 h-24 md:w-32 md:h-32 rounded-full ring-4 ring-white/20 mx-auto mb-6 relative bg-white/10"><img src="${
													photo.src
												}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                     <div class="space-y-6">
						                         <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Contact</h4><div class="space-y-1 ${tBase}">${
						data.phone
					}<br>${data.email}<br>${data.location}<br>${data.web}</div></div>
						                         <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Education</h4><div class="space-y-3">${data.education
						.map(
							e =>
								`<div><div class="font-bold">${e.school}</div><div class="opacity-75 text-[10px]">${e.time}</div><div class="text-[11px]">${e.degree}</div></div>`
						)
						.join('')}</div></div>
						                         <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Skills</h4><div class="flex flex-wrap gap-1">${data.skills
						.map(s => `<span class="bg-white/20 px-2 py-1 rounded text-[10px]">${s}</span>`)
						.join('')}</div></div>
						                         ${
														data.languages || data.certificates
															? `<div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Misc</h4><div class="space-y-1 ${tBase}">${data.languages}<br>${data.certificates}</div></div>`
															: ''
													}
						                     </div>
						                 </div>
						                 <div class="col-span-1 md:col-span-8 ${pad} bg-white">
						                     <header class="mb-6 border-b pb-6"><h1 class="text-3xl font-bold mb-2">${
													data.name
												}</h1><p class="${tTitle} font-medium" style="color:${color}">${
						data.job
					}</p></header>
						                     <div class="space-y-6"><section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Experience</h2>${list(
						data.experiences
					)}</section>${
						data.projects.length
							? `<section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Projects</h2>${list(
									data.projects
							  )}</section>`
							: ''
					}</div>
						                 </div>
						             </div>`
				} else if (template === 'modern') {
					html = `<div class="${base} ${pad}">
						                  <header class="flex items-center gap-6 mb-8 border-b-2 pb-8" style="border-color: ${color}">
						                     <div class="avatar-crop-container w-20 h-20 md:w-24 md:h-24 rounded-full bg-slate-100 overflow-hidden relative flex-shrink-0"><img src="${
													photo.src
												}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                     <div class="flex-1"><h1 class="text-3xl md:text-4xl font-black mb-1">${
													data.name
												}</h1><p class="text-lg font-medium" style="color:${color}">${
						data.job
					}</p><div class="${tBase} mt-2 text-slate-500">${data.phone} | ${data.email} | ${
						data.location
					}</div></div>
						                 </header>
						                 <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
						                     <div class="col-span-1 md:col-span-2 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Experience</h2>${list(
						data.experiences
					)}</section>${
						data.projects.length
							? `<section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Projects</h2>${list(
									data.projects
							  )}</section>`
							: ''
					}</div>
						                     <div class="col-span-1 md:col-span-1 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Skills</h2>${skills}</section><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Education</h2>${simple(
						data.education
					)}</section>${
						data.languages || data.certificates
							? `<section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Misc</h2><div class="${tBase} text-slate-600">${data.languages}<br>${data.certificates}</div></section>`
							: ''
					}</div>
						                 </div>
						             </div>`
				} else if (template === 'elegant') {
					html = `<div class="${base} ${pad}">
						                 <header class="text-center mb-8 pb-6 border-b border-slate-300">
						                      <div class="avatar-crop-container w-20 h-20 rounded-full mx-auto mb-3 bg-slate-100 overflow-hidden relative border border-slate-200"><img src="${
													photo.src
												}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                     <h1 class="text-3xl font-bold mb-1 tracking-wide">${
													data.name
												}</h1><p class="${tTitle} italic mb-3 font-sans" style="color: ${color}">${
						data.job
					}</p>
						                     <div class="flex justify-center flex-wrap gap-3 ${tBase} font-sans text-slate-500 uppercase tracking-widest">${
						data.phone
					} â€¢ ${data.email} â€¢ ${data.location}</div>
						                 </header>
						                 <div class="space-y-6 font-sans">
						                     <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Profile</h2><p class="${tBase} ${lead} text-slate-700 text-justify">${summary}</p></section>
						                     <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Experience</h2>${list(
						data.experiences
					)}</section>
						                     <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
						                         <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Education</h2>${simple(
						data.education
					)}</section>
						                         <div class="space-y-6"><section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Skills</h2><div class="flex flex-wrap gap-2 text-xs">${data.skills
						.map(s => `<span class="border-b border-slate-200 pb-0.5">${s}</span>`)
						.join('')}</div></section>${
						data.languages || data.certificates
							? `<section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Misc</h2><div class="${tBase} text-slate-700">${data.languages}<br>${data.certificates}</div></section>`
							: ''
					}</div>
						                     </div>
						                 </div>
						             </div>`
				} else if (template === 'timeline') {
					html = `<div class="${base} flex flex-col h-full ${pad}">
						                 <header class="flex items-center gap-8 mb-12"><div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg shrink-0 relative"><img src="${
												photo.src
											}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div><h1 class="text-4xl font-bold text-slate-800 mb-2">${
						data.name
					}</h1><p class="text-xl font-medium" style="color: ${color}">${
						data.job
					}</p><div class="mt-4 ${tBase} text-slate-500">${data.phone} | ${data.email} | ${
						data.location
					}</div></div></header>
						                 <div class="flex flex-col md:flex-row gap-12 flex-1">
						                     <div class="w-full md:w-1/3 space-y-8 md:border-r border-slate-100 md:pr-8"><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Profile</h3><p class="${tBase} ${lead} text-slate-600">${summary}</p></section><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Education</h3>${simple(
						data.education
					)}</section><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Skills</h3><div class="flex flex-wrap gap-2">${data.skills
						.map(s => `<span class="bg-slate-100 px-2 py-1 rounded text-[10px]">${s}</span>`)
						.join('')}</div></section></div>
						                     <div class="w-full md:w-2/3 space-y-8"><h3 class="font-bold uppercase tracking-wider mb-6 border-b-2 pb-1 inline-block" style="border-color: ${color}">Experience</h3><div class="relative border-l-2 border-slate-200 ml-3 space-y-10 pl-8 pb-4">${list(
						data.experiences
					)}</div></div>
						                 </div>
						             </div>`
				} else if (template === 'tech') {
					html = `<div class="${base} bg-slate-50 min-h-[297mm]">
						                 <header class="bg-slate-900 text-white p-8 print-adjust-color"><div class="flex justify-between items-start"><div><h1 class="text-3xl font-bold mb-1 tracking-tighter text-green-400 font-mono">&lt;${
												data.name
											} /&gt;</h1><p class="text-sm text-slate-400 font-mono"> // ${
						data.job
					}</p></div><div class="text-right text-[10px] font-mono text-slate-400 space-y-0.5 print:text-white">${
						data.email
					}<div>${data.phone}</div></div></div></header>
						                 <div class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
						                     <div class="col-span-1 md:col-span-2 space-y-6"><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 tracking-widest flex items-center gap-2"><i class="fas fa-terminal" style="color: ${color}"></i> Experience</h2>${list(
						data.experiences
					)}</section><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 tracking-widest flex items-center gap-2"><i class="fas fa-code" style="color: ${color}"></i> Summary</h2><p class="${tBase} ${lead} text-slate-600 font-sans text-justify">${summary}</p></section></div>
						                     <div class="col-span-1 space-y-6"><div class="avatar-crop-container w-full aspect-square rounded-full bg-white border border-slate-200 p-2 shadow-sm mb-2 overflow-hidden relative"><img src="${
													photo.src
												}" class="w-full h-full object-cover grayscale absolute top-0 left-0" style="${imgStyle}"></div><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="text-xs font-bold text-slate-900 uppercase mb-3 tracking-widest">Stack</h2><div class="flex flex-wrap gap-2">${data.skills
						.map(
							s =>
								`<span class="bg-slate-900 text-green-400 px-2 py-1 text-[10px] font-mono border border-slate-700">${s}</span>`
						)
						.join(
							''
						)}</div></section><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="text-xs font-bold text-slate-900 uppercase mb-3 tracking-widest">Education</h2>${simple(
						data.education
					)}</section></div>
						                 </div>
						             </div>`
				} else if (template === 'right') {
					html = `<div class="${base} grid grid-cols-1 md:grid-cols-12 min-h-screen">
						                 <div class="col-span-1 md:col-span-8 p-10 bg-white text-slate-800"><header class="mb-8 border-b border-slate-100 pb-6"><h1 class="text-3xl font-bold mb-2">${
												data.name
											}</h1><p class="${tTitle} font-medium" style="color:${color}">${
						data.job
					}</p></header><section class="mb-8"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 rounded-sm" style="background-color: ${color}"></span> Profile</h2><p class="${tBase} ${lead} text-slate-600 text-justify">${summary}</p></section><section><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-4 flex items-center gap-2"><span class="w-1 h-4 rounded-sm" style="background-color: ${color}"></span> Experience</h2>${list(
						data.experiences
					)}</section></div>
						                 <div class="col-span-1 md:col-span-4 bg-slate-50 border-l border-slate-200 p-8 flex flex-col print-adjust-color print:h-full"><div class="avatar-crop-container w-32 h-32 rounded-full ring-4 ring-white shadow-lg mx-auto mb-6 relative bg-white"><img src="${
												photo.src
											}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div class="space-y-8"><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Contact</h4><div class="space-y-2 ${tBase} text-slate-600">${
						data.phone
					}<br>${data.email}<br>${
						data.location
					}</div></div><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Education</h4>${simple(
						data.education
					)}</div><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Skills</h4><div class="flex flex-wrap gap-1">${data.skills
						.map(
							s =>
								`<span class="bg-white text-slate-600 text-[10px] px-2 py-1 rounded border border-slate-200 shadow-sm">${s}</span>`
						)
						.join('')}</div></div></div></div>
						             </div>`
				} else if (template === 'swiss') {
					html = `<div class="${base} ${pad} bg-white">
						                 <header class="mb-12 flex items-start gap-6"><div class="avatar-crop-container w-20 h-20 rounded-full bg-slate-100 overflow-hidden relative flex-shrink-0 border-2 border-slate-200"><img src="${
												photo.src
											}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-5xl font-black tracking-tighter leading-none mb-2">${
						data.name
					}</h1><div class="w-20 h-2 bg-black mb-4" style="background-color: ${color}"></div><div class="flex justify-between items-end"><p class="text-lg font-bold text-slate-500 uppercase tracking-widest">${
						data.job
					}</p><div class="text-right text-xs font-bold text-slate-900 space-y-1">${data.phone}<br>${
						data.email
					}</div></div></div></header>
						                 <div class="grid grid-cols-4 gap-8 border-t-4 border-black pt-8" style="border-color: ${color}"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">About</h3></div><div class="col-span-3"><p class="${tBase} ${lead} font-medium text-justify">${summary}</p></div></div>
						                 <div class="grid grid-cols-4 gap-8 border-t border-slate-200 pt-8 mt-8"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">Experience</h3></div><div class="col-span-3 space-y-8">${list(
						data.experiences
					)}</div></div>
						                 <div class="grid grid-cols-4 gap-8 border-t border-slate-200 pt-8 mt-8"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">Skills</h3></div><div class="col-span-3"><div class="grid grid-cols-3 gap-x-4 gap-y-2">${data.skills
						.map(s => `<div class="${tBase} font-bold border-b border-slate-100 pb-1">${s}</div>`)
						.join('')}</div></div></div>
						             </div>`
				} else if (template === 'creative') {
					// è®¡ç®—æµ…è‰²ç‰ˆæœ¬çš„ä¸»é¢˜è‰²ç”¨äºèƒŒæ™¯è£…é¥°
					const lightColor = color + '15'
					html = `<div class="${base} flex flex-col h-full relative">
						                 <div class="absolute top-0 right-0 w-1/2 h-48" style="background: linear-gradient(to bottom left, ${lightColor} 0%, ${lightColor} 50%, transparent 50%); z-index: 0;"></div>
						                 <header class="${pad} pb-0 relative z-10 flex justify-between items-end mb-12"><div><h1 class="text-5xl font-black mb-2 tracking-tight leading-none">${
						data.name
					}</h1><p class="text-xl font-medium text-slate-500 tracking-wide">${
						data.job
					}</p></div><div class="avatar-crop-container w-32 h-32 rounded-full shadow-xl shrink-0 overflow-hidden relative bg-white ring-4 ring-white"><img src="${
						photo.src
					}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div></header>
						                 <div class="${pad} pt-0 grid grid-cols-1 md:grid-cols-12 gap-10 flex-1 relative z-10"><div class="col-span-1 md:col-span-4 space-y-10"><div class="bg-slate-50 p-6 rounded-xl border-l-4" style="border-color: ${color}"><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Contact</h3><div class="space-y-3 ${tBase} text-slate-600">${
						data.phone
					}<br>${data.email}<br>${
						data.location
					}</div></div><div><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Skills</h3><div class="flex flex-wrap gap-2">${data.skills
						.map(
							s =>
								`<span class="bg-white border border-slate-200 px-3 py-1.5 rounded-full ${tBase} font-medium shadow-sm">${s}</span>`
						)
						.join(
							''
						)}</div></div><div><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Education</h3>${simple(
						data.education
					)}</div></div><div class="col-span-1 md:col-span-8 space-y-10"><section><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">About Me</h3><p class="${tBase} ${lead} text-slate-700">${summary}</p></section><section><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-6">Experience</h3><div class="space-y-8 border-l-2 border-slate-100 pl-6 ml-2">${list(
						data.experiences
					)}</div></section></div></div>
						             </div>`
				} else if (template === 'compact') {
					html = `<div class="${base} ${pad} text-black">
						                 <header class="border-b border-black pb-4 mb-4 flex flex-col items-center"><div class="avatar-crop-container w-16 h-16 rounded-full bg-slate-100 overflow-hidden relative mb-2 border border-slate-200"><img src="${
												photo.src
											}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><h1 class="text-2xl font-bold uppercase text-center mb-2 tracking-wide">${
						data.name
					}</h1><div class="text-center text-sm flex justify-center flex-wrap gap-4">${data.phone} ${
						data.email
					} ${data.location}</div></header>
						                 <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Summary</h2><p class="${tBase} ${lead} text-justify">${summary}</p></section>
						                 <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Experience</h2><div class="space-y-3">${list(
						data.experiences
					)}</div></section>
						                 <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Education</h2>${simple(
						data.education
					)}</section>
						                 <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Skills</h2><p class="${tBase} leading-snug">${data.skills.join(
						', '
					)}</p></section>
						             </div>`
				} else if (template === 'bold') {
					html = `<div class="${base} bg-white h-full flex flex-col">
						                     <header class="${pad} text-white print-adjust-color flex items-center gap-8" style="background-color: ${color}">
						                          <div class="avatar-crop-container w-32 h-32 rounded-full ring-4 ring-white/30 shrink-0 relative bg-white/10"><img src="${
														photo.src
													}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                         <div class="flex-1"><h1 class="text-5xl font-bold mb-2 tracking-tight">${
														data.name
													}</h1><p class="text-xl opacity-90 font-medium tracking-wide uppercase">${
						data.job
					}</p></div>
						                     </header>
						                     <div class="flex-1 ${pad} grid grid-cols-1 md:grid-cols-12 gap-10">
						                          <div class="col-span-1 md:col-span-4 space-y-8 md:border-r border-slate-100 md:pr-6">
						                             <div class="space-y-1 ${tBase}"><div>${data.phone}</div><div>${data.email}</div><div>${
						data.location
					}</div></div>
						                             <div><h3 class="${tTitle} font-bold uppercase mb-2" style="color:${color}">Skills</h3><div class="flex flex-wrap gap-1">${data.skills
						.map(s => `<span class="border px-2 py-1 rounded text-[10px]">${s}</span>`)
						.join('')}</div></div>
						                             <div><h3 class="${tTitle} font-bold uppercase mb-2" style="color:${color}">Education</h3>${simple(
						data.education
					)}</div>
						                          </div>
						                          <div class="col-span-1 md:col-span-8 space-y-8">
						                             <section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-user text-slate-300"></i> Profile</h3><p class="${tBase} ${lead}">${summary}</p></section>
						                             <section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-briefcase text-slate-300"></i> Experience</h3>${list(
						data.experiences
					)}</section>
						                             ${
															data.projects.length
																? `<section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-rocket text-slate-300"></i> Projects</h3>${list(
																		data.projects
																  )}</section>`
																: ''
														}
						                          </div>
						                     </div>
						                 </div>`
				} else if (template === 'studio') {
					html = `<div class="${base} flex flex-col h-full bg-slate-50">
						                 <header class="bg-white p-8 md:p-12 shadow-sm flex flex-col md:flex-row items-center md:items-start gap-8">
						                     <div class="avatar-crop-container w-32 h-32 rounded-lg shadow-lg overflow-hidden relative shrink-0"><img src="${
													photo.src
												}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                     <div class="flex-1 text-center md:text-left">
						                         <h1 class="text-4xl font-bold text-slate-900 mb-2">${data.name}</h1>
						                         <p class="text-xl font-medium mb-4" style="color: ${color}">${data.job}</p>
						                         <div class="flex flex-wrap justify-center md:justify-start gap-4 text-sm text-slate-500">
						                             <span><i class="fas fa-envelope mr-1"></i>${data.email}</span>
						                             <span><i class="fas fa-phone mr-1"></i>${data.phone}</span>
						                             <span><i class="fas fa-map-marker-alt mr-1"></i>${data.location}</span>
						                         </div>
						                     </div>
						                 </header>
						                 <div class="flex-1 p-8 md:p-12 grid grid-cols-1 md:grid-cols-3 gap-10">
						                     <div class="col-span-1 md:col-span-2 space-y-10">
						                         <section>
						                             <h3 class="text-lg font-bold uppercase tracking-wider mb-6 flex items-center gap-3"><span class="w-8 h-1 rounded-full" style="background-color: ${color}"></span> About Me</h3>
						                             <p class="${tBase} ${lead} text-slate-600 text-justify">${summary}</p>
						                         </section>
						                         <section>
						                             <h3 class="text-lg font-bold uppercase tracking-wider mb-6 flex items-center gap-3"><span class="w-8 h-1 rounded-full" style="background-color: ${color}"></span> Experience</h3>
						                             <div class="space-y-8">${list(data.experiences)}</div>
						                         </section>
						                          ${
														data.projects.length
															? `<section><h3 class="text-lg font-bold uppercase tracking-wider mb-6 flex items-center gap-3"><span class="w-8 h-1 rounded-full" style="background-color: ${color}"></span> Projects</h3>${list(
																	data.projects
															  )}</section>`
															: ''
													}
						                     </div>
						                     <div class="col-span-1 space-y-10">
						                         <section class="bg-white p-6 rounded-xl shadow-sm">
						                             <h3 class="font-bold uppercase tracking-wider mb-4 text-slate-400 text-xs">Skills</h3>
						                             <div class="flex flex-wrap gap-2">${data.skills
															.map(
																s =>
																	`<span class="bg-slate-50 text-slate-700 px-3 py-1.5 rounded-md text-xs font-medium border border-slate-100">${s}</span>`
															)
															.join('')}</div>
						                         </section>
						                         <section class="bg-white p-6 rounded-xl shadow-sm">
						                             <h3 class="font-bold uppercase tracking-wider mb-4 text-slate-400 text-xs">Education</h3>
						                             ${simple(data.education)}
						                         </section>
						                         ${
														data.languages || data.certificates
															? `<section class="bg-white p-6 rounded-xl shadow-sm"><h3 class="font-bold uppercase tracking-wider mb-4 text-slate-400 text-xs">Misc</h3><div class="${tBase} text-slate-600 space-y-2">${
																	data.languages
																		? `<div><div class="font-bold text-slate-800 mb-1">Languages</div>${data.languages}</div>`
																		: ''
															  }${
																	data.certificates
																		? `<div><div class="font-bold text-slate-800 mb-1">Certificates</div>${data.certificates}</div>`
																		: ''
															  }</div></section>`
															: ''
													}
						                     </div>
						                 </div>
						             </div>`
				} else if (template === 'leaf') {
					html = `<div class="${base} h-full bg-white relative overflow-hidden">
						                 <div class="absolute top-0 left-0 w-full h-2" style="background-color: ${color}"></div>
						                 <div class="absolute top-0 right-0 w-64 h-64 bg-green-50 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 opacity-50"></div>
						                 <header class="${pad} pb-0 text-center relative z-10">
						                     <div class="avatar-crop-container w-28 h-28 rounded-full mx-auto mb-6 border-4 border-white shadow-lg relative bg-white"><img src="${
													photo.src
												}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
						                     <h1 class="text-4xl font-serif font-bold text-slate-800 mb-2">${data.name}</h1>
						                     <p class="text-lg font-medium italic mb-6" style="color: ${color}">${data.job}</p>
						                     <div class="flex justify-center gap-6 text-sm text-slate-500 border-t border-b border-slate-100 py-4 max-w-2xl mx-auto">
						                         <span>${data.email}</span><span>â€¢</span><span>${data.phone}</span><span>â€¢</span><span>${
						data.location
					}</span>
						                     </div>
						                 </header>
						                 <div class="${pad} grid grid-cols-1 md:grid-cols-12 gap-12 relative z-10">
						                     <div class="col-span-1 md:col-span-12">
						                          <p class="${tBase} ${lead} text-center max-w-3xl mx-auto text-slate-600">${summary}</p>
						                     </div>
						                     <div class="col-span-1 md:col-span-7 space-y-10">
						                         <section>
						                             <h3 class="text-xl font-serif font-bold mb-6 flex items-center gap-3 text-slate-800"><span class="text-2xl opacity-50" style="color: ${color}">ğŸŒ¿</span> Experience</h3>
						                             <div class="space-y-8 border-l border-slate-200 pl-6 ml-3">${list(data.experiences)}</div>
						                         </section>
						                         ${
														data.projects.length
															? `<section><h3 class="text-xl font-serif font-bold mb-6 flex items-center gap-3 text-slate-800"><span class="text-2xl opacity-50" style="color: ${color}">ğŸŒ¿</span> Projects</h3><div class="space-y-8 border-l border-slate-200 pl-6 ml-3">${list(
																	data.projects
															  )}</div></section>`
															: ''
													}
						                     </div>
						                     <div class="col-span-1 md:col-span-5 space-y-10">
						                          <section>
						                             <h3 class="text-xl font-serif font-bold mb-6 text-slate-800">Skills</h3>
						                             <div class="flex flex-wrap gap-3">${data.skills
															.map(
																s =>
																	`<span class="bg-slate-50 text-slate-700 px-4 py-2 rounded-full text-xs border border-slate-100">${s}</span>`
															)
															.join('')}</div>
						                         </section>
						                         <section>
						                             <h3 class="text-xl font-serif font-bold mb-6 text-slate-800">Education</h3>
						                             ${simple(data.education)}
						                         </section>
						                     </div>
						                 </div>
						             </div>`
				} else {
					html = `<div class="${base} ${pad}">
						                 <div class="border-b-2 border-slate-900 pb-6 mb-6"><h1 class="text-4xl font-bold uppercase">${
												data.name
											}</h1><p class="text-xl text-slate-600">${
						data.job
					}</p><div class="${tBase} mt-2">${data.email} | ${data.phone}</div></div>
						                 <div class="space-y-6"><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Summary</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Experience</h2>${list(
						data.experiences
					)}</section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Education</h2>${simple(
						data.education
					)}</section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Skills</h2><div>${skills}</div></section></div>
						             </div>`
				}

				c.innerHTML = html
			}
		</script>
	</body>
</html>
