<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nova CV | æ™ºèƒ½åœ¨çº¿ç®€å†æ„å»ºå™¨</title>
    <meta name="description" content="Nova CV - ä¸‹ä¸€ä»£æ™ºèƒ½ç®€å†å·¥å…·ã€‚æ”¯æŒ AI å†™ä½œã€å®æ—¶é¢„è§ˆã€PDF å¯¼å‡ºï¼Œæä¾› 10+ æ¬¾ä¸“ä¸šæ¨¡ç‰ˆã€‚">
    
    <!-- Favicon -->
    <link rel="icon" href="https://ui-avatars.com/api/?name=N&background=2563eb&color=fff&rounded=true&font-size=0.6" type="image/png">
    
    <!-- å­—ä½“å¼•å…¥ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans SC', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        paper: '#ffffff',
                        'paper-dark': '#1e293b',
                    },
                    boxShadow: {
                        'paper': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06), 0 0 0 1px rgba(0,0,0,0.05)',
                        'glow': '0 0 20px rgba(37, 99, 235, 0.5)',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'cursor-blink': 'blink 1s step-end infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        blink: {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* å…¨å±€æ ·å¼ */
        body {
            background-color: #f3f4f6;
            transition: background-color 0.3s, color 0.3s;
        }
        .dark body { background-color: #020617; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* æ»šåŠ¨è§†å·®ä¸æ˜¾ç°åŠ¨ç”»ç±» */
        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
        }
        .scroll-reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            @page { margin: 0; size: A4; }
            body, html, #app-container, #preview-panel {
                height: auto !important; min-height: 0 !important; overflow: visible !important;
                background-color: white !important; display: block !important; position: relative !important;
                width: 100% !important; margin: 0 !important; padding: 0 !important;
            }
            #landing-page, .no-print, aside, .zoom-controls, #template-modal, #mobile-fab { display: none !important; }
            #app-container { display: block !important; }
            .a4-preview {
                width: 100% !important; height: auto !important; min-height: 100vh !important;
                box-shadow: none !important; margin: 0 !important; transform: none !important;
                filter: none !important; border: none !important; overflow: visible !important; 
            }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .break-inside-avoid { page-break-inside: avoid; break-inside: avoid; }
            .grid { display: grid !important; }
            .print\:text-white { color: white !important; }
            .print\:text-black { color: black !important; }
            .print\:h-full { height: 100% !important; min-height: 100vh !important; }
        }

        /* Range Slider & Color Picker */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #cbd5e1; margin-top: -6px; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; }
        .dark input[type=range]::-webkit-slider-runnable-track { background: #475569; }
        .color-option { width: 32px; height: 32px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: transform 0.2s, border-color 0.2s; position: relative; display: flex; align-items: center; justify-content: center; }
        .color-option.active { border-color: #334155; transform: scale(1.1); }
        .dark .color-option.active { border-color: #fff; }
        .color-input-wrapper { position: relative; overflow: hidden; }
        .color-input-wrapper input[type=color] { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; cursor: pointer; opacity: 0; }

        /* Editor UI */
        .editor-section-title { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; display: flex; align-items: center; gap: 0.5rem; }
        .dark .editor-section-title { color: #94a3b8; }
        .style-btn-group { display: flex; background-color: #f1f5f9; border-radius: 0.5rem; padding: 0.25rem; }
        .dark .style-btn-group { background-color: #1e293b; }
        .style-btn { flex: 1; text-align: center; padding: 0.5rem; font-size: 0.75rem; border-radius: 0.375rem; color: #64748b; transition: all 0.2s; }
        .dark .style-btn { color: #94a3b8; }
        .style-btn.active { background-color: white; color: #0f172a; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); font-weight: 600; }
        .dark .style-btn.active { background-color: #334155; color: #fff; }

        /* A4 Preview */
        .a4-preview { width: 210mm; min-height: 297mm; height: 297mm; margin: 0 auto; background: white; box-shadow: 0 0 15px rgba(0,0,0,0.1); transform-origin: top center; transition: transform 0.2s ease-out; }
        .dark .a4-preview { filter: brightness(0.95); }
        
        /* Avatar Crop Container - ç¡®ä¿åœ†å½¢è£å‰ª */
        .avatar-crop-container { overflow: hidden; }
        .avatar-crop-container.rounded-full { border-radius: 9999px; }
        .avatar-crop-container.rounded-lg { border-radius: 0.5rem; }
        
        /* Template Mini Preview - æ¢å¤äº†è¯¦ç»†çš„ CSS ç»˜å›¾æ ·å¼ */
        .mini-preview { width: 100%; height: 140px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; position: relative; transition: all 0.2s; }
        .template-card.active .mini-preview { border-color: #2563eb; box-shadow: 0 0 0 2px #2563eb; }

        /* Landing Backgrounds */
        .bg-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }
        .dark .bg-grid {
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px);
        }
        
        .blob {
            position: absolute;
            filter: blur(80px);
            opacity: 0.4;
            z-index: -1;
            animation: float 10s ease-in-out infinite;
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-200 antialiased min-h-screen flex flex-col bg-slate-50 dark:bg-slate-950">
    <!-- é¡µé¢çŠ¶æ€é¢„åˆ¤æ–­è„šæœ¬ - é˜²æ­¢é—ªçƒ -->
    <script>
        (function() {
            try {
                var pageState = localStorage.getItem('nova_cv_page_state');
                if (pageState === 'app') {
                    var style = document.createElement('style');
                    style.id = 'preload-style';
                    style.textContent = '#landing-page{display:none!important}#app-container{display:flex!important}';
                    document.head.appendChild(style);
                }
            } catch(e) {}
        })();
    </script>

    <!-- 1. å®£ä¼ é¦–é¡µ (Landing Page) -->
    <div id="landing-page" class="flex flex-col min-h-screen relative overflow-hidden">
        <!-- åŠ¨æ€èƒŒæ™¯ -->
        <div class="absolute inset-0 bg-grid pointer-events-none z-0"></div>
        <div class="blob w-96 h-96 bg-blue-500 rounded-full top-[-10%] left-[-10%] mix-blend-multiply dark:mix-blend-screen animate-float" style="animation-delay: 0s;"></div>
        <div class="blob w-96 h-96 bg-purple-500 rounded-full top-[20%] right-[-10%] mix-blend-multiply dark:mix-blend-screen animate-float" style="animation-delay: 2s;"></div>
        <div class="blob w-80 h-80 bg-pink-500 rounded-full bottom-[-10%] left-[20%] mix-blend-multiply dark:mix-blend-screen animate-float" style="animation-delay: 4s;"></div>

        <!-- Landing Navbar -->
        <nav class="px-6 py-6 flex justify-between items-center max-w-7xl mx-auto w-full relative z-10">
            <div class="flex items-center gap-2 text-2xl font-bold tracking-tighter group cursor-pointer">
                <div class="w-9 h-9 rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg bg-gradient-to-br from-blue-600 to-indigo-600 group-hover:scale-110 transition-transform">N</div>
                <span class="text-slate-900 dark:text-white">Nova <span class="text-blue-600">CV</span></span>
            </div>
            <div class="flex gap-4 items-center">
                <button onclick="toggleTheme()" class="w-10 h-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center transition-colors text-slate-600 dark:text-slate-300">
                    <i class="fas fa-adjust"></i>
                </button>
                <a href="#" onclick="enterApp()" class="hidden md:block text-sm font-bold text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">ç›´æ¥è¿›å…¥</a>
                <button onclick="enterApp()" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-5 py-2 rounded-full text-sm font-bold hover:opacity-90 transition-opacity shadow-lg">
                    å¼€å§‹åˆ¶ä½œ
                </button>
            </div>
        </nav>

        <!-- Hero Section -->
        <div class="flex-1 flex flex-col justify-center items-center text-center px-4 py-20 relative z-10">
            <div class="max-w-4xl mx-auto">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 text-blue-600 dark:text-blue-400 text-xs font-bold mb-8 scroll-reveal active">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                    </span>
                    AI é©±åŠ¨çš„ç®€å†æ„å»ºå™¨ v2.0
                </div>
                
                <h1 class="text-5xl md:text-7xl lg:text-8xl font-extrabold text-slate-900 dark:text-white mb-8 tracking-tight leading-tight scroll-reveal active" style="transition-delay: 0.1s;">
                    æ‰“é€ ä½ çš„ <br class="md:hidden" />
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-indigo-500 to-purple-600" id="typewriter-text"></span><span class="animate-cursor-blink text-blue-600">|</span>
                </h1>
                
                <p class="text-lg md:text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto mb-12 leading-relaxed scroll-reveal active" style="transition-delay: 0.2s;">
                    å‘Šåˆ«ç¹çæ’ç‰ˆã€‚Nova CV åŠ©æ‚¨åœ¨ 10 åˆ†é’Ÿå†…ç”Ÿæˆç²¾ç¾ã€ä¸“ä¸šçš„ PDF ç®€å†ã€‚å†…ç½® Gemini AI åŠ©æ‰‹ï¼Œè®©æ‚¨çš„ç»å†æ›´å…·è¯´æœåŠ›ã€‚
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center scroll-reveal active" style="transition-delay: 0.3s;">
                    <button onclick="enterApp()" class="group bg-blue-600 hover:bg-blue-700 text-white text-lg px-8 py-4 rounded-2xl font-bold shadow-xl shadow-blue-500/20 transition-all hover:-translate-y-1 flex items-center justify-center gap-2">
                        ç«‹å³å…è´¹åˆ¶ä½œ 
                        <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                    </button>
                    <button onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})" class="bg-white dark:bg-slate-800/50 backdrop-blur text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700 text-lg px-8 py-4 rounded-2xl font-bold hover:bg-slate-50 dark:hover:bg-slate-700 transition-all">
                        äº†è§£æ›´å¤š
                    </button>
                </div>

                <!-- Stats -->
                <div class="mt-16 pt-8 border-t border-slate-200/50 dark:border-slate-800/50 flex justify-center gap-8 md:gap-16 text-center scroll-reveal active" style="transition-delay: 0.4s;">
                    <div>
                        <div class="text-2xl md:text-3xl font-black text-slate-900 dark:text-white">10+</div>
                        <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider font-bold mt-1">ä¸“ä¸šæ¨¡ç‰ˆ</div>
                    </div>
                    <div>
                        <div class="text-2xl md:text-3xl font-black text-slate-900 dark:text-white">100%</div>
                        <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider font-bold mt-1">éšç§å®‰å…¨</div>
                    </div>
                    <div>
                        <div class="text-2xl md:text-3xl font-black text-slate-900 dark:text-white">AI</div>
                        <div class="text-xs md:text-sm text-slate-500 uppercase tracking-wider font-bold mt-1">æ™ºèƒ½æ¶¦è‰²</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Features Section -->
        <div id="features" class="py-24 px-6 bg-white/50 dark:bg-slate-900/50 relative z-10">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-16 scroll-reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4">ä¸ºä½•é€‰æ‹© Nova CV?</h2>
                    <p class="text-slate-600 dark:text-slate-400 max-w-2xl mx-auto">ä¸“æ³¨äºæ±‚èŒä½“éªŒï¼Œæ¯ä¸€ä¸ªç»†èŠ‚éƒ½ä¸ºæ‚¨ç²¾å¿ƒæ‰“ç£¨ã€‚</p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 scroll-reveal">
                        <div class="w-14 h-14 bg-blue-100 dark:bg-blue-900/30 rounded-2xl flex items-center justify-center text-blue-600 mb-6 text-2xl"><i class="fas fa-magic"></i></div>
                        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">AI æ™ºèƒ½æ¶¦è‰²</h3>
                        <p class="text-slate-600 dark:text-slate-400 leading-relaxed">ä¸çŸ¥é“å¦‚ä½•æè¿°å·¥ä½œç»å†ï¼Ÿå†…ç½® Gemini AI æ¨¡å‹ï¼Œä¸€é”®ä¼˜åŒ–æªè¾ï¼Œè®©æ‚¨çš„ç®€å†æ›´å…·ä¸“ä¸šåº¦å’Œè¯´æœåŠ›ã€‚</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 scroll-reveal" style="transition-delay: 0.1s;">
                        <div class="w-14 h-14 bg-violet-100 dark:bg-violet-900/30 rounded-2xl flex items-center justify-center text-violet-600 mb-6 text-2xl"><i class="fas fa-th-large"></i></div>
                        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">å¤šæ¬¾ç²¾é€‰æ¨¡ç‰ˆ</h3>
                        <p class="text-slate-600 dark:text-slate-400 leading-relaxed">æä¾› 10+ æ¬¾ç”±è®¾è®¡å¸ˆç²¾å¿ƒæ‰“é€ çš„ç®€å†æ¨¡ç‰ˆã€‚ä»ä¼ ç»Ÿçš„ç»å…¸é£æ ¼åˆ°æå®¢é£ã€åˆ›æ„é£ï¼Œæ»¡è¶³ä¸åŒè¡Œä¸šéœ€æ±‚ã€‚</p>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-3xl border border-slate-100 dark:border-slate-700 shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 scroll-reveal" style="transition-delay: 0.2s;">
                        <div class="w-14 h-14 bg-emerald-100 dark:bg-emerald-900/30 rounded-2xl flex items-center justify-center text-emerald-600 mb-6 text-2xl"><i class="fas fa-shield-alt"></i></div>
                        <h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">éšç§ç»å¯¹å®‰å…¨</h3>
                        <p class="text-slate-600 dark:text-slate-400 leading-relaxed">æˆ‘ä»¬æ²¡æœ‰ä»»ä½•åç«¯æœåŠ¡å™¨ã€‚æ‚¨çš„æ‰€æœ‰æ•°æ®éƒ½åªå­˜å‚¨åœ¨æ‚¨çš„æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œå®‰å…¨æ— å¿§ï¼Œéšæ—¶å¯¼å‡ºã€‚</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- How it works -->
        <div class="py-24 px-6 relative z-10">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-16 scroll-reveal">
                    <h2 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-white mb-4">ç®€å•ä¸‰æ­¥ï¼Œæå®šç®€å†</h2>
                </div>
                
                <div class="flex flex-col md:flex-row justify-center items-center gap-8 md:gap-12">
                    <div class="flex-1 text-center scroll-reveal">
                        <div class="w-16 h-16 mx-auto bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-2xl font-bold text-slate-900 dark:text-white shadow-md mb-4 border-4 border-blue-50 dark:border-slate-700">1</div>
                        <h4 class="font-bold text-lg mb-2 dark:text-white">é€‰æ‹©æ¨¡ç‰ˆ</h4>
                        <p class="text-sm text-slate-500">æŒ‘é€‰ä¸€æ¬¾æœ€é€‚åˆæ‚¨èŒä¸šé£æ ¼çš„æ¨¡ç‰ˆã€‚</p>
                    </div>
                    <div class="hidden md:block h-px w-16 bg-slate-300 dark:bg-slate-700"></div>
                    <div class="flex-1 text-center scroll-reveal" style="transition-delay: 0.1s;">
                        <div class="w-16 h-16 mx-auto bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-2xl font-bold text-slate-900 dark:text-white shadow-md mb-4 border-4 border-blue-50 dark:border-slate-700">2</div>
                        <h4 class="font-bold text-lg mb-2 dark:text-white">å¡«å†™ & AI æ¶¦è‰²</h4>
                        <p class="text-sm text-slate-500">è¾“å…¥ä¿¡æ¯ï¼Œä½¿ç”¨ AI åŠ©æ‰‹ä¼˜åŒ–æ–‡å­—è¡¨è¾¾ã€‚</p>
                    </div>
                    <div class="hidden md:block h-px w-16 bg-slate-300 dark:bg-slate-700"></div>
                    <div class="flex-1 text-center scroll-reveal" style="transition-delay: 0.2s;">
                        <div class="w-16 h-16 mx-auto bg-white dark:bg-slate-800 rounded-full flex items-center justify-center text-2xl font-bold text-slate-900 dark:text-white shadow-md mb-4 border-4 border-blue-50 dark:border-slate-700">3</div>
                        <h4 class="font-bold text-lg mb-2 dark:text-white">å®æ—¶é¢„è§ˆ & å¯¼å‡º</h4>
                        <p class="text-sm text-slate-500">æ‰€è§å³æ‰€å¾—ï¼Œä¸€é”®å¯¼å‡ºé«˜æ¸… PDFã€‚</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="py-20 text-center relative z-10">
            <div class="scroll-reveal">
                 <h2 class="text-3xl font-bold text-slate-900 dark:text-white mb-8">å‡†å¤‡å¥½å¼€å§‹äº†å—ï¼Ÿ</h2>
                 <button onclick="enterApp()" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 text-lg px-10 py-4 rounded-full font-bold shadow-xl hover:scale-105 transition-transform">
                    å…è´¹åˆ›å»ºç®€å†
                </button>
            </div>
        </div>

        <footer class="text-center py-8 text-slate-400 text-sm border-t border-slate-200 dark:border-slate-800 bg-white/50 dark:bg-slate-900/50 relative z-10">
            <p>&copy; 2023 Nova CV. Build with â¤ï¸ and Tailwind CSS.</p>
        </footer>
    </div>

    <!-- 2. åº”ç”¨ä¸»ç•Œé¢ (App Container) -->
    <div id="app-container" class="hidden h-screen flex-col overflow-hidden">
        
        <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
        <header class="no-print h-14 md:h-16 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-4 md:px-6 z-50 shrink-0 transition-all">
            <div class="flex items-center gap-3">
                <button onclick="goBackToLanding()" class="flex items-center gap-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors" title="è¿”å›é¦–é¡µ">
                    <i class="fas fa-arrow-left"></i>
                    <span class="hidden sm:inline text-sm">é¦–é¡µ</span>
                </button>
                <div class="w-px h-6 bg-slate-200 dark:bg-slate-700"></div>
                <div class="flex items-center gap-2 md:gap-3 cursor-pointer" onclick="goBackToLanding()" title="è¿”å›é¦–é¡µ">
                    <div id="logo-bg" class="w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-lg shadow-lg" style="background: linear-gradient(135deg, #3b82f6, #6366f1);">
                        N
                    </div>
                    <h1 class="font-bold text-lg md:text-xl tracking-tight"><span class="text-slate-900 dark:text-white">Nova</span> <span class="text-blue-600" id="logo-text">CV</span></h1>
                </div>
            </div>

            <div class="flex items-center gap-2 md:gap-4">
                <button onclick="openTemplateModal()" class="flex items-center gap-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-700 dark:text-slate-200 px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium transition-colors border border-slate-200 dark:border-slate-700">
                    <i class="fas fa-th-large text-blue-500"></i>
                    <span class="hidden sm:inline">æ¨¡ç‰ˆåº“</span>
                    <span id="current-tmpl-name" class="bg-white dark:bg-slate-900 px-2 py-0.5 rounded text-[10px] md:text-xs ml-1 text-slate-500 border border-slate-200 dark:border-slate-700 hidden sm:inline">ç»å…¸</span>
                </button>
                <div class="w-px h-6 bg-slate-200 dark:bg-slate-700 mx-1 hidden sm:block"></div>
                <div class="hidden lg:flex items-center bg-slate-100 dark:bg-slate-800 rounded-lg p-1 border border-slate-200 dark:border-slate-700">
                    <button onclick="changeZoom(-0.1)" class="w-7 h-7 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition-all shadow-sm hover:shadow active:scale-95"><i class="fas fa-minus text-xs"></i></button>
                    <span class="text-xs font-mono text-slate-600 dark:text-slate-300 w-12 text-center select-none" id="page-zoom-val">100%</span>
                    <button onclick="changeZoom(0.1)" class="w-7 h-7 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 text-slate-500 dark:text-slate-400 transition-all shadow-sm hover:shadow active:scale-95"><i class="fas fa-plus text-xs"></i></button>
                </div>
                <button onclick="toggleTheme()" class="w-8 h-8 md:w-10 md:h-10 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center justify-center transition-colors text-slate-600 dark:text-slate-400"><i class="fas fa-moon dark:hidden"></i><i class="fas fa-sun hidden dark:block"></i></button>
                <button onclick="manualSave()" id="btn-save" class="bg-slate-600 hover:bg-slate-700 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg font-medium transition-all flex items-center gap-2 text-xs md:text-sm active:scale-95"><i class="fas fa-save"></i><span class="hidden sm:inline">ä¿å­˜</span></button>
                <button onclick="printResume()" id="btn-export" class="text-white px-3 py-1.5 md:px-5 md:py-2 rounded-lg font-medium hover:opacity-90 transition-opacity flex items-center gap-2 shadow-lg text-xs md:text-sm active:scale-95" style="background-color: #2563eb;"><i class="fas fa-download"></i><span class="hidden sm:inline">å¯¼å‡º</span></button>
            </div>
        </header>

        <div class="flex-1 flex overflow-hidden relative">
            <aside class="no-print w-full md:w-[450px] lg:w-[500px] bg-white dark:bg-slate-900 border-r border-slate-200 dark:border-slate-800 flex flex-col shrink-0 z-30 shadow-2xl transition-transform duration-300 absolute md:relative h-full transform md:transform-none translate-x-0" id="editor-panel">
                <div class="md:hidden flex items-center justify-between px-4 py-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50">
                    <span class="font-bold text-sm text-slate-700 dark:text-slate-200">ğŸ“ ç¼–è¾‘å†…å®¹</span>
                    <button onclick="toggleMobileEditor(false)" class="bg-blue-100 text-blue-600 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 active:bg-blue-200">å®Œæˆé¢„è§ˆ <i class="fas fa-check"></i></button>
                </div>
                <div class="flex border-b border-slate-200 dark:border-slate-800">
                    <button onclick="switchTab('content')" id="tab-content" class="flex-1 py-3 text-sm font-medium border-b-2 transition-colors text-blue-600 border-blue-600 bg-blue-50/50 dark:bg-blue-900/10">å†…å®¹ç¼–è¾‘</button>
                    <button onclick="switchTab('style')" id="tab-style" class="flex-1 py-3 text-sm font-medium border-b-2 transition-colors text-slate-500 border-transparent hover:text-slate-700 dark:text-slate-400">æ ·å¼è®¾ç½®</button>
                </div>
                <div id="panel-content" class="flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar pb-32 md:pb-24">
                    <section class="space-y-4"><h2 class="editor-section-title"><i class="fas fa-user-circle"></i> åŸºæœ¬ä¿¡æ¯</h2><div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl border border-slate-200 dark:border-slate-700"><div class="flex items-start gap-4"><div class="relative group cursor-pointer w-20 h-20 shrink-0"><div class="w-20 h-20 rounded-full overflow-hidden bg-slate-200 ring-2 ring-white dark:ring-slate-700 shadow-md"><img id="editor-avatar-preview" src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?fit=crop&w=300&h=300" class="w-full h-full object-cover"></div><label for="photo-upload" class="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-medium">æ›´æ¢</label><input type="file" id="photo-upload" accept="image/*" class="hidden" onchange="handlePhotoUpload(this)"></div><div class="flex-1 space-y-3"><div class="space-y-1"><div class="flex justify-between text-xs text-slate-500"><span>å¤§å°</span> <span id="val-zoom">100%</span></div><input type="range" min="0.5" max="2" step="0.1" value="1" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="updatePhotoStyle('scale', this.value)"></div><div class="space-y-1"><div class="flex justify-between text-xs text-slate-500"><span>ä½ç½® X/Y</span></div><div class="flex gap-2"><input type="range" min="-50" max="50" value="0" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="updatePhotoStyle('x', this.value)"><input type="range" min="-50" max="50" value="0" class="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer" oninput="updatePhotoStyle('y', this.value)"></div></div></div></div></div><div class="grid grid-cols-2 gap-4"><div class="col-span-2"><label class="block text-xs font-medium text-slate-500 mb-1">å…¨å</label><input type="text" id="input-name" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none transition-shadow" value="ææ˜å“²" oninput="updateText('name', this.value)"></div><div class="col-span-2"><label class="block text-xs font-medium text-slate-500 mb-1">æ±‚èŒæ„å‘ / èŒä½</label><input type="text" id="input-job" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ & UX è®¾è®¡å¸ˆ" oninput="updateText('job', this.value)"></div><div><label class="block text-xs font-medium text-slate-500 mb-1">ç”µè¯</label><input type="text" id="input-phone" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="138-0000-0000" oninput="updateContact('phone', this.value)"></div><div><label class="block text-xs font-medium text-slate-500 mb-1">é‚®ç®±</label><input type="text" id="input-email" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="hello@limingzhe.com" oninput="updateContact('email', this.value)"></div><div><label class="block text-xs font-medium text-slate-500 mb-1">åŸå¸‚</label><input type="text" id="input-location" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="ä¸Šæµ·, ä¸­å›½" oninput="updateContact('location', this.value)"></div><div><label class="block text-xs font-medium text-slate-500 mb-1">ä¸ªäººç½‘ç«™</label><input type="text" id="input-web" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="limingzhe.design" oninput="updateContact('web', this.value)"></div></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-2"><div class="flex justify-between items-center"><h2 class="editor-section-title"><i class="fas fa-align-left"></i> ä¸ªäººç®€ä»‹</h2><button onclick="generateSummary()" id="btn-ai-summary" class="text-xs bg-gradient-to-r from-violet-500 to-fuchsia-500 text-white px-2 py-1 rounded shadow hover:opacity-90 transition-opacity flex items-center gap-1"><i class="fas fa-magic"></i> AI ç”Ÿæˆ</button></div><textarea id="input-summary" rows="4" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none leading-relaxed resize-none" oninput="updateText('summary', this.value)">æ‹¥æœ‰5å¹´ä¸°å¯Œç»éªŒçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€å¯è®¿é—®ä¸”è§†è§‰ç²¾ç¾çš„Webåº”ç”¨ã€‚ç²¾é€šReactã€Vueç”Ÿæ€ç³»ç»Ÿï¼Œå¯¹å¾®å‰ç«¯æ¶æ„æœ‰æ·±å…¥ç ”ç©¶ã€‚å…·å¤‡ä¼˜ç§€çš„è®¾è®¡å®¡ç¾ï¼Œè‡´åŠ›äºå¼¥åˆè®¾è®¡ä¸ä»£ç ä¹‹é—´çš„é¸¿æ²Ÿã€‚å–„äºå›¢é˜Ÿåä½œï¼Œæ›¾ä¸»å¯¼å¤šä¸ªç™¾ä¸‡çº§ç”¨æˆ·äº§å“çš„é‡æ„å·¥ä½œã€‚</textarea></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><div class="flex items-center justify-between"><h2 class="editor-section-title"><i class="fas fa-briefcase"></i> å·¥ä½œç»å†</h2><button onclick="addExperience()" class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color">+ æ·»åŠ ç»å†</button></div><div id="experience-editor-list" class="space-y-4"></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><div class="flex items-center justify-between"><h2 class="editor-section-title"><i class="fas fa-graduation-cap"></i> æ•™è‚²èƒŒæ™¯</h2><button onclick="addEducation()" class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color">+ æ·»åŠ æ•™è‚²</button></div><div id="education-editor-list" class="space-y-4"></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><div class="flex items-center justify-between"><h2 class="editor-section-title"><i class="fas fa-rocket"></i> é¡¹ç›®ç»å†</h2><button onclick="addProject()" class="text-xs text-blue-600 hover:text-blue-700 font-medium link-color">+ æ·»åŠ é¡¹ç›®</button></div><div id="project-editor-list" class="space-y-4"></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><h2 class="editor-section-title"><i class="fas fa-tools"></i> æŠ€èƒ½ä¸é™„åŠ ä¿¡æ¯</h2><div><label class="block text-xs font-medium text-slate-500 mb-1">ä¸“ä¸šæŠ€èƒ½ (ç”¨é€—å·åˆ†éš”)</label><textarea id="input-skills" rows="3" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none" oninput="updateSkills(this.value)">JavaScript (ES6+), TypeScript, React, Next.js, Tailwind CSS, Node.js, Figma, UI/UX Design, Docker, Git</textarea></div><div><label class="block text-xs font-medium text-slate-500 mb-1">è¯­è¨€èƒ½åŠ›</label><input type="text" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none" value="ä¸­æ–‡ (Native), English (Professional)" oninput="updateText('languages', this.value)"></div><div><label class="block text-xs font-medium text-slate-500 mb-1">å¥–é¡¹ä¸è¯ä¹¦</label><textarea rows="2" class="w-full bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none" oninput="updateText('certificates', this.value)">AWS Certified Solutions Architect, PMP Certification</textarea></div></section>
                    <div class="h-8"></div>
                </div>
                <div id="panel-style" class="hidden flex-1 overflow-y-auto p-6 space-y-8 no-scrollbar pb-32 md:pb-24">
                    <section class="space-y-4"><h2 class="editor-section-title"><i class="fas fa-palette"></i> ä¸»é¢˜é¢œè‰²</h2><div class="flex flex-wrap gap-4" id="color-picker"></div><div class="mt-2 flex items-center gap-2"><div class="color-option color-input-wrapper w-8 h-8 rounded-full border border-slate-200 bg-white flex items-center justify-center shadow-sm"><i class="fas fa-plus text-slate-400 text-xs"></i><input type="color" oninput="updateStyle('color', this.value)" title="è‡ªå®šä¹‰é¢œè‰²"></div><span class="text-xs text-slate-500">è‡ªå®šä¹‰é¢œè‰²</span></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><h2 class="editor-section-title"><i class="fas fa-font"></i> å­—ä½“é£æ ¼</h2><div class="grid grid-cols-2 gap-3"><button onclick="updateStyle('font', 'sans')" id="font-btn-sans" class="border border-blue-500 bg-blue-50 text-blue-700 px-4 py-3 rounded-lg text-sm font-sans text-center transition-all shadow-sm">æ— è¡¬çº¿ (Sans)</button><button onclick="updateStyle('font', 'serif')" id="font-btn-serif" class="border border-slate-200 bg-white text-slate-600 px-4 py-3 rounded-lg text-sm font-serif text-center transition-all hover:shadow-md hover:border-slate-300">è¡¬çº¿ (Serif)</button></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-4"><h2 class="editor-section-title"><i class="fas fa-text-height"></i> å…¨å±€å­—å·</h2><div class="style-btn-group"><button onclick="updateStyle('fontSize', 'small')" class="style-btn" id="fs-small">å°</button><button onclick="updateStyle('fontSize', 'normal')" class="style-btn active" id="fs-normal">ä¸­</button><button onclick="updateStyle('fontSize', 'large')" class="style-btn" id="fs-large">å¤§</button></div></section>
                    <hr class="border-slate-100 dark:border-slate-800">
                    <section class="space-y-6"><div><h2 class="editor-section-title mb-3"><i class="fas fa-arrows-alt-v"></i> é¡µè¾¹è·</h2><div class="style-btn-group"><button onclick="updateStyle('margins', 'narrow')" class="style-btn" id="mg-narrow">ç´§å‡‘</button><button onclick="updateStyle('margins', 'normal')" class="style-btn active" id="mg-normal">æ ‡å‡†</button><button onclick="updateStyle('margins', 'wide')" class="style-btn" id="mg-wide">å®½æ•</button></div></div><div><h2 class="editor-section-title mb-3"><i class="fas fa-align-justify"></i> è¡Œé—´è·</h2><div class="style-btn-group"><button onclick="updateStyle('spacing', 'tight')" class="style-btn" id="sp-tight">ç´§å¯†</button><button onclick="updateStyle('spacing', 'normal')" class="style-btn" id="sp-normal">èˆ’é€‚</button><button onclick="updateStyle('spacing', 'relaxed')" class="style-btn active" id="sp-relaxed">å®½æ¾</button></div></div></section>
                    <div class="h-8"></div>
                </div>
            </aside>

            <div class="flex-1 bg-slate-200/50 dark:bg-black/40 overflow-auto flex justify-center md:py-12 px-0 md:px-4 relative" id="preview-panel">
                <div id="resume-preview" class="a4-preview relative box-border origin-top shadow-none md:shadow-2xl"></div>
            </div>

            <button onclick="toggleMobileEditor(true)" id="mobile-fab" class="md:hidden fixed bottom-8 right-6 w-14 h-14 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-xl flex items-center justify-center z-40 transition-all active:scale-95"><i class="fas fa-pen text-xl"></i></button>
        </div>
    </div>

    <!-- æ¨¡ç‰ˆé€‰æ‹© Modal -->
    <div id="template-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="closeTemplateModal()"></div>
        <div class="absolute inset-0 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 bg-white dark:bg-slate-900 md:rounded-2xl shadow-2xl w-full md:max-w-5xl md:h-[85vh] h-full flex flex-col border border-slate-200 dark:border-slate-800 transform transition-all">
            <div class="flex justify-between items-center px-6 py-4 border-b border-slate-100 dark:border-slate-800 shrink-0 bg-white dark:bg-slate-900 md:rounded-t-2xl z-10"><h3 class="text-lg font-bold text-slate-900 dark:text-white">æ¨¡ç‰ˆåº“ <span class="hidden sm:inline text-xs font-normal text-slate-500 ml-2">10 æ¬¾ç²¾å¿ƒè®¾è®¡</span></h3><button onclick="closeTemplateModal()" class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"><i class="fas fa-times text-lg"></i></button></div>
            <div class="p-4 md:p-6 overflow-y-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 bg-slate-50/50 dark:bg-slate-900/50" id="template-grid"></div>
            <div class="p-4 border-t border-slate-100 dark:border-slate-800 bg-white dark:bg-slate-900 md:rounded-b-2xl text-center shrink-0 safe-area-pb"><p class="text-xs text-slate-500">æç¤ºï¼šåˆ‡æ¢æ¨¡ç‰ˆä¸ä¼šä¸¢å¤±æ‚¨çš„å†…å®¹</p></div>
        </div>
    </div>

    <script>
        // --- API ---
        const apiKey = ""; 

        // --- Typewriter & Scroll Logic ---
        const typewriterWords = ["å®Œç¾ç®€å†", "èŒä¸šæœªæ¥", "ç†æƒ³ Offer"];
        let typeIndex = 0, charIndex = 0, isDeleting = false, typeTimer;
        function typeWriter() {
            const currentWord = typewriterWords[typeIndex];
            const speed = isDeleting ? 50 : 150;
            const textEl = document.getElementById("typewriter-text");
            if (!textEl) return;
            if (!isDeleting && charIndex < currentWord.length) { textEl.textContent += currentWord.charAt(charIndex); charIndex++; typeTimer = setTimeout(typeWriter, speed); } 
            else if (isDeleting && charIndex > 0) { textEl.textContent = currentWord.substring(0, charIndex - 1); charIndex--; typeTimer = setTimeout(typeWriter, speed); } 
            else { if (!isDeleting) { isDeleting = true; typeTimer = setTimeout(typeWriter, 2000); } else { isDeleting = false; typeIndex = (typeIndex + 1) % typewriterWords.length; typeTimer = setTimeout(typeWriter, 500); } }
        }
        const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('active'); }); }, { threshold: 0.1 });

        // --- State ---
        const state = {
            template: 'classic', zoom: 1, 
            style: { color: '#2563eb', font: 'sans', fontSize: 'normal', margins: 'normal', spacing: 'relaxed' },
            photo: { src: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?fit=crop&w=500&h=500', scale: 1, x: 0, y: 0 },
            data: {
                name: 'ææ˜å“²', job: 'é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ & UX è®¾è®¡å¸ˆ', phone: '138-0000-0000', email: 'hello@limingzhe.com', location: 'ä¸Šæµ·, ä¸­å›½', web: 'limingzhe.design',
                summary: 'æ‹¥æœ‰5å¹´ä¸°å¯Œç»éªŒçš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆï¼Œä¸“æ³¨äºæ„å»ºé«˜æ€§èƒ½ã€å¯è®¿é—®ä¸”è§†è§‰ç²¾ç¾çš„Webåº”ç”¨ã€‚ç²¾é€šReactã€Vueç”Ÿæ€ç³»ç»Ÿï¼Œå¯¹å¾®å‰ç«¯æ¶æ„æœ‰æ·±å…¥ç ”ç©¶ã€‚å…·å¤‡ä¼˜ç§€çš„è®¾è®¡å®¡ç¾ï¼Œè‡´åŠ›äºå¼¥åˆè®¾è®¡ä¸ä»£ç ä¹‹é—´çš„é¸¿æ²Ÿã€‚å–„äºå›¢é˜Ÿåä½œï¼Œæ›¾ä¸»å¯¼å¤šä¸ªç™¾ä¸‡çº§ç”¨æˆ·äº§å“çš„é‡æ„å·¥ä½œã€‚',
                experiences: [{ id: 1, role: 'é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ', company: 'TechFlow ç§‘æŠ€æœ‰é™å…¬å¸', time: '2021 - è‡³ä»Š', desc: 'â€¢ ä¸»å¯¼å…¬å¸æ ¸å¿ƒ SaaS å¹³å°çš„é‡æ„ï¼Œå°†é¦–å±åŠ è½½æ—¶é—´å‡å°‘äº† 40%ã€‚\nâ€¢ è®¾è®¡å¹¶å®ç°äº†ä¸€å¥—åŸºäº React çš„å†…éƒ¨ç»„ä»¶åº“ã€‚' }, { id: 2, role: 'å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ', company: 'Creative Web Studio', time: '2018 - 2021', desc: 'â€¢ è´Ÿè´£å¤šä¸ªç”µå•†å®¢æˆ·çš„è¥é”€æ´»åŠ¨é¡µé¢å¼€å‘ã€‚\nâ€¢ ä¸è®¾è®¡å¸ˆç´§å¯†åˆä½œï¼Œå®Œç¾è¿˜åŸ Figma è®¾è®¡ç¨¿ã€‚' }],
                education: [{ degree: 'è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯ (å­¦å£«)', school: 'ä¸Šæµ·äº¤é€šå¤§å­¦', time: '2014 - 2018' }],
                projects: [{ name: 'Nova åœ¨çº¿ç®€å†', role: 'ç‹¬ç«‹å¼€å‘è€…', time: '2023', desc: 'å¼€å‘äº†ä¸€æ¬¾åŸºäº Tailwind CSS çš„åœ¨çº¿ç®€å†æ„å»ºå™¨ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œ PDF å¯¼å‡ºã€‚é›†æˆäº† Gemini AI è¿›è¡Œæ–‡æœ¬æ¶¦è‰²ã€‚' }],
                languages: 'ä¸­æ–‡ (Native), English (Professional)', certificates: 'AWS Certified Solutions Architect', skills: ['JavaScript', 'React', 'Vue.js', 'Tailwind', 'Node.js', 'Figma']
            }
        };

        const colors = [{ name: 'Blue', hex: '#2563eb' }, { name: 'Indigo', hex: '#4f46e5' }, { name: 'Purple', hex: '#9333ea' }, { name: 'Pink', hex: '#db2777' }, { name: 'Red', hex: '#dc2626' }, { name: 'Orange', hex: '#ea580c' }, { name: 'Amber', hex: '#d97706' }, { name: 'Green', hex: '#16a34a' }, { name: 'Teal', hex: '#0d9488' }, { name: 'Slate', hex: '#475569' }, { name: 'Black', hex: '#000000' }];

        // --- LocalStorage æŒä¹…åŒ– ---
        const STORAGE_KEY = 'nova_cv_data';
        const PAGE_STATE_KEY = 'nova_cv_page_state';
        
        function saveToLocalStorage() {
            const saveData = {
                template: state.template,
                style: state.style,
                photo: state.photo,
                data: state.data
            };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(saveData));
            } catch (e) {
                console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', e);
            }
        }
        
        function savePageState(inApp) {
            try {
                localStorage.setItem(PAGE_STATE_KEY, inApp ? 'app' : 'landing');
            } catch (e) {}
        }
        
        function getPageState() {
            try {
                return localStorage.getItem(PAGE_STATE_KEY);
            } catch (e) {
                return null;
            }
        }
        
        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.template) state.template = parsed.template;
                    if (parsed.style) Object.assign(state.style, parsed.style);
                    if (parsed.photo) Object.assign(state.photo, parsed.photo);
                    if (parsed.data) Object.assign(state.data, parsed.data);
                    return true;
                }
            } catch (e) {
                console.warn('åŠ è½½æ•°æ®å¤±è´¥:', e);
            }
            return false;
        }
        
        function syncEditorInputs() {
            // åŒæ­¥è¾“å…¥æ¡†çš„å€¼
            document.getElementById('input-name').value = state.data.name;
            document.getElementById('input-job').value = state.data.job;
            document.getElementById('input-phone').value = state.data.phone;
            document.getElementById('input-email').value = state.data.email;
            document.getElementById('input-location').value = state.data.location;
            document.getElementById('input-web').value = state.data.web;
            document.getElementById('input-summary').value = state.data.summary;
            document.getElementById('input-skills').value = state.data.skills.join(', ');
            document.getElementById('editor-avatar-preview').src = state.photo.src;
        }
        
        function goBackToLanding() {
            saveToLocalStorage();
            savePageState(false);
            // ç§»é™¤é¢„åŠ è½½æ ·å¼
            const preloadStyle = document.getElementById('preload-style');
            if (preloadStyle) preloadStyle.remove();
            document.getElementById('app-container').classList.add('hidden');
            document.getElementById('app-container').classList.remove('flex');
            document.getElementById('landing-page').classList.remove('hidden');
            typeWriter();
        }
        
        function manualSave() {
            saveToLocalStorage();
            const btn = document.getElementById('btn-save');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-check"></i><span class="hidden sm:inline">å·²ä¿å­˜</span>';
            btn.classList.add('bg-green-500');
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.classList.remove('bg-green-500');
            }, 1500);
        }

        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
            renderAllEditors(); renderColorPicker(); renderPreview(); initTemplatesInModal(); updateActiveTemplateUI();
            syncEditorInputs();
            document.querySelectorAll('.scroll-reveal').forEach(el => observer.observe(el));
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) document.documentElement.classList.add('dark');
            window.addEventListener('resize', handleResize);
            
            // æ£€æŸ¥æ˜¯å¦åº”è¯¥ç›´æ¥è¿›å…¥ç¼–è¾‘é¡µé¢
            if (getPageState() === 'app') {
                enterApp();
            } else {
                typeWriter();
            }
        });

        function enterApp() {
            document.getElementById('landing-page').classList.add('hidden');
            const app = document.getElementById('app-container');
            app.classList.remove('hidden'); app.classList.add('flex');
            savePageState(true);
            clearTimeout(typeTimer); setTimeout(handleResize, 100);
        }

        function handleResize() {
            const a4 = document.getElementById('resume-preview');
            if (!a4 || document.getElementById('app-container').classList.contains('hidden')) return;
            if (window.innerWidth < 1024) { a4.style.transform = 'none'; a4.style.marginBottom = '0'; a4.style.marginTop = '0'; } 
            else { a4.style.transform = `scale(${state.zoom})`; a4.style.marginBottom = "60px"; a4.style.marginTop = "40px"; }
        }

        function toggleMobileEditor(show) {
            const editor = document.getElementById('editor-panel'); const fab = document.getElementById('mobile-fab');
            if (show) { editor.style.transform = 'translateX(0)'; fab.style.opacity = '0'; fab.style.pointerEvents = 'none'; } 
            else { editor.style.transform = 'translateX(-100%)'; fab.style.opacity = '1'; fab.style.pointerEvents = 'auto'; }
        }

        function renderAllEditors() { renderExperienceEditor(); renderEducationEditor(); renderProjectEditor(); }

        // --- API ---
        async function callGeminiAPI(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                if (!response.ok) throw new Error(response.statusText);
                const data = await response.json(); return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (error) { alert("AI æœåŠ¡æš‚æ—¶ä¸å¯ç”¨"); return null; }
        }
        async function generateSummary() {
            const btn = document.getElementById('btn-ai-summary'); const original = btn.innerHTML;
            btn.innerHTML = '...'; btn.disabled = true;
            const res = await callGeminiAPI(`Write a professional resume summary (3 sentences) for a "${state.data.job}" with skills: "${state.data.skills.join(', ')}". Output in Chinese.`);
            if(res) { updateText('summary', res.trim()); document.getElementById('input-summary').value = res.trim(); }
            btn.innerHTML = original; btn.disabled = false;
        }
        async function optimizeExperience(index) {
            const btn = document.getElementById(`btn-ai-exp-${index}`); const original = btn.innerHTML;
            btn.innerHTML = '...'; btn.disabled = true;
            const res = await callGeminiAPI(`Rewrite bullet point to be professional/result-oriented in Chinese: "${state.data.experiences[index].desc}"`);
            if(res) { updateExp(index, 'desc', res.trim()); renderExperienceEditor(); }
        }

        // --- Renderers ---
        function renderExperienceEditor() {
            document.getElementById('experience-editor-list').innerHTML = state.data.experiences.map((exp, i) => `
                <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3">
                    <div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-400">ç»å† #${i+1}</span><button onclick="removeExperience(${i})" class="text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div>
                    <div class="grid grid-cols-2 gap-2 mb-2"><input type="text" placeholder="èŒä½" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs font-bold" value="${exp.role}" oninput="updateExp(${i}, 'role', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${exp.time}" oninput="updateExp(${i}, 'time', this.value)"><input type="text" placeholder="å…¬å¸" class="col-span-2 bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${exp.company}" oninput="updateExp(${i}, 'company', this.value)"></div>
                    <div class="relative"><textarea rows="3" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" oninput="updateExp(${i}, 'desc', this.value)">${exp.desc}</textarea><button onclick="optimizeExperience(${i})" id="btn-ai-exp-${i}" class="absolute bottom-2 right-2 text-[10px] bg-blue-50 text-blue-600 px-2 py-1 rounded border border-blue-100">âœ¨ æ¶¦è‰²</button></div>
                </div>`).join('');
        }
        function renderEducationEditor() {
            document.getElementById('education-editor-list').innerHTML = state.data.education.map((edu, i) => `
                <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3">
                     <div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-400">å­¦å† #${i+1}</span><button onclick="removeEducation(${i})" class="text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div>
                    <input type="text" placeholder="å­¦æ ¡" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs mb-2 font-bold" value="${edu.school}" oninput="updateEdu(${i}, 'school', this.value)">
                    <div class="grid grid-cols-2 gap-2"><input type="text" placeholder="å­¦ä½" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${edu.degree}" oninput="updateEdu(${i}, 'degree', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${edu.time}" oninput="updateEdu(${i}, 'time', this.value)"></div>
                </div>`).join('');
        }
        function renderProjectEditor() {
            document.getElementById('project-editor-list').innerHTML = state.data.projects.map((proj, i) => `
                <div class="bg-slate-50 dark:bg-slate-800/50 p-4 rounded-lg border border-slate-200 dark:border-slate-700 mb-3">
                    <div class="flex justify-between mb-2"><span class="text-xs font-bold text-slate-400">é¡¹ç›® #${i+1}</span><button onclick="removeProject(${i})" class="text-slate-400 hover:text-red-500"><i class="fas fa-trash"></i></button></div>
                    <div class="grid grid-cols-2 gap-2 mb-2"><input type="text" placeholder="é¡¹ç›®å" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs font-bold" value="${proj.name}" oninput="updateProject(${i}, 'name', this.value)"><input type="text" placeholder="æ—¶é—´" class="bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs text-right" value="${proj.time}" oninput="updateProject(${i}, 'time', this.value)"><input type="text" placeholder="è§’è‰²/æŠ€æœ¯" class="col-span-2 bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" value="${proj.role}" oninput="updateProject(${i}, 'role', this.value)"></div>
                    <textarea rows="2" class="w-full bg-white dark:bg-slate-800 border border-slate-200 rounded px-2 py-1 text-xs" oninput="updateProject(${i}, 'desc', this.value)">${proj.desc}</textarea>
                </div>`).join('');
        }

        // --- Updates ---
        function updateText(f, v) { state.data[f] = v; renderPreview(); saveToLocalStorage(); }
        function updateContact(f, v) { state.data[f] = v; renderPreview(); saveToLocalStorage(); }
        function updateSkills(v) { state.data.skills = v.split(',').filter(s=>s.trim()!==''); renderPreview(); saveToLocalStorage(); }
        function updateExp(i, f, v) { state.data.experiences[i][f] = v; renderPreview(); saveToLocalStorage(); }
        function addExperience() { state.data.experiences.unshift({role:'èŒä½', company:'å…¬å¸', time:'æ—¶é—´', desc:''}); renderExperienceEditor(); renderPreview(); saveToLocalStorage(); }
        function removeExperience(i) { if(confirm('åˆ é™¤?')) { state.data.experiences.splice(i,1); renderExperienceEditor(); renderPreview(); saveToLocalStorage(); } }
        function updateEdu(i, f, v) { state.data.education[i][f] = v; renderPreview(); saveToLocalStorage(); }
        function addEducation() { state.data.education.unshift({school:'å­¦æ ¡', degree:'å­¦ä½', time:'æ—¶é—´'}); renderEducationEditor(); renderPreview(); saveToLocalStorage(); }
        function removeEducation(i) { if(confirm('åˆ é™¤?')) { state.data.education.splice(i,1); renderEducationEditor(); renderPreview(); saveToLocalStorage(); } }
        function updateProject(i, f, v) { state.data.projects[i][f] = v; renderPreview(); saveToLocalStorage(); }
        function addProject() { state.data.projects.unshift({name:'é¡¹ç›®', role:'è§’è‰²', time:'æ—¶é—´', desc:''}); renderProjectEditor(); renderPreview(); saveToLocalStorage(); }
        function removeProject(i) { if(confirm('åˆ é™¤?')) { state.data.projects.splice(i,1); renderProjectEditor(); renderPreview(); saveToLocalStorage(); } }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) { state.photo.src = e.target.result; document.getElementById('editor-avatar-preview').src = e.target.result; renderPreview(); saveToLocalStorage(); }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function updatePhotoStyle(p, v) { state.photo[p] = parseFloat(v); renderPreview(); saveToLocalStorage(); }
        
        function updateStyle(p, v) {
            state.style[p] = v;
            if(p==='color') { renderColorPicker(); document.getElementById('logo-text').style.color = v; document.getElementById('btn-export').style.backgroundColor = v; }
            if(['fontSize','margins','spacing'].includes(p)) {
                const map = {'fontSize':'fs-','margins':'mg-','spacing':'sp-'};
                document.querySelectorAll(`[id^="${map[p]}"]`).forEach(b=>b.classList.remove('active'));
                document.getElementById(`${map[p]}${v}`).classList.add('active');
            }
            renderPreview();
            saveToLocalStorage();
        }
        function renderColorPicker() { document.getElementById('color-picker').innerHTML = colors.map(c => `<div onclick="updateStyle('color', '${c.hex}')" class="color-option ${state.style.color === c.hex ? 'active' : ''}" style="background-color: ${c.hex};" title="${c.name}"></div>`).join(''); }
        function setTemplate(t) { state.template = t; updateActiveTemplateUI(); renderPreview(); saveToLocalStorage(); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        function changeZoom(d) { let z = state.zoom + d; if(z<0.3) z=0.3; if(z>1.5) z=1.5; state.zoom = z; document.getElementById('page-zoom-val').innerText = Math.round(z*100)+'%'; handleResize(); }
        function switchTab(t) {
            const c=document.getElementById('panel-content'), s=document.getElementById('panel-style');
            const bc=document.getElementById('tab-content'), bs=document.getElementById('tab-style');
            if(t==='content') { c.classList.remove('hidden'); s.classList.add('hidden'); bc.classList.add('text-blue-600','border-blue-600','bg-blue-50/50'); bc.classList.remove('text-slate-500','border-transparent'); bs.classList.remove('text-blue-600','border-blue-600','bg-blue-50/50'); bs.classList.add('text-slate-500','border-transparent'); }
            else { s.classList.remove('hidden'); c.classList.add('hidden'); bs.classList.add('text-blue-600','border-blue-600','bg-blue-50/50'); bs.classList.remove('text-slate-500','border-transparent'); bc.classList.remove('text-blue-600','border-blue-600','bg-blue-50/50'); bc.classList.add('text-slate-500','border-transparent'); }
        }
        function printResume() { window.focus(); window.print(); }

        // --- Modal ---
        function openTemplateModal() { document.getElementById('template-modal').classList.remove('hidden'); initTemplatesInModal(); updateActiveTemplateUI(); }
        function closeTemplateModal() { document.getElementById('template-modal').classList.add('hidden'); }
        function selectTemplateAndClose(t) { setTemplate(t); closeTemplateModal(); }
        function updateActiveTemplateUI() {
            const map = { 'classic': 'ç»å…¸é£æ ¼', 'modern': 'ç°ä»£æç®€', 'elegant': 'ç®€çº¦å•†åŠ¡', 'creative': 'åˆ›æ„è®¾è®¡', 'compact': 'ç´§å‡‘å­¦æœ¯', 'timeline': 'æ—¶å…‰è½´', 'tech': 'æå®¢ç²¾ç¥', 'right': 'å³ä¾§å¸ƒå±€', 'swiss': 'ç‘å£«é£æ ¼', 'bold': 'é†’ç›®é£æ ¼' };
            document.getElementById('current-tmpl-name').innerText = map[state.template];
            document.querySelectorAll('.template-card').forEach(c => {
               const i = c.querySelector('.check-icon');
               if(i.dataset.tmpl === state.template) { c.classList.add('active'); i.classList.remove('opacity-0'); } else { c.classList.remove('active'); i.classList.add('opacity-0'); }
            });
        }
        function initTemplatesInModal() {
            const tmpls = [ {id:'classic',n:'ç»å…¸é£æ ¼',d:'ç¨³é‡ä¼ ç»Ÿ'}, {id:'modern',n:'ç°ä»£æç®€',d:'é¡¶éƒ¨å¤§æ ‡é¢˜'}, {id:'elegant',n:'ç®€çº¦å•†åŠ¡',d:'å•æ å±…ä¸­'}, {id:'timeline',n:'æ—¶å…‰è½´',d:'è§†è§‰åŒ–ç»å†'}, {id:'tech',n:'æå®¢ç²¾ç¥',d:'ç»ˆç«¯é£æ ¼'}, {id:'right',n:'å³ä¾§å¸ƒå±€',d:'æ‰“ç ´å¸¸è§„'}, {id:'swiss',n:'ç‘å£«é£æ ¼',d:'ç½‘æ ¼æ’ç‰ˆ'}, {id:'creative',n:'åˆ›æ„è®¾è®¡',d:'å‡ ä½•èƒŒæ™¯'}, {id:'compact',n:'ç´§å‡‘å­¦æœ¯',d:'é«˜å¯†åº¦'}, {id:'bold',n:'é†’ç›®é£æ ¼',d:'è§†è§‰å¼ºçƒˆ'} ];
            document.getElementById('template-grid').innerHTML = tmpls.map(t => `<div class="template-card group cursor-pointer bg-white dark:bg-slate-800 rounded-lg p-2 border border-slate-200 dark:border-slate-700 hover:shadow-lg transition-all active:scale-95" onclick="selectTemplateAndClose('${t.id}')"><div class="mini-preview flex overflow-hidden shadow-sm bg-slate-50 relative mb-2 rounded">${getMiniPreviewHTML(t.id)}</div><div class="flex justify-between items-center px-1"><div><h4 class="font-bold text-slate-800 dark:text-slate-200 text-xs">${t.n}</h4></div><div class="w-4 h-4 rounded-full border border-slate-300 dark:border-slate-600 flex items-center justify-center text-blue-600 opacity-0 group-hover:opacity-100 check-icon bg-white" data-tmpl="${t.id}"><i class="fas fa-check text-[8px]"></i></div></div></div>`).join('');
        }
        
        // ** é‡ç»˜çš„ç²¾ç»†åŒ–ç¼©ç•¥å›¾ HTML - ä¸å®é™…æ¨¡ç‰ˆæ›´æ¥è¿‘ **
        function getMiniPreviewHTML(id) {
            const c = state.style.color;
            if(id === 'classic') return `<div class="w-1/3 h-full p-2 flex flex-col gap-1" style="background-color: ${c}"><div class="w-8 h-8 rounded-full bg-white/30 mx-auto mb-1 ring-1 ring-white/20"></div><div class="h-0.5 w-full bg-white/30 mt-1"></div><div class="h-0.5 w-2/3 bg-white/20"></div><div class="h-0.5 w-3/4 bg-white/20"></div></div><div class="w-2/3 h-full bg-white p-2 flex flex-col gap-1"><div class="h-2 w-16 bg-slate-800 mb-0.5"></div><div class="h-1 w-12 mb-2" style="background-color: ${c}; opacity: 0.7"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-3/4 bg-slate-200"></div></div>`;
            if(id === 'modern') return `<div class="flex flex-col h-full w-full"><div class="h-12 border-b-2 flex items-center px-2 bg-white" style="border-color: ${c}"><div class="w-8 h-8 rounded-full bg-slate-200 mr-2"></div><div><div class="h-1.5 w-14 bg-slate-800 mb-1"></div><div class="h-1 w-10" style="background-color: ${c}; opacity: 0.7"></div></div></div><div class="flex-1 p-2 grid grid-cols-3 gap-2 bg-white"><div class="col-span-2 space-y-1"><div class="h-1 w-8 bg-slate-300 mb-1"></div><div class="h-0.5 w-full bg-slate-100"></div><div class="h-0.5 w-full bg-slate-100"></div></div><div class="col-span-1 space-y-1"><div class="h-1 w-6 bg-slate-300 mb-1"></div><div class="h-0.5 w-full bg-slate-100"></div></div></div></div>`;
            if(id === 'elegant') return `<div class="flex flex-col items-center h-full pt-3 bg-white border-b border-slate-200"><div class="w-8 h-8 rounded-full bg-slate-200 mb-1 border border-slate-100"></div><div class="h-1.5 w-12 bg-slate-800 mb-0.5"></div><div class="h-1 w-8 mb-1" style="background-color: ${c}; opacity: 0.6"></div><div class="h-0.5 w-20 bg-slate-100 mb-2"></div><div class="w-full px-2 space-y-1 border-t border-slate-200 pt-2"><div class="h-0.5 w-full bg-slate-100"></div><div class="h-0.5 w-full bg-slate-100"></div><div class="h-0.5 w-3/4 bg-slate-100"></div></div></div>`;
            if(id === 'timeline') return `<div class="flex h-full bg-white"><div class="w-1/3 p-2 flex flex-col items-center"><div class="w-10 h-10 rounded-full bg-slate-200 mb-2 border-2 border-white shadow"></div><div class="h-1 w-full bg-slate-800 mb-1"></div><div class="h-0.5 w-full bg-slate-100"></div></div><div class="w-2/3 p-2 border-l-2 border-slate-200 relative"><div class="absolute left-[-4px] top-2 w-2 h-2 rounded-full" style="background-color: ${c}"></div><div class="h-1 w-12 bg-slate-300 mb-1 ml-2"></div><div class="h-0.5 w-full bg-slate-100 ml-2"></div><div class="absolute left-[-4px] top-10 w-2 h-2 rounded-full" style="background-color: ${c}"></div><div class="h-1 w-10 bg-slate-300 mt-4 ml-2"></div></div></div>`;
            if(id === 'tech') return `<div class="flex flex-col h-full bg-slate-50"><div class="h-10 bg-slate-900 flex items-center justify-between px-2"><div class="h-1.5 w-10 bg-green-400"></div><div class="h-1 w-6 bg-slate-500"></div></div><div class="flex-1 p-2 grid grid-cols-3 gap-1"><div class="col-span-2 space-y-1"><div class="bg-white p-1 border border-slate-200 h-full"><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-3/4 bg-slate-200 mt-1"></div></div></div><div class="col-span-1 space-y-1"><div class="w-full aspect-square bg-slate-300 mb-1"></div><div class="bg-white p-1 border border-slate-200"><div class="h-0.5 w-full bg-slate-200"></div></div></div></div></div>`;
            if(id === 'right') return `<div class="flex h-full"><div class="w-2/3 h-full bg-white p-2 flex flex-col gap-1"><div class="h-2 w-14 bg-slate-800 mb-0.5"></div><div class="h-1 w-10 mb-2" style="background-color: ${c}; opacity: 0.7"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-3/4 bg-slate-200"></div></div><div class="w-1/3 h-full bg-slate-50 border-l border-slate-200 p-2 flex flex-col items-center"><div class="w-8 h-8 rounded-full bg-white mx-auto mb-2 ring-2 ring-white shadow"></div><div class="h-0.5 w-full bg-slate-200 mb-1"></div><div class="h-0.5 w-full bg-slate-200"></div></div></div>`;
            if(id === 'swiss') return `<div class="p-2 h-full flex flex-col bg-white"><div class="flex items-center gap-2 mb-1"><div class="w-6 h-6 rounded-full bg-slate-200"></div><div class="h-2 w-16 bg-black"></div></div><div class="h-1 w-20 mb-1" style="background-color: ${c}"></div><div class="border-t-2 pt-2 flex-1 grid grid-cols-4 gap-1" style="border-color: ${c}"><div class="col-span-1"><div class="h-1 w-full bg-slate-400"></div></div><div class="col-span-3 space-y-1"><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div></div></div></div>`;
            if(id === 'creative') return `<div class="relative h-full overflow-hidden bg-white"><div class="absolute top-0 right-0 w-full h-1/2 -rotate-12 origin-top-right opacity-20" style="background-color: ${c}"></div><div class="absolute top-2 right-2 w-8 h-8 bg-white border border-slate-100 shadow-sm z-10 rounded-lg overflow-hidden"><div class="w-full h-full bg-slate-200"></div></div><div class="absolute top-3 left-2 z-10"><div class="h-2 w-14 bg-slate-800 mb-0.5"></div><div class="h-1 w-10 bg-slate-400"></div></div><div class="absolute bottom-2 left-2 right-2 grid grid-cols-3 gap-1"><div class="col-span-1 p-1 bg-slate-50 rounded border-l-2" style="border-color: ${c}"><div class="h-0.5 w-full bg-slate-200"></div></div><div class="col-span-2 space-y-1"><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div></div></div></div>`;
            if(id === 'compact') return `<div class="p-2 h-full flex flex-col gap-1 bg-white"><div class="border-b border-black pb-1 mb-0.5 flex flex-col items-center"><div class="w-6 h-6 rounded-full bg-slate-200 mb-1"></div><div class="h-1.5 w-1/2 bg-black"></div><div class="h-0.5 w-1/3 bg-slate-300 mt-0.5"></div></div><div class="h-1 w-8 mb-0.5" style="background-color: ${c}"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div><div class="h-1 w-8 mb-0.5 mt-1" style="background-color: ${c}"></div><div class="h-0.5 w-full bg-slate-200"></div></div>`;
            if(id === 'bold') return `<div class="flex flex-col h-full bg-white"><div class="h-12 w-full flex items-center justify-start gap-2 px-2" style="background-color: ${c}"><div class="w-8 h-8 rounded-full bg-white/30 ring-1 ring-white/20"></div><div><div class="h-1.5 w-12 bg-white/80 mb-0.5"></div><div class="h-1 w-8 bg-white/50"></div></div></div><div class="flex-1 grid grid-cols-3 gap-1 p-2"><div class="col-span-1 space-y-1 border-r border-slate-100 pr-1"><div class="h-0.5 w-full bg-slate-200"></div><div class="h-0.5 w-full bg-slate-200"></div></div><div class="col-span-2 space-y-1"><div class="h-1 w-8 bg-slate-300 mb-1"></div><div class="h-0.5 w-full bg-slate-100"></div><div class="h-0.5 w-full bg-slate-100"></div></div></div></div>`;
            return `<div class="w-full h-full bg-white p-2 flex items-center justify-center text-[8px] text-slate-300">Preview</div>`; 
        }

        // --- Core Render Logic (Restored Detail) ---
        function renderPreview() {
            const c = document.getElementById('resume-preview'); const { data, photo, template, style } = state;
            const color = style.color;
            let font = style.font === 'serif' ? 'font-serif' : (template === 'tech' ? 'font-mono' : 'font-sans');
            
            let tBase = style.fontSize === 'small' ? 'text-[10px]' : (style.fontSize === 'large' ? 'text-sm' : 'text-xs');
            let tTitle = style.fontSize === 'small' ? 'text-xs' : (style.fontSize === 'large' ? 'text-base' : 'text-sm');
            let lead = style.spacing === 'tight' ? 'leading-snug' : (style.spacing === 'normal' ? 'leading-normal' : 'leading-relaxed');
            let pad = style.margins === 'narrow' ? 'p-6' : (style.margins === 'wide' ? 'p-16' : 'p-10');
            if(window.innerWidth < 768) { pad = 'p-5'; } // Mobile override

            const summary = data.summary.replace(/\n/g, '<br>');
            const skills = data.skills.map(s => `<span class="inline-block bg-slate-100 text-slate-700 px-2 py-1 rounded ${tBase} font-medium mb-1 print:bg-slate-100 print:text-black">${s.trim()}</span>`).join('');
            const list = (items) => items.map(i => `<div class="mb-3 break-inside-avoid"><div class="flex justify-between items-baseline mb-0.5"><h3 class="font-bold text-slate-900 ${tTitle}">${i.role||i.degree||i.name}</h3><span class="${tBase} text-slate-500 whitespace-nowrap">${i.time}</span></div><div class="${tBase} font-medium mb-1" style="color:${color}">${i.company||i.school||i.role}</div>${i.desc?`<div class="${tBase} text-slate-600 ${lead} text-justify whitespace-pre-line">${i.desc}</div>`:''}</div>`).join('');
            const simple = (items) => items.map(i => `<div class="mb-2 break-inside-avoid"><div class="flex justify-between items-baseline"><h3 class="font-bold text-slate-900 ${tBase}">${i.school||i.name}</h3><span class="${tBase} text-slate-500">${i.time}</span></div><div class="${tBase} text-slate-600">${i.degree||i.role}</div></div>`).join('');
            const imgStyle = `transform: translate(${photo.x}px, ${photo.y}px) scale(${photo.scale});`;
            
            // Base container class - Mobile Stack / Desktop Grid
            const base = `h-full min-h-[297mm] bg-white text-slate-800 ${font}`;
            
            let html = '';
            
            if (template === 'classic') {
                html = `<div class="${base} grid grid-cols-1 md:grid-cols-12">
                    <div class="col-span-1 md:col-span-4 text-white p-6 md:p-8 flex flex-col print-adjust-color" style="background-color: ${color}; min-height: auto md:min-height: 100%;">
                        <div class="avatar-crop-container w-24 h-24 md:w-32 md:h-32 rounded-full ring-4 ring-white/20 mx-auto mb-6 relative bg-white/10"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
                        <div class="space-y-6">
                            <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Contact</h4><div class="space-y-1 ${tBase}">${data.phone}<br>${data.email}<br>${data.location}<br>${data.web}</div></div>
                            <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Education</h4><div class="space-y-3">${data.education.map(e=>`<div><div class="font-bold">${e.school}</div><div class="opacity-75 text-[10px]">${e.time}</div><div class="text-[11px]">${e.degree}</div></div>`).join('')}</div></div>
                            <div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Skills</h4><div class="flex flex-wrap gap-1">${data.skills.map(s=>`<span class="bg-white/20 px-2 py-1 rounded text-[10px]">${s}</span>`).join('')}</div></div>
                            ${(data.languages||data.certificates)?`<div><h4 class="${tBase} font-bold opacity-80 uppercase mb-2 border-b border-white/20 pb-1">Misc</h4><div class="space-y-1 ${tBase}">${data.languages}<br>${data.certificates}</div></div>`:''}
                        </div>
                    </div>
                    <div class="col-span-1 md:col-span-8 ${pad} bg-white">
                        <header class="mb-6 border-b pb-6"><h1 class="text-3xl font-bold mb-2">${data.name}</h1><p class="${tTitle} font-medium" style="color:${color}">${data.job}</p></header>
                        <div class="space-y-6"><section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Experience</h2>${list(data.experiences)}</section>${data.projects.length?`<section><h2 class="${tTitle} font-bold uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 bg-slate-800"></span> Projects</h2>${list(data.projects)}</section>`:''}</div>
                    </div>
                </div>`;
            } else if (template === 'modern') {
                html = `<div class="${base} ${pad}">
                     <header class="flex items-center gap-6 mb-8 border-b-2 pb-8" style="border-color: ${color}">
                        <div class="avatar-crop-container w-20 h-20 md:w-24 md:h-24 rounded-full bg-slate-100 overflow-hidden relative flex-shrink-0"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
                        <div class="flex-1"><h1 class="text-3xl md:text-4xl font-black mb-1">${data.name}</h1><p class="text-lg font-medium" style="color:${color}">${data.job}</p><div class="${tBase} mt-2 text-slate-500">${data.phone} | ${data.email} | ${data.location}</div></div>
                    </header>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="col-span-1 md:col-span-2 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Profile</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Experience</h2>${list(data.experiences)}</section>${data.projects.length?`<section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Projects</h2>${list(data.projects)}</section>`:''}</div>
                        <div class="col-span-1 md:col-span-1 space-y-6"><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Skills</h2>${skills}</section><section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Education</h2>${simple(data.education)}</section>${(data.languages||data.certificates)?`<section><h2 class="${tTitle} font-black uppercase mb-2 text-slate-400">Misc</h2><div class="${tBase} text-slate-600">${data.languages}<br>${data.certificates}</div></section>`:''}</div>
                    </div>
                </div>`;
            } else if (template === 'elegant') {
                html = `<div class="${base} ${pad}">
                    <header class="text-center mb-8 pb-6 border-b border-slate-300">
                         <div class="avatar-crop-container w-20 h-20 rounded-full mx-auto mb-3 bg-slate-100 overflow-hidden relative border border-slate-200"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
                        <h1 class="text-3xl font-bold mb-1 tracking-wide">${data.name}</h1><p class="${tTitle} italic mb-3 font-sans" style="color: ${color}">${data.job}</p>
                        <div class="flex justify-center flex-wrap gap-3 ${tBase} font-sans text-slate-500 uppercase tracking-widest">${data.phone} â€¢ ${data.email} â€¢ ${data.location}</div>
                    </header>
                    <div class="space-y-6 font-sans">
                        <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Profile</h2><p class="${tBase} ${lead} text-slate-700 text-justify">${summary}</p></section>
                        <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Experience</h2>${list(data.experiences)}</section>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Education</h2>${simple(data.education)}</section>
                            <div class="space-y-6"><section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Skills</h2><div class="flex flex-wrap gap-2 text-xs">${data.skills.map(s=>`<span class="border-b border-slate-200 pb-0.5">${s}</span>`).join('')}</div></section>${(data.languages||data.certificates)?`<section><h2 class="${tTitle} font-serif font-bold text-slate-900 border-b border-slate-800 pb-1 mb-3">Misc</h2><div class="${tBase} text-slate-700">${data.languages}<br>${data.certificates}</div></section>`:''}</div>
                        </div>
                    </div>
                </div>`;
            } else if (template === 'timeline') {
                html = `<div class="${base} flex flex-col h-full ${pad}">
                    <header class="flex items-center gap-8 mb-12"><div class="w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg shrink-0 relative"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div><h1 class="text-4xl font-bold text-slate-800 mb-2">${data.name}</h1><p class="text-xl font-medium" style="color: ${color}">${data.job}</p><div class="mt-4 ${tBase} text-slate-500">${data.phone} â€¢ ${data.email} â€¢ ${data.location}</div></div></header>
                    <div class="flex flex-col md:flex-row gap-12 flex-1">
                        <div class="w-full md:w-1/3 space-y-8 md:border-r border-slate-100 md:pr-8"><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Profile</h3><p class="${tBase} ${lead} text-slate-600">${summary}</p></section><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Education</h3>${simple(data.education)}</section><section><h3 class="font-bold uppercase tracking-wider mb-4 border-b-2 pb-1 inline-block" style="border-color: ${color}">Skills</h3><div class="flex flex-wrap gap-2">${data.skills.map(s=>`<span class="bg-slate-100 px-2 py-1 rounded text-[10px]">${s}</span>`).join('')}</div></section></div>
                        <div class="w-full md:w-2/3 space-y-8"><h3 class="font-bold uppercase tracking-wider mb-6 border-b-2 pb-1 inline-block" style="border-color: ${color}">Experience</h3><div class="relative border-l-2 border-slate-200 ml-3 space-y-10 pl-8 pb-4">${list(data.experiences)}</div></div>
                    </div>
                </div>`;
            } else if (template === 'tech') {
                html = `<div class="${base} bg-slate-50 min-h-[297mm]">
                    <header class="bg-slate-900 text-white p-8 print-adjust-color"><div class="flex justify-between items-start"><div><h1 class="text-3xl font-bold mb-1 tracking-tighter text-green-400 font-mono">&lt;${data.name} /&gt;</h1><p class="text-sm text-slate-400 font-mono"> // ${data.job}</p></div><div class="text-right text-[10px] font-mono text-slate-400 space-y-0.5 print:text-white">${data.email}<div>${data.phone}</div></div></div></header>
                    <div class="p-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="col-span-1 md:col-span-2 space-y-6"><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 tracking-widest flex items-center gap-2"><i class="fas fa-terminal" style="color: ${color}"></i> Experience</h2>${list(data.experiences)}</section><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 tracking-widest flex items-center gap-2"><i class="fas fa-code" style="color: ${color}"></i> Summary</h2><p class="${tBase} ${lead} text-slate-600 font-sans text-justify">${summary}</p></section></div>
                        <div class="col-span-1 space-y-6"><div class="avatar-crop-container w-full aspect-square rounded-full bg-white border border-slate-200 p-2 shadow-sm mb-2 overflow-hidden relative"><img src="${photo.src}" class="w-full h-full object-cover grayscale absolute top-0 left-0" style="${imgStyle}"></div><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="text-xs font-bold text-slate-900 uppercase mb-3 tracking-widest">Stack</h2><div class="flex flex-wrap gap-2">${data.skills.map(s=>`<span class="bg-slate-900 text-green-400 px-2 py-1 text-[10px] font-mono border border-slate-700">${s}</span>`).join('')}</div></section><section class="bg-white p-5 shadow-sm border border-slate-200"><h2 class="text-xs font-bold text-slate-900 uppercase mb-3 tracking-widest">Education</h2>${simple(data.education)}</section></div>
                    </div>
                </div>`;
            } else if (template === 'right') {
                html = `<div class="${base} grid grid-cols-1 md:grid-cols-12 min-h-screen">
                    <div class="col-span-1 md:col-span-8 p-10 bg-white text-slate-800"><header class="mb-8 border-b border-slate-100 pb-6"><h1 class="text-3xl font-bold mb-2">${data.name}</h1><p class="${tTitle} font-medium" style="color:${color}">${data.job}</p></header><section class="mb-8"><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-3 flex items-center gap-2"><span class="w-1 h-4 rounded-sm" style="background-color: ${color}"></span> Profile</h2><p class="${tBase} ${lead} text-slate-600 text-justify">${summary}</p></section><section><h2 class="${tTitle} font-bold text-slate-900 uppercase mb-4 flex items-center gap-2"><span class="w-1 h-4 rounded-sm" style="background-color: ${color}"></span> Experience</h2>${list(data.experiences)}</section></div>
                    <div class="col-span-1 md:col-span-4 bg-slate-50 border-l border-slate-200 p-8 flex flex-col print-adjust-color print:h-full"><div class="avatar-crop-container w-32 h-32 rounded-full ring-4 ring-white shadow-lg mx-auto mb-6 relative bg-white"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div class="space-y-8"><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Contact</h4><div class="space-y-2 ${tBase} text-slate-600">${data.phone}<br>${data.email}<br>${data.location}</div></div><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Education</h4>${simple(data.education)}</div><div><h4 class="${tBase} font-bold uppercase mb-3 border-b border-slate-200 pb-1" style="color:${color}">Skills</h4><div class="flex flex-wrap gap-1">${data.skills.map(s=>`<span class="bg-white text-slate-600 text-[10px] px-2 py-1 rounded border border-slate-200 shadow-sm">${s}</span>`).join('')}</div></div></div></div>
                </div>`;
            } else if (template === 'swiss') {
                html = `<div class="${base} ${pad} bg-white">
                    <header class="mb-12 flex items-start gap-6"><div class="avatar-crop-container w-20 h-20 rounded-full bg-slate-100 overflow-hidden relative flex-shrink-0 border-2 border-slate-200"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><div class="flex-1"><h1 class="text-5xl font-black tracking-tighter leading-none mb-2">${data.name}</h1><div class="w-20 h-2 bg-black mb-4" style="background-color: ${color}"></div><div class="flex justify-between items-end"><p class="text-lg font-bold text-slate-500 uppercase tracking-widest">${data.job}</p><div class="text-right text-xs font-bold text-slate-900 space-y-1">${data.phone}<br>${data.email}</div></div></div></header>
                    <div class="grid grid-cols-4 gap-8 border-t-4 border-black pt-8" style="border-color: ${color}"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">About</h3></div><div class="col-span-3"><p class="${tBase} ${lead} font-medium text-justify">${summary}</p></div></div>
                    <div class="grid grid-cols-4 gap-8 border-t border-slate-200 pt-8 mt-8"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">Experience</h3></div><div class="col-span-3 space-y-8">${list(data.experiences)}</div></div>
                    <div class="grid grid-cols-4 gap-8 border-t border-slate-200 pt-8 mt-8"><div class="col-span-1"><h3 class="${tTitle} font-black uppercase mb-6">Skills</h3></div><div class="col-span-3"><div class="grid grid-cols-3 gap-x-4 gap-y-2">${data.skills.map(s=>`<div class="${tBase} font-bold border-b border-slate-100 pb-1">${s}</div>`).join('')}</div></div></div>
                </div>`;
            } else if (template === 'creative') {
                // è®¡ç®—æµ…è‰²ç‰ˆæœ¬çš„ä¸»é¢˜è‰²ç”¨äºèƒŒæ™¯è£…é¥°
                const lightColor = color + '15';
                html = `<div class="${base} flex flex-col h-full relative">
                    <div class="absolute top-0 right-0 w-1/2 h-48" style="background: linear-gradient(to bottom left, ${lightColor} 0%, ${lightColor} 50%, transparent 50%); z-index: 0;"></div>
                    <header class="${pad} pb-0 relative z-10 flex justify-between items-end mb-12"><div><h1 class="text-5xl font-black mb-2 tracking-tight leading-none">${data.name}</h1><p class="text-xl font-medium text-slate-500 tracking-wide">${data.job}</p></div><div class="avatar-crop-container w-32 h-32 rounded-full shadow-xl shrink-0 overflow-hidden relative bg-white ring-4 ring-white"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div></header>
                    <div class="${pad} pt-0 grid grid-cols-1 md:grid-cols-12 gap-10 flex-1 relative z-10"><div class="col-span-1 md:col-span-4 space-y-10"><div class="bg-slate-50 p-6 rounded-xl border-l-4" style="border-color: ${color}"><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Contact</h3><div class="space-y-3 ${tBase} text-slate-600">${data.phone}<br>${data.email}<br>${data.location}</div></div><div><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Skills</h3><div class="flex flex-wrap gap-2">${data.skills.map(s=>`<span class="bg-white border border-slate-200 px-3 py-1.5 rounded-full ${tBase} font-medium shadow-sm">${s}</span>`).join('')}</div></div><div><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">Education</h3>${simple(data.education)}</div></div><div class="col-span-1 md:col-span-8 space-y-10"><section><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-4">About Me</h3><p class="${tBase} ${lead} text-slate-700">${summary}</p></section><section><h3 class="${tTitle} font-bold uppercase tracking-widest text-slate-400 mb-6">Experience</h3><div class="space-y-8 border-l-2 border-slate-100 pl-6 ml-2">${list(data.experiences)}</div></section></div></div>
                </div>`;
            } else if (template === 'compact') {
                html = `<div class="${base} ${pad} text-black">
                    <header class="border-b border-black pb-4 mb-4 flex flex-col items-center"><div class="avatar-crop-container w-16 h-16 rounded-full bg-slate-100 overflow-hidden relative mb-2 border border-slate-200"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div><h1 class="text-2xl font-bold uppercase text-center mb-2 tracking-wide">${data.name}</h1><div class="text-center text-sm flex justify-center flex-wrap gap-4">${data.phone} ${data.email} ${data.location}</div></header>
                    <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Summary</h2><p class="${tBase} ${lead} text-justify">${summary}</p></section>
                    <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Experience</h2><div class="space-y-3">${list(data.experiences)}</div></section>
                    <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Education</h2>${simple(data.education)}</section>
                    <section class="mb-4"><h2 class="${tTitle} font-bold uppercase border-b border-black mb-2" style="color: ${color}">Skills</h2><p class="${tBase} leading-snug">${data.skills.join(', ')}</p></section>
                </div>`;
            } else if (template === 'bold') {
                 html = `<div class="${base} bg-white h-full flex flex-col">
                        <header class="${pad} text-white print-adjust-color flex items-center gap-8" style="background-color: ${color}">
                             <div class="avatar-crop-container w-32 h-32 rounded-full ring-4 ring-white/30 shrink-0 relative bg-white/10"><img src="${photo.src}" class="w-full h-full object-cover absolute top-0 left-0" style="${imgStyle}"></div>
                            <div class="flex-1"><h1 class="text-5xl font-bold mb-2 tracking-tight">${data.name}</h1><p class="text-xl opacity-90 font-medium tracking-wide uppercase">${data.job}</p></div>
                        </header>
                        <div class="flex-1 ${pad} grid grid-cols-1 md:grid-cols-12 gap-10">
                             <div class="col-span-1 md:col-span-4 space-y-8 md:border-r border-slate-100 md:pr-6">
                                <div class="space-y-1 ${tBase}"><div>${data.phone}</div><div>${data.email}</div><div>${data.location}</div></div>
                                <div><h3 class="${tTitle} font-bold uppercase mb-2" style="color:${color}">Skills</h3><div class="flex flex-wrap gap-1">${data.skills.map(s=>`<span class="border px-2 py-1 rounded text-[10px]">${s}</span>`).join('')}</div></div>
                                <div><h3 class="${tTitle} font-bold uppercase mb-2" style="color:${color}">Education</h3>${simple(data.education)}</div>
                             </div>
                             <div class="col-span-1 md:col-span-8 space-y-8">
                                <section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-user text-slate-300"></i> Profile</h3><p class="${tBase} ${lead}">${summary}</p></section>
                                <section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-briefcase text-slate-300"></i> Experience</h3>${list(data.experiences)}</section>
                                ${data.projects.length ? `<section><h3 class="${tTitle} font-bold uppercase mb-4 flex items-center gap-2"><i class="fas fa-rocket text-slate-300"></i> Projects</h3>${list(data.projects)}</section>` : ''}
                             </div>
                        </div>
                    </div>`;
            } else {
                 html = `<div class="${base} ${pad}">
                    <div class="border-b-2 border-slate-900 pb-6 mb-6"><h1 class="text-4xl font-bold uppercase">${data.name}</h1><p class="text-xl text-slate-600">${data.job}</p><div class="${tBase} mt-2">${data.email} | ${data.phone}</div></div>
                    <div class="space-y-6"><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Summary</h2><p class="${tBase} ${lead}">${summary}</p></section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Experience</h2>${list(data.experiences)}</section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Education</h2>${simple(data.education)}</section><section><h2 class="${tTitle} font-bold uppercase mb-2 border-b pb-1">Skills</h2><div>${skills}</div></section></div>
                </div>`;
            }

            c.innerHTML = html;
        }

    </script>
</body>
</html>